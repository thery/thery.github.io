<!DOCTYPE html>
<html class="alectryon-standalone"><head><title>psi.v</title><meta charset="utf-8"><meta content="Alectryon" name="generator"><meta name="viewport" content="width=device-width, initial-scale=1"><script>
    // Resolve backreferences
    document.addEventListener("DOMContentLoaded", function() {
        var references = document.querySelectorAll([
           ".alectryon-io .alectryon-extra-goals",
           ".alectryon-io .alectryon-goal",
           ".alectryon-io .alectryon-goals",
           ".alectryon-io .alectryon-output",
           ".alectryon-io .goal-conclusion",
           ".alectryon-io .goal-hyps",
           ".alectryon-io .goal-hyps > div"].join(", "));
        document.querySelectorAll('.alectryon-io q').forEach(function (q) {
            q.replaceWith(references[parseInt(q.innerText, 16)].cloneNode(true)) });
    });

    // Add checkboxes
    document.addEventListener("DOMContentLoaded", function() {
        var input = document.createElement("input");
        input.type = "checkbox";
        input.style = "display: none";

        input.className = "alectryon-extra-goal-toggle";
        document.querySelectorAll('.alectryon-io label.goal-separator').forEach(function(lbl, idx) {
            var goal = lbl.parentNode, box = input.cloneNode(true);
            lbl.htmlFor = box.id = "alectryon-hyps-chk" + idx;
            goal.parentNode.insertBefore(box, goal);
        });

        input.className = "alectryon-toggle";
        document.querySelectorAll('.alectryon-io .alectryon-output').forEach(function(div, idx) {
            var box = input.cloneNode(true), lbl = div.previousSibling;
            box.checked = div.classList.contains("a:show");
            if (lbl && lbl.tagName == "LABEL") {
                lbl.htmlFor = box.id = "alectryon-output-chk" + idx;
            }
            div.parentNode.insertBefore(box, lbl || div);
        });
    });
</script><link href="alectryon.css" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" /><script src="alectryon.js"></script><style type="text/css">pre { line-height: 125%; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #555753; font-style: italic } /* Comment */
.highlight .err { color: #a40000; border: 1px solid #cc0000 } /* Error */
.highlight .g { color: #000000 } /* Generic */
.highlight .k { color: #8f5902 } /* Keyword */
.highlight .l { color: #2e3436 } /* Literal */
.highlight .n { color: #000000 } /* Name */
.highlight .o { color: #000000 } /* Operator */
.highlight .x { color: #2e3436 } /* Other */
.highlight .p { color: #000000 } /* Punctuation */
.highlight .ch { color: #555753; font-weight: bold; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #555753; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #3465a4; font-style: italic } /* Comment.Preproc */
.highlight .cpf { color: #555753; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #555753; font-style: italic } /* Comment.Single */
.highlight .cs { color: #3465a4; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #a40000 } /* Generic.Deleted */
.highlight .ge { color: #000000; font-style: italic } /* Generic.Emph */
.highlight .gr { color: #a40000 } /* Generic.Error */
.highlight .gh { color: #a40000; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #4e9a06 } /* Generic.Inserted */
.highlight .go { color: #000000; font-style: italic } /* Generic.Output */
.highlight .gp { color: #8f5902 } /* Generic.Prompt */
.highlight .gs { color: #000000; font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #000000; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #000000; font-style: italic } /* Generic.Traceback */
.highlight .kc { color: #204a87; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #4e9a06; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #4e9a06; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #204a87 } /* Keyword.Pseudo */
.highlight .kr { color: #8f5902 } /* Keyword.Reserved */
.highlight .kt { color: #204a87 } /* Keyword.Type */
.highlight .ld { color: #2e3436 } /* Literal.Date */
.highlight .m { color: #2e3436 } /* Literal.Number */
.highlight .s { color: #ad7fa8 } /* Literal.String */
.highlight .na { color: #c4a000 } /* Name.Attribute */
.highlight .nb { color: #75507b } /* Name.Builtin */
.highlight .nc { color: #204a87 } /* Name.Class */
.highlight .no { color: #ce5c00 } /* Name.Constant */
.highlight .nd { color: #3465a4; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #c4a000; text-decoration: underline } /* Name.Entity */
.highlight .ne { color: #cc0000 } /* Name.Exception */
.highlight .nf { color: #a40000 } /* Name.Function */
.highlight .nl { color: #3465a4; font-weight: bold } /* Name.Label */
.highlight .nn { color: #000000 } /* Name.Namespace */
.highlight .nx { color: #000000 } /* Name.Other */
.highlight .py { color: #000000 } /* Name.Property */
.highlight .nt { color: #a40000 } /* Name.Tag */
.highlight .nv { color: #ce5c00 } /* Name.Variable */
.highlight .ow { color: #8f5902 } /* Operator.Word */
.highlight .w { color: #d3d7cf; text-decoration: underline } /* Text.Whitespace */
.highlight .mb { color: #2e3436 } /* Literal.Number.Bin */
.highlight .mf { color: #2e3436 } /* Literal.Number.Float */
.highlight .mh { color: #2e3436 } /* Literal.Number.Hex */
.highlight .mi { color: #2e3436 } /* Literal.Number.Integer */
.highlight .mo { color: #2e3436 } /* Literal.Number.Oct */
.highlight .sa { color: #ad7fa8 } /* Literal.String.Affix */
.highlight .sb { color: #ad7fa8 } /* Literal.String.Backtick */
.highlight .sc { color: #ad7fa8; font-weight: bold } /* Literal.String.Char */
.highlight .dl { color: #ad7fa8 } /* Literal.String.Delimiter */
.highlight .sd { color: #ad7fa8 } /* Literal.String.Doc */
.highlight .s2 { color: #ad7fa8 } /* Literal.String.Double */
.highlight .se { color: #ad7fa8; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #ad7fa8; text-decoration: underline } /* Literal.String.Heredoc */
.highlight .si { color: #ce5c00 } /* Literal.String.Interpol */
.highlight .sx { color: #ad7fa8 } /* Literal.String.Other */
.highlight .sr { color: #ad7fa8 } /* Literal.String.Regex */
.highlight .s1 { color: #ad7fa8 } /* Literal.String.Single */
.highlight .ss { color: #8f5902 } /* Literal.String.Symbol */
.highlight .bp { color: #5c35cc } /* Name.Builtin.Pseudo */
.highlight .fm { color: #a40000 } /* Name.Function.Magic */
.highlight .vc { color: #ce5c00 } /* Name.Variable.Class */
.highlight .vg { color: #ce5c00; text-decoration: underline } /* Name.Variable.Global */
.highlight .vi { color: #ce5c00 } /* Name.Variable.Instance */
.highlight .vm { color: #ce5c00 } /* Name.Variable.Magic */
.highlight .il { color: #2e3436 } /* Literal.Number.Integer.Long */</style></head><body><article class="alectryon-root alectryon-centered alectryon-minified"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Coq+SerAPI v8.13.0+0.13.0. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+‚Üë</kbd> <kbd>Ctrl+‚Üì</kbd> to navigate, <kbd>Ctrl+üñ±Ô∏è</kbd> to focus. On Mac, use <kbd>‚åò</kbd> instead of <kbd>Ctrl</kbd>.</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="sd">(******************************************************************************)</span>
<span class="c">(*                                                                            *)</span>
<span class="c">(*                                    PSI                                     *)</span>
<span class="c">(*     psi n = the psi function                                               *)</span>
<span class="c">(*                                                                            *)</span>
<span class="c">(*                                                                            *)</span>
<span class="c">(*                                                                            *)</span>
<span class="sd">(******************************************************************************)</span>

</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">From</span> mathcomp <span class="kn">Require Import</span> all_ssreflect all_algebra finmap.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;[ rel _ _ | _ ]&quot;</span> was already used <span class="kr">in</span> scope
fun_scope. [notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;[ rel _ _ : _ | _ ]&quot;</span> was already used <span class="kr">in</span>
scope fun_scope. [notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;[ rel _ _ in _ &amp; _ | _ ]&quot;</span> was already used
<span class="kr">in</span> scope fun_scope. [notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;[ rel _ _ in _ &amp; _ ]&quot;</span> was already used <span class="kr">in</span>
scope fun_scope. [notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;[ rel _ _ in _ | _ ]&quot;</span> was already used <span class="kr">in</span>
scope fun_scope. [notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;[ rel _ _ in _ ]&quot;</span> was already used <span class="kr">in</span> scope
fun_scope. [notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ + _&quot;</span> was already used <span class="kr">in</span> scope nat_scope.
[notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ - _&quot;</span> was already used <span class="kr">in</span> scope nat_scope.
[notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ &lt;= _&quot;</span> was already used <span class="kr">in</span> scope nat_scope.
[notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ &lt; _&quot;</span> was already used <span class="kr">in</span> scope nat_scope.
[notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ &gt;= _&quot;</span> was already used <span class="kr">in</span> scope nat_scope.
[notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ &gt; _&quot;</span> was already used <span class="kr">in</span> scope nat_scope.
[notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ &lt;= _ &lt;= _&quot;</span> was already used <span class="kr">in</span> scope
nat_scope. [notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ &lt; _ &lt;= _&quot;</span> was already used <span class="kr">in</span> scope
nat_scope. [notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ &lt;= _ &lt; _&quot;</span> was already used <span class="kr">in</span> scope
nat_scope. [notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ &lt; _ &lt; _&quot;</span> was already used <span class="kr">in</span> scope
nat_scope. [notation-overridden,parsing]</blockquote><blockquote class="alectryon-message"><span class="kn">Notation</span> <span class="s2">&quot;_ * _&quot;</span> was already used <span class="kr">in</span> scope nat_scope.
[notation-overridden,parsing]</blockquote><blockquote class="alectryon-message">New coercion path [GRing.subring_closedM;
                   GRing.smulr_closedN] : GRing.subring_closed &gt;-&gt; GRing.oppr_closed <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.subring_closedB; GRing.zmod_closedN] : GRing.subring_closed &gt;-&gt; GRing.oppr_closed.
[ambiguous-paths,typechecker]</blockquote><blockquote class="alectryon-message">New coercion path [GRing.subring_closed_semi;
                   GRing.semiring_closedM] : GRing.subring_closed &gt;-&gt; GRing.mulr_closed <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.subring_closedM; GRing.smulr_closedM] : GRing.subring_closed &gt;-&gt; GRing.mulr_closed.
New coercion path [GRing.subring_closed_semi;
                   GRing.semiring_closedD] : GRing.subring_closed &gt;-&gt; GRing.addr_closed <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.subring_closedB; GRing.zmod_closedD] : GRing.subring_closed &gt;-&gt; GRing.addr_closed.
[ambiguous-paths,typechecker]</blockquote><blockquote class="alectryon-message">New coercion path [GRing.sdivr_closed_div;
                   GRing.divr_closedM] : GRing.sdivr_closed &gt;-&gt; GRing.mulr_closed <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.sdivr_closedM; GRing.smulr_closedM] : GRing.sdivr_closed &gt;-&gt; GRing.mulr_closed.
[ambiguous-paths,typechecker]</blockquote><blockquote class="alectryon-message">New coercion path [GRing.subalg_closedBM;
                   GRing.subring_closedB] : GRing.subalg_closed &gt;-&gt; GRing.zmod_closed <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.subalg_closedZ; GRing.submod_closedB] : GRing.subalg_closed &gt;-&gt; GRing.zmod_closed.
[ambiguous-paths,typechecker]</blockquote><blockquote class="alectryon-message">New coercion path [GRing.divring_closed_div;
                   GRing.sdivr_closedM] : GRing.divring_closed &gt;-&gt; GRing.smulr_closed <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.divring_closedBM; GRing.subring_closedM] : GRing.divring_closed &gt;-&gt; GRing.smulr_closed.
New coercion path [GRing.divring_closed_div;
                   GRing.sdivr_closedM;
                   GRing.smulr_closedN] : GRing.divring_closed &gt;-&gt; GRing.oppr_closed <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.divring_closedBM; GRing.subring_closedB;
 GRing.zmod_closedN] : GRing.divring_closed &gt;-&gt; GRing.oppr_closed.
[ambiguous-paths,typechecker]</blockquote><blockquote class="alectryon-message">New coercion path [GRing.divalg_closedBdiv;
                   GRing.divring_closedBM] : GRing.divalg_closed &gt;-&gt; GRing.subring_closed <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.divalg_closedZ; GRing.subalg_closedBM] : GRing.divalg_closed &gt;-&gt; GRing.subring_closed.
New coercion path [GRing.divalg_closedBdiv;
                   GRing.divring_closedBM;
                   GRing.subring_closedB] : GRing.divalg_closed &gt;-&gt; GRing.zmod_closed <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.divalg_closedZ; GRing.subalg_closedZ;
 GRing.submod_closedB] : GRing.divalg_closed &gt;-&gt; GRing.zmod_closed.
[ambiguous-paths,typechecker]</blockquote><blockquote class="alectryon-message">New coercion path [GRing.Pred.subring_smul;
                   GRing.Pred.smul_mul] : GRing.Pred.subring &gt;-&gt; GRing.Pred.mul <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.Pred.subring_semi; GRing.Pred.semiring_mul] : GRing.Pred.subring &gt;-&gt; GRing.Pred.mul.
[ambiguous-paths,typechecker]</blockquote><blockquote class="alectryon-message">New coercion path [GRing.Pred.divring_sdiv;
                   GRing.Pred.sdiv_smul;
                   GRing.Pred.smul_mul] : GRing.Pred.divring &gt;-&gt; GRing.Pred.mul <span class="kr">is</span> ambiguous <span class="kr">with</span> existing 
[GRing.Pred.divring_ring; GRing.Pred.subring_semi;
 GRing.Pred.semiring_mul] : GRing.Pred.divring &gt;-&gt; GRing.Pred.mul.
[ambiguous-paths,typechecker]</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> hanoi <span class="kn">Require Import</span> extra triangular phi.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Set Implicit Arguments</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Unset Strict Implicit</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Unset Printing Implicit Defensive</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Open Scope</span> fset_scope.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Open Scope</span> nat_scope.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">BigFSetAux</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Variable</span> (<span class="nv">R</span> : <span class="kt">Type</span>) (<span class="nv">idx</span> : R) (<span class="nv">op</span> : Monoid.com_law idx).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Variable</span> (<span class="nv">I</span> <span class="nv">J</span> : choiceType).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">fsum_nat_const</span> (<span class="nv">e</span> : {fset I}) <span class="nv">a</span> : \sum_(i &lt;- e) a = #|` e| * a.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>R</var><span class="hyp-type"><b>:</b><span><span class="kt">Type</span></span></span></div><div><var>idx</var><span class="hyp-type"><b>:</b><span>R</span></span></div><div><var>op</var><span class="hyp-type"><b>:</b><span>Monoid.com_law idx</span></span></div><div><var>I, J</var><span class="hyp-type"><b>:</b><span>choiceType</span></span></div><div><var>e</var><span class="hyp-type"><b>:</b><span>{fset I}</span></span></div><div><var>a</var><span class="hyp-type"><b>:</b><span>nat</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e) a = #|` e| * a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>2</q></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> big_const_seq count_predT iter_addn_0 mulnC.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">diff_fset0_elem</span> (<span class="nv">e</span> : {fset I}) : e != fset0 -&gt; {i : I | i \<span class="kr">in</span> e}.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>9</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">e != fset0 -&gt; {i : I | i \<span class="kr">in</span> e}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>e</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: e =&gt; [] [|i l] iH //=; <span class="kr">exists</span> <span class="nv">i</span>; <span class="nb">rewrite</span> inE eqxx.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Should be reworked  *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">eq_fbigmax</span> (<span class="nv">e</span> : {fset I}) (<span class="nv">F</span> : I -&gt; nat) :
  <span class="mi">0</span> &lt; #|`e| -&gt; {i0 : I | i0 \<span class="kr">in</span> e /\ \max_(i &lt;- e) F i = F i0}.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>9</q><div><var>F</var><span class="hyp-type"><b>:</b><span>I -&gt; nat</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt; #|` e| -&gt;
{i0 : I | i0 \<span class="kr">in</span> e /\ \max_(i &lt;- e) F i = F i0}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>14</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [n cI] := ubnP #|`e|; <span class="nb">elim</span>: n =&gt; // n IH e cI <span class="kr">in</span> e cI *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>17</q><div><var>n</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><div><var>IH</var><span class="hyp-type"><b>:</b><span><span class="kr">forall</span> <span class="nv">e</span> : {fset I},
#|` e| &lt; n -&gt;
<span class="mi">0</span> &lt; #|` e| -&gt;
{i0 : I | i0 \<span class="kr">in</span> e /\ \max_(i &lt;- e) F i = F i0}</span></span></div><q>9</q><div><var>cI</var><span class="hyp-type"><b>:</b><span>#|` e| &lt; n.+<span class="mi">1</span></span></span></div></div><span class="goal-separator"><hr></span><q>18</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> cardfs_gt0 =&gt; /diff_fset0_elem[i iH].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>17</q><q>1e</q><q>1f</q><q>9</q><q>20</q><div><var>i</var><span class="hyp-type"><b>:</b><span>I</span></span></div><div><var>iH</var><span class="hyp-type"><b>:</b><span>i \<span class="kr">in</span> e</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{i0 : I | i0 \<span class="kr">in</span> e /\ \max_(i &lt;- e) F i = F i0}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [|H] := leqP #|`(e `\ i)| <span class="mi">0</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>24</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e `\ i| &lt;= <span class="mi">0</span> -&gt;
{i0 : I | i0 \<span class="kr">in</span> e /\ \max_(i1 &lt;- e) F i1 = F i0}</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>17</q><q>1e</q><q>1f</q><q>9</q><q>20</q><q>25</q><q>26</q><div><var>H</var><span class="hyp-type"><b>:</b><span><span class="mi">0</span> &lt; #|` e `\ i|</span></span></div></div><label class="goal-separator"><hr></label><q>27</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leqn0 cardfs_eq0 =&gt; /eqP eZ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>17</q><q>1e</q><q>1f</q><q>9</q><q>20</q><q>25</q><q>26</q><div><var>eZ</var><span class="hyp-type"><b>:</b><span>e `\ i = fset0</span></span></div></div><span class="goal-separator"><hr></span><q>27</q></blockquote><q>2c</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kr">exists</span> <span class="nv">i</span>; <span class="nb">split</span> =&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>33</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(i &lt;- e) F i = F i</div></blockquote><q>2c</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (big_fsetD1 i) //= eZ big1_fset =&gt; [|j]; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">rewrite</span> inE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>33</q><span class="goal-separator"><hr></span><div class="goal-conclusion">maxn (F i) <span class="mi">0</span> = F i</div></blockquote><q>2c</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>/maxn_idPl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2e</q><span class="goal-separator"><hr></span><q>27</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: (IH (e `\ i)) =&gt; // [|j [jIe jH]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e `\ i| &lt; n</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>17</q><q>1e</q><q>1f</q><q>9</q><q>20</q><q>25</q><q>26</q><q>2f</q><div><var>j</var><span class="hyp-type"><b>:</b><span>I</span></span></div><div><var>jIe</var><span class="hyp-type"><b>:</b><span>j \<span class="kr">in</span> e `\ i</span></span></div><div><var>jH</var><span class="hyp-type"><b>:</b><span>\max_(i &lt;- e `\ i) F i = F j</span></span></div></div><label class="goal-separator"><hr></label><q>27</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>: cI; <span class="nb">rewrite</span> (cardfsD1 i) iH.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>46</q><span class="goal-separator"><hr></span><q>27</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [FiLFj|FjLFi] := leqP (F i) (F j).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>17</q><q>1e</q><q>1f</q><q>9</q><q>20</q><q>25</q><q>26</q><q>2f</q><q>47</q><q>48</q><q>49</q><div><var>FiLFj</var><span class="hyp-type"><b>:</b><span>F i &lt;= F j</span></span></div></div><span class="goal-separator"><hr></span><q>27</q></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>17</q><q>1e</q><q>1f</q><q>9</q><q>20</q><q>25</q><q>26</q><q>2f</q><q>47</q><q>48</q><q>49</q><div><var>FjLFi</var><span class="hyp-type"><b>:</b><span>F j &lt; F i</span></span></div></div><label class="goal-separator"><hr></label><q>27</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kr">exists</span> <span class="nv">j</span>; <span class="nb">split</span> =&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>50</q><span class="goal-separator"><hr></span><div class="goal-conclusion">j \<span class="kr">in</span> e</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>50</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\max_(i &lt;- e) F i = F j</div></blockquote><q>53</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>: jIe; <span class="nb">rewrite</span> !inE =&gt; /andP[].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>50</q><span class="goal-separator"><hr></span><q>5c</q></blockquote><q>52</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (big_fsetD1 i) //= jH.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>50</q><span class="goal-separator"><hr></span><div class="goal-conclusion">maxn (F i) (F j) = F j</div></blockquote><q>52</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>/maxn_idPr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>54</q><span class="goal-separator"><hr></span><q>27</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kr">exists</span> <span class="nv">i</span>; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>54</q><span class="goal-separator"><hr></span><div class="goal-conclusion">i \<span class="kr">in</span> e</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>54</q><label class="goal-separator"><hr></label><q>38</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>: jIe; <span class="nb">rewrite</span> !inE =&gt; /andP[].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>54</q><span class="goal-separator"><hr></span><q>38</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (big_fsetD1 i) //= jH.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>54</q><span class="goal-separator"><hr></span><div class="goal-conclusion">maxn (F i) (F j) = F i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>/maxn_idPl/ltnW.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">big_fsetD1cond</span> (<span class="nv">a</span> : I) (<span class="nv">A</span> : {fset I}) (<span class="nv">P</span> : pred I) (<span class="nv">F</span> : I -&gt; R) : 
   a \<span class="kr">in</span> A -&gt; P a -&gt;
  \big[op/idx]_(i &lt;- A | P i) F i = 
     op (F a) (\big[op/idx]_(i &lt;- A `\ a | P i) F i).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><div><var>a</var><span class="hyp-type"><b>:</b><span>I</span></span></div><div><var>A</var><span class="hyp-type"><b>:</b><span>{fset I}</span></span></div><div><var>P</var><span class="hyp-type"><b>:</b><span>pred I</span></span></div><div><var>F</var><span class="hyp-type"><b>:</b><span>I -&gt; R</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a \<span class="kr">in</span> A -&gt;
P a -&gt;
\big[op/idx]_(i &lt;- A | P i) F i =
op (F a) (\big[op/idx]_(i &lt;- A `\ a | P i) F i)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>75</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; aA aP; <span class="nb">rewrite</span> (big_fsetIDcond _ (mem [fset a])).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>78</q><q>79</q><q>7a</q><q>7b</q><div><var>aA</var><span class="hyp-type"><b>:</b><span>a \<span class="kr">in</span> A</span></span></div><div><var>aP</var><span class="hyp-type"><b>:</b><span>P a</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">op
  (\big[op/idx]_(i &lt;- [fset x
                         | x <span class="kr">in</span> A
                         &amp; mem [fset a] x] | P i) 
   F i)
  (\big[op/idx]_(i &lt;- [fset x
                         | x <span class="kr">in</span> A
                         &amp; ~~ mem [fset a] x] | P i)
      F i) =
op (F a) (\big[op/idx]_(i &lt;- A `\ a | P i) F i)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">congr</span> (op _ _); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>81</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\big[op/idx]_(i &lt;- [fset x
                      | x <span class="kr">in</span> A
                      &amp; ~~ mem [fset a] x] | P i) 
F i = \big[op/idx]_(i &lt;- A `\ a | P i) F i</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>81</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\big[op/idx]_(i &lt;- [fset x | x <span class="kr">in</span> A &amp; mem [fset a] x] | 
P i) F i = F a</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: eq_fbigl_cond =&gt; i; <span class="nb">rewrite</span> !inE /= [_ &amp;&amp; (_ != _)]andbC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>81</q><span class="goal-separator"><hr></span><q>8b</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (_ : [fset _ | _ <span class="kr">in</span> _ &amp; _] = [fset a]).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>81</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\big[op/idx]_(i &lt;- [fset a] | P i) F i = F a</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>81</q><label class="goal-separator"><hr></label><div class="goal-conclusion">[fset H
   | H <span class="kr">in</span> mem_fin (fset_finpred A)
   &amp; mem [fset a] H] = [fset a]</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> big_seq_fsetE /= /index_enum /= -enumT enum_fset1 /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>81</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\big[op/idx]_(x &lt;- [:: [` fset11 a]] | P (fsval x))
   F (fsval x) = F a</div></blockquote><q>93</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> <span class="nb">unlock</span> /= aP Monoid.Theory.mulm1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>81</q><span class="goal-separator"><hr></span><q>95</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>/fsetP=&gt; i; <span class="nb">rewrite</span> !inE /= andbC; <span class="nb">case</span>: eqP =&gt; //-&gt;.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">BigFSetAux</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">BigFSetAux</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Variable</span> (<span class="nv">R</span> : <span class="kt">Type</span>) (<span class="nv">idx</span> : R) (<span class="nv">op</span> : Monoid.com_law idx).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Variable</span> (<span class="nv">I</span> <span class="nv">J</span> : choiceType).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">bigfmax_leqP</span> (<span class="nv">P</span> : pred I) (<span class="nv">m</span> : nat) (<span class="nv">e</span> : {fset I}) (<span class="nv">F</span> : I -&gt; nat) :
  reflect (<span class="kr">forall</span> <span class="nv">i</span> : I, i \<span class="kr">in</span> e -&gt; P i -&gt; F i &lt;= m) 
          (\max_(i &lt;- e | P i) F i &lt;= m).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>7a</q><div><var>m</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><q>9</q><q>17</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">reflect (<span class="kr">forall</span> <span class="nv">i</span> : I, i \<span class="kr">in</span> e -&gt; P i -&gt; F i &lt;= m)
  (\max_(i &lt;- e | P i) F i &lt;= m)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>9e</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: (iffP idP) =&gt; leFm =&gt; [i iIe Pi|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>7a</q><q>a1</q><q>9</q><q>17</q><div><var>leFm</var><span class="hyp-type"><b>:</b><span>\max_(i &lt;- e | P i) F i &lt;= m</span></span></div><q>25</q><div><var>iIe</var><span class="hyp-type"><b>:</b><span>i \<span class="kr">in</span> e</span></span></div><div><var>Pi</var><span class="hyp-type"><b>:</b><span>P i</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">F i &lt;= m</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>7a</q><q>a1</q><q>9</q><q>17</q><div><var>leFm</var><span class="hyp-type"><b>:</b><span><span class="kr">forall</span> <span class="nv">i</span> : I, i \<span class="kr">in</span> e -&gt; P i -&gt; F i &lt;= m</span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">\max_(i &lt;- e | P i) F i &lt;= m</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>: leFm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>7a</q><q>a1</q><q>9</q><q>17</q><q>25</q><q>a9</q><q>aa</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(i &lt;- e | P i) F i &lt;= m -&gt; F i &lt;= m</div></blockquote><q>ac</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (big_fsetD1cond _ _ _ Pi) //= =&gt; /(leq_trans _)-&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">F i &lt;= maxn (F i) (\max_(i &lt;- e `\ i | P i) F i)</div></blockquote><q>ac</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: leq_maxl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ae</q><span class="goal-separator"><hr></span><q>b0</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> big_seq_cond.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ae</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(i &lt;- e | (i \<span class="kr">in</span> e) &amp;&amp; P i) F i &lt;= m</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>/big_ind: _ =&gt; //= [m1 m2 m1Lm m2Ln | i /andP[]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>7a</q><q>a1</q><q>9</q><q>17</q><q>af</q><div><var>m1, m2</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><div><var>m1Lm</var><span class="hyp-type"><b>:</b><span>m1 &lt;= m</span></span></div><div><var>m2Ln</var><span class="hyp-type"><b>:</b><span>m2 &lt;= m</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">maxn m1 m2 &lt;= m</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>7a</q><q>a1</q><q>9</q><q>17</q><q>af</q><q>25</q></div><label class="goal-separator"><hr></label><div class="goal-conclusion">i \<span class="kr">in</span> e -&gt; P i -&gt; F i &lt;= m</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> geq_max m1Lm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>cb</q><span class="goal-separator"><hr></span><q>cc</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: leFm.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">leq_bigfmax</span> (<span class="nv">e</span> : {fset I}) (<span class="nv">F</span> : I -&gt; nat) <span class="nv">i</span> :
   i \<span class="kr">in</span> e -&gt;  F i &lt;= \max_(i &lt;- e) F i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>9</q><q>17</q><q>25</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i \<span class="kr">in</span> e -&gt; F i &lt;= \max_(i &lt;- e) F i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>d1</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; iIe.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>9</q><q>17</q><q>25</q><q>a9</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">F i &lt;= \max_(i &lt;- e) F i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> : i \<span class="kr">in</span> enum_fset e <span class="bp">by</span> [].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>d9</q><span class="goal-separator"><hr></span><q>d4</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>: enum_fset =&gt; //= a l IH.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>9</q><q>17</q><q>25</q><q>a9</q><q>78</q><div><var>l</var><span class="hyp-type"><b>:</b><span>seq I</span></span></div><div><var>IH</var><span class="hyp-type"><b>:</b><span>i \<span class="kr">in</span> l -&gt; F i &lt;= \max_(i &lt;- l) F i</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i \<span class="kr">in</span> a :: l -&gt; F i &lt;= \max_(i &lt;- (a :: l)) F i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> inE big_cons =&gt; /orP[/eqP&lt;-|/IH H]; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">apply</span>: leq_maxl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>5</q><q>6</q><q>7</q><q>8</q><q>9</q><q>17</q><q>25</q><q>a9</q><q>78</q><q>e2</q><q>e3</q><div><var>H</var><span class="hyp-type"><b>:</b><span>F i &lt;= \max_(i &lt;- l) F i</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">F i &lt;= maxn (F a) (\max_(j &lt;- l) F j)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: leq_trans H _; <span class="nb">apply</span>: leq_maxr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">BigFSetAux</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">PsiDef</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Implicit Type</span> <span class="nf">e</span> : {fset nat}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Import</span> Order.TTheory GRing.Theory Num.Theory.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Open Scope</span> fset_scope.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">psi_aux</span> <span class="nv">l</span> <span class="nv">e</span> : int :=
  ((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + (\sum_(i &lt;- e) <span class="mi">2</span> ^ (minn (troot i) l)))%:R - (l * <span class="mi">2</span> ^ l)%:R.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="s2">&quot;&#39;œà&#39;&#39; n&quot;</span> := (psi_aux n) (<span class="kn">format</span> <span class="s2">&quot;&#39;œà&#39;&#39; n&quot;</span>, <span class="kn">at level</span> <span class="mi">0</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_aux_0_ge0</span> <span class="nv">e</span> :  (<span class="mi">0</span> &lt;= psi_aux <span class="mi">0</span> e)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>e</var><span class="hyp-type"><b>:</b><span>{fset nat}</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">0</span> &lt;= œà&#39;(<span class="mi">0</span>) e)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>ec</q></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> /psi_aux add0n mul0n subr0 (ler_nat _ <span class="mi">0</span>).</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_aux_sub</span> <span class="nv">l</span> <span class="nv">e1</span> <span class="nv">e2</span> : e1 `&lt;=` e2 -&gt; (psi_aux l e1 &lt;= psi_aux l e2)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>l</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><div><var>e1, e2</var><span class="hyp-type"><b>:</b><span>{fset nat}</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">e1 `&lt;=` e2 -&gt; (œà&#39;(l) e1 &lt;= œà&#39;(l) e2)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>f3</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; e1Se2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f6</q><q>f7</q><div><var>e1Se2</var><span class="hyp-type"><b>:</b><span>e1 `&lt;=` e2</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) e1 &lt;= œà&#39;(l) e2)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: ler_sub =&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>fd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l)%:R &lt;=
 ((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>fd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
(<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_add2l //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>fd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [X <span class="kr">in</span> _ &lt;= X](bigID (<span class="kr">fun</span> <span class="nv">i</span> =&gt; i \<span class="kr">in</span> e1)) /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>fd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e2 | i \<span class="kr">in</span> e1) <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- e2 | i \notin e1) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">suff</span> iH : [fset x <span class="kr">in</span> e1 | xpredT x] =i [fset i <span class="kr">in</span> e2 | i \<span class="kr">in</span> e1].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f6</q><q>f7</q><q>fe</q><div><var>iH</var><span class="hyp-type"><b>:</b><span>[fset x | x <span class="kr">in</span> e1 &amp; true]
  =i [fset i | i <span class="kr">in</span> e2 &amp; i \<span class="kr">in</span> e1]</span></span></div></div><span class="goal-separator"><hr></span><q>10f</q></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>fd</q><label class="goal-separator"><hr></label><div class="goal-conclusion">[fset x | x <span class="kr">in</span> e1 &amp; true]
  =i [fset i | i <span class="kr">in</span> e2 &amp; i \<span class="kr">in</span> e1]</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> (eq_fbigl_cond _ _ iH) /= leq_addr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>fd</q><span class="goal-separator"><hr></span><q>117</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; i; <span class="nb">rewrite</span> !inE /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f6</q><q>f7</q><q>fe</q><div><var>i</var><span class="hyp-type"><b>:</b><span>nat_choiceType</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(i \<span class="kr">in</span> [eta mem_seq e1]) &amp;&amp; true =
(i \<span class="kr">in</span> [eta mem_seq e2]) &amp;&amp; (i \<span class="kr">in</span> e1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /fsubsetP/(_ i) := e1Se2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>11e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(i \<span class="kr">in</span> e1 -&gt; i \<span class="kr">in</span> e2) -&gt;
(i \<span class="kr">in</span> [eta mem_seq e1]) &amp;&amp; true =
(i \<span class="kr">in</span> [eta mem_seq e2]) &amp;&amp; (i \<span class="kr">in</span> e1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: (i \<span class="kr">in</span> e1) =&gt; [-&gt;//|]; <span class="nb">rewrite</span> andbF.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_auxE_le</span> <span class="nv">l</span> <span class="nv">e</span> :
  psi_aux l e = 
   (((<span class="mi">2</span> ^ l * #|`[fset i <span class="kr">in</span> e | (l &lt;= troot i)%nat]|.+<span class="mi">1</span>).-<span class="mi">1</span> 
    + (\sum_(i &lt;- e | (troot i &lt; l)%nat) <span class="mi">2</span> ^ troot i))%:R - (l * <span class="mi">2</span> ^ l)%:R)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f6</q><q>ef</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">œà&#39;(l) e =
(((<span class="mi">2</span> ^ l * #|` [fset i <span class="kr">in</span> e | (l &lt;= ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- e | (‚àái &lt; l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>126</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi_aux.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
 (l * <span class="mi">2</span> ^ l)%:R)%R =
(((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; (l &lt;= ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- e | (‚àái &lt; l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">congr</span> (_%:R - _%:R)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l)%N =
((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt;= ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
 \sum_(i &lt;- e | ‚àái &lt; l) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (big_fsetID _ [pred i | l &lt;= ‚àái]) /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> +
 (\sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; l &lt;= ‚àáx])
     <span class="mi">2</span> ^ minn (‚àái) l +
  \sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; ~~ (l &lt;= ‚àáx)])
     <span class="mi">2</span> ^ minn (‚àái) l))%N =
((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt;= ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
 \sum_(i &lt;- e | ‚àái &lt; l) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (@eq_fbigr _ _ _ _ _ _ _ (<span class="kr">fun</span> <span class="nv">i</span> =&gt; <span class="mi">2</span> ^ l)) /=; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">x</span> : nat,
x \<span class="kr">in</span> [fset x0 | x0 <span class="kr">in</span> e &amp; l &lt;= ‚àáx0] -&gt;
true -&gt; <span class="mi">2</span> ^ minn (‚àáx) l = <span class="mi">2</span> ^ l</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>128</q><label class="goal-separator"><hr></label><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> +
 (\sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; l &lt;= ‚àáx]) <span class="mi">2</span> ^ l +
  \sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; ~~ (l &lt;= ‚àáx)])
     <span class="mi">2</span> ^ minn (‚àái) l))%N =
((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt;= ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
 \sum_(i &lt;- e | ‚àái &lt; l) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>=&gt; i; <span class="nb">rewrite</span> !inE =&gt; /andP[_ /minn_idPr-&gt;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><q>13d</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> fsum_nat_const.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> +
 (#|` [fset x | x <span class="kr">in</span> e &amp; l &lt;= ‚àáx]| * <span class="mi">2</span> ^ l +
  \sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; ~~ (l &lt;= ‚àáx)])
     <span class="mi">2</span> ^ minn (‚àái) l))%N =
((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt;= ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
 \sum_(i &lt;- e | ‚àái &lt; l) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (@eq_fbigr _ _ _ _ _ _ _  (<span class="kr">fun</span> <span class="nv">i</span> =&gt; <span class="mi">2</span> ^ (troot i))) /=; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">x</span> : nat,
x \<span class="kr">in</span> [fset x0 | x0 <span class="kr">in</span> e &amp; ~~ (l &lt;= ‚àáx0)] -&gt;
true -&gt; <span class="mi">2</span> ^ minn (‚àáx) l = <span class="mi">2</span> ^ ‚àáx</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>128</q><label class="goal-separator"><hr></label><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> +
 (#|` [fset x | x <span class="kr">in</span> e &amp; l &lt;= ‚àáx]| * <span class="mi">2</span> ^ l +
  \sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; ~~ (l &lt;= ‚àáx)]) <span class="mi">2</span> ^ ‚àái))%N =
((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt;= ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
 \sum_(i &lt;- e | ‚àái &lt; l) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; i; <span class="nb">rewrite</span> !inE =&gt; /andP[_ H] _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f6</q><q>ef</q><div><var>i</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><div><var>H</var><span class="hyp-type"><b>:</b><span>~~ (l &lt;= ‚àái)</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ minn (‚àái) l = <span class="mi">2</span> ^ ‚àái</div></blockquote><q>149</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">suff</span> /minn_idPl-&gt; : troot i &lt;= l <span class="bp">by</span> [].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>14f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">‚àái &lt;= l</div></blockquote><q>149</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> ltnW // ltnNge.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><q>14b</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addnA; <span class="nb">congr</span> (_ + _)%nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + #|` [fset x | x <span class="kr">in</span> e &amp; l &lt;= ‚àáx]| * <span class="mi">2</span> ^ l)%N =
(<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt;= ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span></div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>128</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; ~~ (l &lt;= ‚àáx)]) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt;- e | ‚àái &lt; l) <span class="mi">2</span> ^ ‚àái</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mulnS [_ ^ _ * #|`_|]mulnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + #|` [fset x | x <span class="kr">in</span> e &amp; l &lt;= ‚àáx]| * <span class="mi">2</span> ^ l)%N =
(<span class="mi">2</span> ^ l + #|` [fset i | i <span class="kr">in</span> e &amp; l &lt;= ‚àái]| * <span class="mi">2</span> ^ l).-<span class="mi">1</span></div></blockquote><q>15e</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: (<span class="mi">2</span> ^ l) (expn_gt0 <span class="mi">2</span> l).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><q>160</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: eq_fbigl_cond =&gt; i; <span class="nb">rewrite</span> !inE ltnNge andbT.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_auxE_lt</span> <span class="nv">l</span> <span class="nv">e</span> :
  psi_aux l e =
   (((<span class="mi">2</span> ^ l * #|`[fset i <span class="kr">in</span> e | (l &lt; troot i)%nat]|.+<span class="mi">1</span>).-<span class="mi">1</span> 
    + (\sum_(i &lt;- e | (troot i &lt;= l)%nat) <span class="mi">2</span> ^ troot i))%:R - (l * <span class="mi">2</span> ^ l)%:R)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà&#39;(l) e =
(((<span class="mi">2</span> ^ l * #|` [fset i <span class="kr">in</span> e | (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- e | (‚àái &lt;= l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>169</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi_aux.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
 (l * <span class="mi">2</span> ^ l)%:R)%R =
(((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- e | (‚àái &lt;= l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">congr</span> (_%:R - _%:R)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l)%N =
((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt; ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
 \sum_(i &lt;- e | ‚àái &lt;= l) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (big_fsetID _ [pred i | l &lt; troot i]) /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> +
 (\sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; l &lt; ‚àáx])
     <span class="mi">2</span> ^ minn (‚àái) l +
  \sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; ~~ (l &lt; ‚àáx)])
     <span class="mi">2</span> ^ minn (‚àái) l))%N =
((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt; ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
 \sum_(i &lt;- e | ‚àái &lt;= l) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (@eq_fbigr _ _ _ _ _ _ _ (<span class="kr">fun</span> =&gt; <span class="mi">2</span> ^ l)) /=; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">x</span> : nat,
x \<span class="kr">in</span> [fset x0 | x0 <span class="kr">in</span> e &amp; l &lt; ‚àáx0] -&gt;
true -&gt; <span class="mi">2</span> ^ minn (‚àáx) l = <span class="mi">2</span> ^ l</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>128</q><label class="goal-separator"><hr></label><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> +
 (\sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; l &lt; ‚àáx]) <span class="mi">2</span> ^ l +
  \sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; ~~ (l &lt; ‚àáx)])
     <span class="mi">2</span> ^ minn (‚àái) l))%N =
((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt; ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
 \sum_(i &lt;- e | ‚àái &lt;= l) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>=&gt; i; <span class="nb">rewrite</span> !inE =&gt; /andP[_ /ltnW/minn_idPr -&gt;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><q>17f</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> fsum_nat_const.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> +
 (#|` [fset x | x <span class="kr">in</span> e &amp; l &lt; ‚àáx]| * <span class="mi">2</span> ^ l +
  \sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; ~~ (l &lt; ‚àáx)])
     <span class="mi">2</span> ^ minn (‚àái) l))%N =
((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt; ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
 \sum_(i &lt;- e | ‚àái &lt;= l) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (@eq_fbigr _ _ _ _ _ _ _ (<span class="kr">fun</span> <span class="nv">i</span> =&gt; <span class="mi">2</span> ^ troot i)) /=; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">x</span> : nat,
x \<span class="kr">in</span> [fset x0 | x0 <span class="kr">in</span> e &amp; ~~ (l &lt; ‚àáx0)] -&gt;
true -&gt; <span class="mi">2</span> ^ minn (‚àáx) l = <span class="mi">2</span> ^ ‚àáx</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>128</q><label class="goal-separator"><hr></label><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> +
 (#|` [fset x | x <span class="kr">in</span> e &amp; l &lt; ‚àáx]| * <span class="mi">2</span> ^ l +
  \sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; ~~ (l &lt; ‚àáx)]) <span class="mi">2</span> ^ ‚àái))%N =
((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt; ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
 \sum_(i &lt;- e | ‚àái &lt;= l) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; i; <span class="nb">rewrite</span> !inE /= =&gt; /andP[_ H] _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f6</q><q>ef</q><q>150</q><div><var>H</var><span class="hyp-type"><b>:</b><span>~~ (l &lt; ‚àái)</span></span></div></div><span class="goal-separator"><hr></span><q>152</q></blockquote><q>18b</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">suff</span> /minn_idPl-&gt; : troot i &lt;= l <span class="bp">by</span> [].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>191</q><span class="goal-separator"><hr></span><q>156</q></blockquote><q>18b</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> leqNgt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><q>18d</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addnA; <span class="nb">congr</span> (_ + _)%nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + #|` [fset x | x <span class="kr">in</span> e &amp; l &lt; ‚àáx]| * <span class="mi">2</span> ^ l)%N =
(<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> e &amp; l &lt; ‚àái]|.+<span class="mi">1</span>).-<span class="mi">1</span></div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>128</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- [fset x | x <span class="kr">in</span> e &amp; ~~ (l &lt; ‚àáx)]) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt;- e | ‚àái &lt;= l) <span class="mi">2</span> ^ ‚àái</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mulnS [_ ^ _ * #|`_|]mulnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + #|` [fset x | x <span class="kr">in</span> e &amp; l &lt; ‚àáx]| * <span class="mi">2</span> ^ l)%N =
(<span class="mi">2</span> ^ l + #|` [fset i | i <span class="kr">in</span> e &amp; l &lt; ‚àái]| * <span class="mi">2</span> ^ l).-<span class="mi">1</span></div></blockquote><q>19d</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: (<span class="mi">2</span> ^ l) (expn_gt0 <span class="mi">2</span> l).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><q>19f</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: eq_fbigl_cond =&gt; i; <span class="nb">rewrite</span> !inE ltnNge andbT negbK.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">psi_auxb</span> <span class="nv">e</span> := (maxn #|`e| (\max_(i &lt;- e) troot i)).+<span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="s2">&quot;&#39;œà_b&#39; n&quot;</span> := (psi_auxb n) (<span class="kn">format</span> <span class="s2">&quot;&#39;œà_b&#39; n&quot;</span>, <span class="kn">at level</span> <span class="mi">0</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_aux_psib</span> <span class="nv">l</span> <span class="nv">e</span> : psi_auxb e &lt;= l -&gt; (psi_aux l e &lt;= <span class="mi">0</span>)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà_b(e) &lt;= l -&gt; (œà&#39;(l) e &lt;= <span class="mi">0</span>)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>1a8</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi_auxb; <span class="nb">case</span>: l =&gt; // l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">maxn #|` e| (\max_(i &lt;- e) ‚àái) &lt; l.+<span class="mi">1</span> -&gt;
(œà&#39;(l.+<span class="mi">1</span>) e &lt;= <span class="mi">0</span>)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ltnS /psi_aux geq_max =&gt; /andP[eLl maxLl].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q><div><var>eLl</var><span class="hyp-type"><b>:</b><span>#|` e| &lt;= l</span></span></div><div><var>maxLl</var><span class="hyp-type"><b>:</b><span>\max_(i &lt;- e) ‚àái &lt;= l</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l.+<span class="mi">1</span>).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l.+<span class="mi">1</span>)%:R -
 (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R &lt;= <span class="mi">0</span>)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mulSn -{<span class="mi">2</span>}[_ ^ _]prednK <span class="nl">?expn_gt0</span> // addSnnS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1b4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l.+<span class="mi">1</span>).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l.+<span class="mi">1</span>)%:R -
 ((<span class="mi">2</span> ^ l.+<span class="mi">1</span>).-<span class="mi">1</span> + (l * <span class="mi">2</span> ^ l.+<span class="mi">1</span>).+<span class="mi">1</span>)%:R &lt;= <span class="mi">0</span>)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> !natrD [(_%:R + _)%R]addrC opprD addrA addrK.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1b4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l.+<span class="mi">1</span>)%:R -
 (l * <span class="mi">2</span> ^ l.+<span class="mi">1</span>).+<span class="mi">1</span>%:R &lt;= <span class="mi">0</span>)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> subr_le0 ler_nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1b4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l.+<span class="mi">1</span> &lt;= (l * <span class="mi">2</span> ^ l.+<span class="mi">1</span>).+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (leqnSn _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1b4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l.+<span class="mi">1</span> &lt;= l * <span class="mi">2</span> ^ l.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (_ : #|`e| * <span class="mi">2</span> ^ l.+<span class="mi">1</span> &lt;= _); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1b4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e| * <span class="mi">2</span> ^ l.+<span class="mi">1</span> &lt;= l * <span class="mi">2</span> ^ l.+<span class="mi">1</span></div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>1b4</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l.+<span class="mi">1</span> &lt;= #|` e| * <span class="mi">2</span> ^ l.+<span class="mi">1</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> leq_mul2r eLl orbT.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1b4</q><span class="goal-separator"><hr></span><q>1ce</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -fsum_nat_const.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1b4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l.+<span class="mi">1</span> &lt;=
\sum_(i &lt;- e) <span class="mi">2</span> ^ l.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_sum =&gt; i iIe.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q><q>1b5</q><q>1b6</q><q>11f</q><div><var>iIe</var><span class="hyp-type"><b>:</b><span>true</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ minn (‚àái) l.+<span class="mi">1</span> &lt;= <span class="mi">2</span> ^ l.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_pexp2l =&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1d9</q><span class="goal-separator"><hr></span><div class="goal-conclusion">minn (‚àái) l.+<span class="mi">1</span> &lt;= l.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span> geq_minr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">rnz</span> (<span class="nv">z</span> : int) := `|Num.max <span class="mi">0</span>%R z|.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">rnz_ler0</span> <span class="nv">z</span> : (z &lt;= <span class="mi">0</span>)%R -&gt; rnz z = <span class="mi">0</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>z</var><span class="hyp-type"><b>:</b><span>int_numDomainType</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(z &lt;= <span class="mi">0</span>)%R -&gt; rnz z = <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>1e1</q></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>=&gt;  zN; <span class="nb">rewrite</span> /rnz max_l.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">rnz_ger0</span> <span class="nv">z</span> : (<span class="mi">0</span> &lt;= z)%R -&gt; (z = (rnz z)%:R)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1e3</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">0</span> &lt;= z)%R -&gt; z = ((rnz z)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>1e8</q></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>=&gt;  zP; <span class="nb">rewrite</span> /rnz max_r // natz gez0_abs.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">ler_rnz</span> <span class="nv">z</span> : (z &lt;= rnz z)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>z</var><span class="hyp-type"><b>:</b><span>int_porderType</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(z &lt;= rnz z)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>1ed</q></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> /rnz; <span class="nb">case</span>: ler0P =&gt; //= zP; <span class="nb">rewrite</span> gtz0_abs.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">rnz_ler</span> <span class="nv">z1</span> <span class="nv">z2</span> : (z1 &lt;= z2)%R -&gt; rnz z1 &lt;= rnz z2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>z1, z2</var><span class="hyp-type"><b>:</b><span>int_porderType</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(z1 &lt;= z2)%R -&gt; rnz z1 &lt;= rnz z2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>1f4</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /rnz; <span class="nb">case</span>: ler0P =&gt; // z1_gt0 z1Lz2; <span class="nb">case</span>: ler0P =&gt; //= [|z2_gt0].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1f7</q><div><var>z1_gt0</var><span class="hyp-type"><b>:</b><span>(<span class="mi">0</span> &lt; z1)%R</span></span></div><div><var>z1Lz2</var><span class="hyp-type"><b>:</b><span>(z1 &lt;= z2)%R</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(z2 &lt;= <span class="mi">0</span>)%R -&gt; `|z1| &lt;= <span class="mi">0</span></div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1f7</q><q>1fe</q><q>1ff</q><div><var>z2_gt0</var><span class="hyp-type"><b>:</b><span>(<span class="mi">0</span> &lt; z2)%R</span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">`|z1| &lt;= `|z2|</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> leNgt =&gt; /negP[]; <span class="nb">apply</span>: lt_le_trans z1Lz2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>203</q><span class="goal-separator"><hr></span><q>205</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -lez_nat !gtz0_abs.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">psi</span> <span class="nv">e</span> := \max_(l &lt; psi_auxb e) rnz (psi_aux l e).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="s2">&quot;&#39;œà&#39; n&quot;</span> := (psi n) (<span class="kn">format</span> <span class="s2">&quot;&#39;œà&#39; n&quot;</span>, <span class="kn">at level</span> <span class="mi">0</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psiE_leq</span> <span class="nv">e</span> <span class="nv">n</span> :
  psi_auxb e &lt;= n -&gt; psi e = \max_(l &lt; n) rnz (psi_aux l e).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>1e</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">œà_b(e) &lt;= n -&gt; œà(e) = \max_(l &lt; n) rnz (œà&#39;(l) e)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>20a</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; pLn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>1e</q><div><var>pLn</var><span class="hyp-type"><b>:</b><span>œà_b(e) &lt;= n</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(e) = \max_(l &lt; n) rnz (œà&#39;(l) e)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>212</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; œà_b(e)) rnz (œà&#39;(l) e) =
\max_(l &lt; n) rnz (œà&#39;(l) e)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (big_ord_widen_cond _ xpredT (<span class="kr">fun</span> <span class="nv">i</span> =&gt; rnz (psi_aux i e)) pLn).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>212</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(i &lt; n | true &amp;&amp; (i &lt; œà_b(e))) rnz (œà&#39;(i) e) =
\max_(l &lt; n) rnz (œà&#39;(l) e)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [RHS](bigID (<span class="kr">fun</span> <span class="nv">i</span> : &#39;I_n =&gt; i &lt; psi_auxb e)) /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>212</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(i &lt; n | i &lt; œà_b(e)) rnz (œà&#39;(i) e) =
maxn (\max_(i &lt; n | i &lt; œà_b(e)) rnz (œà&#39;(i) e))
  (\max_(i &lt; n | ~~ (i &lt; œà_b(e))) rnz (œà&#39;(i) e))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [X <span class="kr">in</span> _ = maxn _ X]big1 <span class="nl">?maxn0</span> // =&gt; i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>1e</q><q>213</q><div><var>i</var><span class="hyp-type"><b>:</b><span>&#39;I_n</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">~~ (i &lt; œà_b(e)) -&gt; rnz (œà&#39;(i) e) = <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -leqNgt =&gt; /psi_aux_psib.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>224</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(i) e &lt;= <span class="mi">0</span>)%R -&gt; rnz (œà&#39;(i) e) = <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span>: rnz_ler0.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_max</span> <span class="nv">e</span> <span class="nv">l</span> : (psi_aux l e &lt;= (psi e)%:R)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1af</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) e &lt;= œà(e)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>22c</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> n := maxn (psi_auxb e) l.+<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q><div><var>n</var><span><span class="hyp-body"><b>:=</b><span>maxn œà_b(e) l.+<span class="mi">1</span></span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><q>22e</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /psiE_leq-&gt; : psi_auxb e &lt;= n <span class="bp">by</span> <span class="nb">apply</span>: leq_maxl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>233</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) e &lt;= (\max_(l &lt; n) rnz (œà&#39;(l) e))%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> O : l &lt; n <span class="bp">by</span> <span class="nb">apply</span>: leq_maxr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q><q>234</q><div><var>O</var><span class="hyp-type"><b>:</b><span>l &lt; n</span></span></div></div><span class="goal-separator"><hr></span><q>238</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [/le_trans-&gt;//|/ltW/rnz_ger0-&gt;] := lerP (psi_aux l e) <span class="mi">0</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>23c</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">0</span> &lt;= (\max_(l &lt; n) rnz (œà&#39;(l) e))%:R)%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>23c</q><label class="goal-separator"><hr></label><div class="goal-conclusion">((rnz (œà&#39;(l) e))%:R &lt;= (\max_(l &lt; n) rnz (œà&#39;(l) e))%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> (ler_nat _ <span class="mi">0</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>23c</q><span class="goal-separator"><hr></span><q>244</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>23c</q><span class="goal-separator"><hr></span><div class="goal-conclusion">rnz (œà&#39;(l) e) &lt;= \max_(l &lt; n) rnz (œà&#39;(l) e)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> (bigD1 (Ordinal O)) //= leq_maxl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_ler</span> <span class="nv">l</span> <span class="nv">e</span> : 
  (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ (minn (troot i) l))%:R - (l * <span class="mi">2</span> ^ l)%:R 
      &lt;= ((psi e)%:R : int))%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
 (l * <span class="mi">2</span> ^ l)%:R &lt;= (œà(e)%:R : int))%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>24d</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [/psi_aux_psib/le_trans-&gt;//|lLp] := leqP (psi_auxb e) l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">0</span> &lt;= œà(e)%:R)%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f6</q><q>ef</q><div><var>lLp</var><span class="hyp-type"><b>:</b><span>l &lt; œà_b(e)</span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">(((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
 (l * <span class="mi">2</span> ^ l)%:R &lt;= œà(e)%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> (ler_nat _ <span class="mi">0</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>257</q><span class="goal-separator"><hr></span><q>259</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [X <span class="kr">in</span> (_ &lt;= X%:R)%R](bigD1 (Ordinal lLp)) //=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>257</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
 (l * <span class="mi">2</span> ^ l)%:R &lt;=
 (maxn (rnz (œà&#39;(l) e))
    (\max_(i &lt; œà_b(e) | i != Ordinal lLp)
        rnz (œà&#39;(i) e)))%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: le_trans (ler_rnz _) _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>257</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(rnz
   (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
    (l * <span class="mi">2</span> ^ l)%:R) &lt;=
 (maxn (rnz (œà&#39;(l) e))
    (\max_(i &lt; œà_b(e) | i != Ordinal lLp)
        rnz (œà&#39;(i) e)))%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -natz ler_nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>257</q><span class="goal-separator"><hr></span><div class="goal-conclusion">rnz
  (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
   (l * <span class="mi">2</span> ^ l)%:R) &lt;=
maxn (rnz (œà&#39;(l) e))
  (\max_(i &lt; œà_b(e) | i != Ordinal lLp) rnz (œà&#39;(i) e))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span>: leq_maxl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psiE</span> <span class="nv">e</span> :  {l | ((psi e)%:R = psi_aux l e)%R}.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ee</q><span class="goal-separator"><hr></span><div class="goal-conclusion">{l : nat | (œà(e)%:R)%R = œà&#39;(l) e}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>26a</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [l] :  {l : &#39;I_(psi_auxb e) | psi e = rnz (psi_aux l e)}.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ee</q><span class="goal-separator"><hr></span><div class="goal-conclusion">{l : &#39;I_œà_b(e) | œà(e) = rnz (œà&#39;(l) e)}</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><div><var>l</var><span class="hyp-type"><b>:</b><span>&#39;I_œà_b(e)</span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">œà(e) = rnz (œà&#39;(l) e) -&gt;
{l : nat | (œà(e)%:R)%R = œà&#39;(l) e}</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: eq_bigmax.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ee</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt; #|ordinal_finType œà_b(e)|</div></blockquote><q>272</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> card_ord.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>274</q><span class="goal-separator"><hr></span><q>276</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /rnz; <span class="nb">case</span>: ler0P =&gt; [pG pE|pP -&gt;]; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>275</q><div><var>pP</var><span class="hyp-type"><b>:</b><span>(<span class="mi">0</span> &lt; œà&#39;(l) e)%R</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{l0 : nat | (`|œà&#39;(l) e|%:R)%R = œà&#39;(l0) e}</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>275</q><div><var>pG</var><span class="hyp-type"><b>:</b><span>(œà&#39;(l) e &lt;= <span class="mi">0</span>)%R</span></span></div><div><var>pE</var><span class="hyp-type"><b>:</b><span>œà(e) = `|<span class="mi">0</span>%R|</span></span></div></div><label class="goal-separator"><hr></label><q>26c</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="nv">l</span>; <span class="nb">rewrite</span> natz gtz0_abs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>286</q><span class="goal-separator"><hr></span><q>26c</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="kr">exists</span> <span class="mi">0</span>; <span class="nb">apply</span>/eqP; <span class="nb">rewrite</span> eq_le {<span class="mi">1</span>}pE psi_aux_0_ge0 psi_max.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_sub</span> <span class="nv">e1</span> <span class="nv">e2</span> : e1 `&lt;=` e2 -&gt; psi e1 &lt;= psi e2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">e1 `&lt;=` e2 -&gt; œà(e1) &lt;= œà(e2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>28d</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; e1Se2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>fe</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(e1) &lt;= œà(e2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (psiE_leq (leq_maxl (psi_auxb e1) (psi_auxb e2))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>295</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; maxn œà_b(e1) œà_b(e2)) rnz (œà&#39;(l) e1) &lt;=
œà(e2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (psiE_leq (leq_maxl (psi_auxb e2) (psi_auxb e1))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>295</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; maxn œà_b(e1) œà_b(e2)) rnz (œà&#39;(l) e1) &lt;=
\max_(l &lt; maxn œà_b(e2) œà_b(e1)) rnz (œà&#39;(l) e2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> maxnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>295</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; maxn œà_b(e2) œà_b(e1)) rnz (œà&#39;(l) e1) &lt;=
\max_(l &lt; maxn œà_b(e2) œà_b(e1)) rnz (œà&#39;(l) e2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>/big_ind2: _ =&gt; // [x1 x2 y1 y2 x2Lx1 y2Ly1 | i _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>fe</q><div><var>x1, x2, y1, y2</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><div><var>x2Lx1</var><span class="hyp-type"><b>:</b><span>x2 &lt;= x1</span></span></div><div><var>y2Ly1</var><span class="hyp-type"><b>:</b><span>y2 &lt;= y1</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">maxn x2 y2 &lt;= maxn x1 y1</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>fe</q><div><var>i</var><span class="hyp-type"><b>:</b><span>ordinal_finType (maxn œà_b(e2) œà_b(e1))</span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">rnz (œà&#39;(i) e1) &lt;= rnz (œà&#39;(i) e2)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> geq_max (leq_trans x2Lx1 (leq_maxl _ _)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2a6</q><span class="goal-separator"><hr></span><div class="goal-conclusion">true &amp;&amp; (y2 &lt;= maxn x1 y1)</div></blockquote><q>2ab</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span>  (leq_trans y2Ly1 (leq_maxr _ _)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2ad</q><span class="goal-separator"><hr></span><q>2af</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: rnz_ler.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2ad</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(i) e1 &lt;= œà&#39;(i) e2)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: psi_aux_sub.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_aux_le_psi</span> <span class="nv">e1</span> <span class="nv">e2</span> :
  (<span class="kr">forall</span> <span class="nv">l</span>, (psi_aux l e1 &lt;= psi_aux l e2)%R) -&gt; psi e1 &lt;= psi e2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>28f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">forall</span> <span class="nv">l</span> : nat, (œà&#39;(l) e1 &lt;= œà&#39;(l) e2)%R) -&gt;
œà(e1) &lt;= œà(e2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>2bc</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><div><var>H</var><span class="hyp-type"><b>:</b><span><span class="kr">forall</span> <span class="nv">l</span> : nat, (œà&#39;(l) e1 &lt;= œà&#39;(l) e2)%R</span></span></div></div><span class="goal-separator"><hr></span><q>296</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> e := maxn (psi_auxb e1) (psi_auxb e2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>2c4</q><div><var>e</var><span><span class="hyp-body"><b>:=</b><span>maxn œà_b(e1) œà_b(e2)</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><q>296</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (psiE_leq (leq_maxl _ _ : _ &lt;= e)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2c8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; e) rnz (œà&#39;(l) e1) &lt;= œà(e2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (psiE_leq (leq_maxr _ _ : _ &lt;= e)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2c8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; e) rnz (œà&#39;(l) e1) &lt;=
\max_(l &lt; e) rnz (œà&#39;(l) e2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>: e =&gt; [|e IH]; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">rewrite</span> !big_ord0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>2c4</q><div><var>e</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><div><var>IH</var><span class="hyp-type"><b>:</b><span>\max_(l &lt; e) rnz (œà&#39;(l) e1) &lt;=
\max_(l &lt; e) rnz (œà&#39;(l) e2)</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; e.+<span class="mi">1</span>) rnz (œà&#39;(l) e1) &lt;=
\max_(l &lt; e.+<span class="mi">1</span>) rnz (œà&#39;(l) e2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> !big_ord_recr /= geq_max !leq_max IH /= rnz_ler // orbT.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_auxb_sint</span> <span class="nv">n</span> : psi_auxb `[n] = n.+<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">œà_b(`[n]) = n.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>2da</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">congr</span> (_.+<span class="mi">1</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">maxn #|` `[n]| (\max_(i &lt;- `[n]) ‚àái) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi_auxb.</label><small class="alectryon-output"><div><q>2e0</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> card_sint <span class="nl">?geq_minr</span> // subn0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">maxn n (\max_(i &lt;- `[n]) ‚àái) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">maxn n (\max_(i &lt;- `[n]) ‚àái) == n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> eqn_leq leq_maxl andbT geq_max leqnn andTb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(i &lt;- `[n]) ‚àái &lt;= n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/bigfmax_leqP =&gt; i; <span class="nb">rewrite</span> mem_sint /= =&gt; iLn _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>11f</q><div><var>iLn</var><span class="hyp-type"><b>:</b><span>i &lt; n</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">‚àái &lt;= n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: leq_trans (leq_rootnn _) (ltnW _).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_aux_sintE</span> <span class="nv">n</span> <span class="nv">l</span> :
  psi_aux l `[n] = 
  (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(<span class="mi">0</span> &lt;= i &lt;  n) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
   (l * <span class="mi">2</span> ^ l)%:R)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>n, l</var><span class="hyp-type"><b>:</b><span>nat</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">œà&#39;(l) `[n] =
(((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(<span class="mi">0</span> &lt;= i &lt; n) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
 (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>2f7</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">congr</span> ((_ + _)%:R - _%:R)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2f9</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- `[n]) <span class="mi">2</span> ^ minn (‚àái) l =
\sum_(<span class="mi">0</span> &lt;= i &lt; n) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>: n =&gt; [|n IH]; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">rewrite</span> sint0_set0 /= big_nil.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>l, n</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><div><var>IH</var><span class="hyp-type"><b>:</b><span>\sum_(i &lt;- `[n]) <span class="mi">2</span> ^ minn (‚àái) l =
\sum_(<span class="mi">0</span> &lt;= i &lt; n) <span class="mi">2</span> ^ minn (‚àái) l</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- `[n.+<span class="mi">1</span>]) <span class="mi">2</span> ^ minn (‚àái) l =
\sum_(<span class="mi">0</span> &lt;= i &lt; n.+<span class="mi">1</span>) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (big_fsetD1 n) /=; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">rewrite</span> mem_sint andTb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>304</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ minn (‚àán) l +
 \sum_(i &lt;- `[n.+<span class="mi">1</span>] `\ n) <span class="mi">2</span> ^ minn (‚àái) l)%N =
\sum_(<span class="mi">0</span> &lt;= i &lt; n.+<span class="mi">1</span>) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> sintSr IH !big_mkord big_ord_recr /= addnC.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_auxb_set0</span> : psi_auxb fset0 = <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">œà_b(fset0) = <span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>30d</q></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> /psi_auxb cardfs0 max0n big_seq_cond big1.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span>  <span class="nf">psi_set0</span> : psi fset0 = <span class="mi">0</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(fset0) = <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>312</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi psi_auxb_set0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; <span class="mi">1</span>) rnz (œà&#39;(l) fset0) = <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> !big_ord_recr /= big_ord0 /= max0n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">rnz (œà&#39;(<span class="mi">0</span>) fset0) = <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> /psi_aux /= big_seq_cond big1.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_eq0</span> <span class="nv">e</span> : (psi e == <span class="mi">0</span>) = (e == fset0).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ee</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(e) == <span class="mi">0</span>) = (e == fset0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>31f</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [-&gt;|[x]] := fset_0Vmem e; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">rewrite</span> psi_set0 !eqxx.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><div><var>x</var><span class="hyp-type"><b>:</b><span>nat_choiceType</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">x \<span class="kr">in</span> e -&gt; (œà(e) == <span class="mi">0</span>) = (e == fset0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [-&gt;|_] := e =P fset0; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">rewrite</span> inE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>326</q><span class="goal-separator"><hr></span><div class="goal-conclusion">x \<span class="kr">in</span> e -&gt; (œà(e) == <span class="mi">0</span>) = false</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; xIe.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>327</q><div><var>xIe</var><span class="hyp-type"><b>:</b><span>x \<span class="kr">in</span> e</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(e) == <span class="mi">0</span>) = false</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">suff</span> : psi e &gt; <span class="mi">0</span> <span class="bp">by</span> <span class="nb">case</span>: psi.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>330</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt; œà(e)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(ltr_nat int_numDomainType).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>330</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">0</span>%:R &lt; œà(e)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: lt_le_trans (psi_max _ <span class="mi">0</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>330</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">0</span>%:R &lt; œà&#39;(<span class="mi">0</span>) e)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> /psi_aux add0n subr0 ltr_nat (big_fsetD1 x).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span>  <span class="nf">psi_sint0</span> : psi `[<span class="mi">0</span>] = <span class="mi">0</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[<span class="mi">0</span>]) = <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>340</q></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> sint0_set0 psi_set0.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span>  <span class="nf">psi_sint1</span> : psi `[<span class="mi">1</span>] = <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[<span class="mi">1</span>]) = <span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>345</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi psi_auxb_sint.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; <span class="mi">2</span>) rnz (œà&#39;(l) `[<span class="mi">1</span>]) = <span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(big_mkord xpredT (<span class="kr">fun</span> <span class="nv">l</span> =&gt; rnz (psi_aux l _))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">2</span>) rnz (œà&#39;(i) `[<span class="mi">1</span>]) = <span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> f l := 
    rnz (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(<span class="mi">0</span> &lt;= i &lt;  <span class="mi">1</span>) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
         (l * <span class="mi">2</span> ^ l)%:R).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>f</var><span><span class="hyp-body"><b>:=</b><span><span class="kr">fun</span> <span class="nv">l</span> : nat =&gt;
rnz
  (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">1</span>) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
   (l * <span class="mi">2</span> ^ l)%:R)</span></span><span class="hyp-type"><b>:</b><span>nat -&gt; nat</span></span></span></div></div><span class="goal-separator"><hr></span><q>350</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (eq_bigr f) =&gt; [|i _]; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">rewrite</span> psi_aux_sintE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>354</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">2</span>) f i = <span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> /f /= <span class="nb">unlock</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span>  <span class="nf">psi_sint2</span> : psi `[<span class="mi">2</span>] = <span class="mi">2</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[<span class="mi">2</span>]) = <span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>35b</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi psi_auxb_sint.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; <span class="mi">3</span>) rnz (œà&#39;(l) `[<span class="mi">2</span>]) = <span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(big_mkord xpredT (<span class="kr">fun</span> <span class="nv">l</span> =&gt; rnz (psi_aux l _))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">3</span>) rnz (œà&#39;(i) `[<span class="mi">2</span>]) = <span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> f l := 
    rnz (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(<span class="mi">0</span> &lt;= i &lt;  <span class="mi">2</span>) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
         (l * <span class="mi">2</span> ^ l)%:R).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>f</var><span><span class="hyp-body"><b>:=</b><span><span class="kr">fun</span> <span class="nv">l</span> : nat =&gt;
rnz
  (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">2</span>) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
   (l * <span class="mi">2</span> ^ l)%:R)</span></span><span class="hyp-type"><b>:</b><span>nat -&gt; nat</span></span></span></div></div><span class="goal-separator"><hr></span><q>366</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (eq_bigr f) =&gt; [|i _]; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">rewrite</span> psi_aux_sintE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>36a</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">3</span>) f i = <span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> /f /= <span class="nb">unlock</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span>  <span class="nf">psi_sint3</span> : psi `[<span class="mi">3</span>] = <span class="mi">4</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[<span class="mi">3</span>]) = <span class="mi">4</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>371</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi psi_auxb_sint.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(l &lt; <span class="mi">4</span>) rnz (œà&#39;(l) `[<span class="mi">3</span>]) = <span class="mi">4</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(big_mkord xpredT (<span class="kr">fun</span> <span class="nv">l</span> =&gt; rnz (psi_aux l _))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">4</span>) rnz (œà&#39;(i) `[<span class="mi">3</span>]) = <span class="mi">4</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> f l := 
    rnz (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(<span class="mi">0</span> &lt;= i &lt;  <span class="mi">3</span>) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
         (l * <span class="mi">2</span> ^ l)%:R).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>f</var><span><span class="hyp-body"><b>:=</b><span><span class="kr">fun</span> <span class="nv">l</span> : nat =&gt;
rnz
  (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">3</span>) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
   (l * <span class="mi">2</span> ^ l)%:R)</span></span><span class="hyp-type"><b>:</b><span>nat -&gt; nat</span></span></span></div></div><span class="goal-separator"><hr></span><q>37c</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (eq_bigr f) =&gt; [|i _]; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">rewrite</span> psi_aux_sintE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>380</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\max_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">4</span>) f i = <span class="mi">4</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> /f /= <span class="nb">unlock</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_aux_incr</span> <span class="nv">n</span> <span class="nv">l</span> :
  l &lt; (troot n).-<span class="mi">1</span> -&gt; (psi_aux l `[n] &lt;= psi_aux l.+<span class="mi">1</span> `[n])%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2f9</q><span class="goal-separator"><hr></span><div class="goal-conclusion">l &lt; (‚àán).-<span class="mi">1</span> -&gt; (œà&#39;(l) `[n] &lt;= œà&#39;(l.+<span class="mi">1</span>) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>387</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; lLr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><div><var>lLr</var><span class="hyp-type"><b>:</b><span>l &lt; (‚àán).-<span class="mi">1</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) `[n] &lt;= œà&#39;(l.+<span class="mi">1</span>) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> dlLn : delta l.+<span class="mi">2</span> &lt;= n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>38e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">Œîl.+<span class="mi">2</span> &lt;= n</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>38f</q><div><var>dlLn</var><span class="hyp-type"><b>:</b><span>Œîl.+<span class="mi">2</span> &lt;= n</span></span></div></div><label class="goal-separator"><hr></label><q>390</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -root_delta_le -subn_gt0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>38e</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt; ‚àán - l.+<span class="mi">1</span></div></blockquote><q>395</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -[l.+<span class="mi">1</span>]addn1 addnC subnDA subn_gt0 subn1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>397</q><span class="goal-separator"><hr></span><q>390</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> psi_auxE_lt psi_auxE_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>397</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- `[n] | (‚àái &lt;= l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l * <span class="mi">2</span> ^ l)%:R &lt;=
 ((<span class="mi">2</span> ^ l.+<span class="mi">1</span> *
   #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- `[n] | (‚àái &lt; l.+<span class="mi">1</span>)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> s := \sum_(_ &lt;- _ | _) _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>38f</q><q>398</q><div><var>s</var><span><span class="hyp-body"><b>:=</b><span>\sum_(H &lt;- `[n] | ‚àáH &lt;= l) <span class="mi">2</span> ^ ‚àáH</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  s)%:R - (l * <span class="mi">2</span> ^ l)%:R &lt;=
 ((<span class="mi">2</span> ^ l.+<span class="mi">1</span> *
   #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R -
 (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> -&gt; : [fset i <span class="kr">in</span> `[n] | l &lt; troot i] = [fset i <span class="kr">in</span> `[n] | delta l.+<span class="mi">1</span> &lt;= i].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3a7</q><span class="goal-separator"><hr></span><div class="goal-conclusion">[fset i | i <span class="kr">in</span> `[n] &amp; l &lt; ‚àái] =
[fset i | i <span class="kr">in</span> `[n] &amp; Œîl.+<span class="mi">1</span> &lt;= i]</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>3a7</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(((<span class="mi">2</span> ^ l *
   #|` [fset i | i <span class="kr">in</span> `[n] &amp; (Œîl.+<span class="mi">1</span> &lt;= i)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  s)%:R - (l * <span class="mi">2</span> ^ l)%:R &lt;=
 ((<span class="mi">2</span> ^ l.+<span class="mi">1</span> *
   #|` [fset i | i <span class="kr">in</span> `[n] &amp; (Œîl.+<span class="mi">1</span> &lt;= i)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  s)%:R - (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">   </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>/fsetP =&gt; i; <span class="nb">rewrite</span> !inE root_delta_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3a7</q><span class="goal-separator"><hr></span><q>3b0</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /(sint_sub n)-&gt; : <span class="mi">0</span> &lt;= delta l.+<span class="mi">1</span> <span class="bp">by</span> <span class="nb">apply</span>: delta_le (_ : <span class="mi">0</span> &lt;= l.+<span class="mi">1</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3a7</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l * #|` sint (Œîl.+<span class="mi">1</span>) n|.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R -
 (l * <span class="mi">2</span> ^ l)%:R &lt;=
 ((<span class="mi">2</span> ^ l.+<span class="mi">1</span> * #|` sint (Œîl.+<span class="mi">1</span>) n|.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R -
 (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> card_sint //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3a7</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l * (n - Œîl.+<span class="mi">1</span>).+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R &lt;=
 ((<span class="mi">2</span> ^ l.+<span class="mi">1</span> * (n - Œîl.+<span class="mi">1</span>).+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R -
 (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> c := n - _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>38f</q><q>398</q><q>3a8</q><div><var>c</var><span><span class="hyp-body"><b>:=</b><span>n - Œîl.+<span class="mi">1</span></span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R &lt;=
 ((<span class="mi">2</span> ^ l.+<span class="mi">1</span> * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> expnS mulnAC [<span class="mi">2</span> * _ * _]mulnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3bf</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R &lt;=
 ((<span class="mi">2</span> ^ l * (<span class="mi">2</span> * c.+<span class="mi">1</span>)).-<span class="mi">1</span> + s)%:R -
 (l.+<span class="mi">1</span> * (<span class="mi">2</span> * <span class="mi">2</span> ^ l))%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mul2n mulnA muln2 -!addnn -[(_ + l.+<span class="mi">1</span>)%nat]addSnnS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3bf</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R &lt;=
 ((<span class="mi">2</span> ^ l * (c.+<span class="mi">1</span> + c.+<span class="mi">1</span>)).-<span class="mi">1</span> + s)%:R -
 ((l.+<span class="mi">2</span> + l) * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mulnDl mulnDr prednDr ?(muln_gt0, expn_gt0) //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3bf</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R &lt;=
 (<span class="mi">2</span> ^ l * c.+<span class="mi">1</span> + (<span class="mi">2</span> ^ l * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R -
 (l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l + l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> x := <span class="mi">2</span> ^ _ * _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>38f</q><q>398</q><q>3a8</q><q>3c0</q><div><var>x</var><span><span class="hyp-body"><b>:=</b><span><span class="mi">2</span> ^ l * c.+<span class="mi">1</span></span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((x.-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R &lt;=
 (x + x.-<span class="mi">1</span> + s)%:R - (l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l + l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -[(_ + _ + s)%nat]addnA [(x + _)%nat]addnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3d1</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((x.-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R &lt;=
 (x.-<span class="mi">1</span> + s + x)%:R - (l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l + l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [((_ + _ * _)%:R)%R]natrD opprD addrA ler_sub //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3d1</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((x.-<span class="mi">1</span> + s)%:R &lt;=
 (x.-<span class="mi">1</span> + s + x)%:R - (l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_subr_addr [((_ + x)%:R)%R]natrD ler_add //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3d1</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l)%:R &lt;= x%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3d1</q><span class="goal-separator"><hr></span><div class="goal-conclusion">l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l &lt;= x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mulnC leq_mul2l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3d1</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ l == <span class="mi">0</span>) || (l.+<span class="mi">1</span> &lt; c.+<span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -subSn; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3d1</q><span class="goal-separator"><hr></span><div class="goal-conclusion">Œîl.+<span class="mi">1</span> &lt;= n</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>3d1</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(<span class="mi">2</span> ^ l == <span class="mi">0</span>) || (l.+<span class="mi">1</span> &lt; n.+<span class="mi">1</span> - Œîl.+<span class="mi">1</span>)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (_ : delta l.+<span class="mi">2</span> &lt;= _); <span class="kp">first</span> <span class="bp">by</span> <span class="bp">by</span> <span class="nb">apply</span>: delta_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3d1</q><span class="goal-separator"><hr></span><q>394</q></blockquote><q>3ec</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: leq_trans dlLn _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3d1</q><span class="goal-separator"><hr></span><q>3ee</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> ltn_subRL -addnS -deltaS (leq_trans dlLn) <span class="nl">?orbT</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_aux_decr</span> <span class="nv">n</span> <span class="nv">l</span> :
  (troot n).-<span class="mi">1</span> &lt;= l -&gt; (psi_aux l.+<span class="mi">1</span> `[n] &lt;= psi_aux l `[n])%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2f9</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(‚àán).-<span class="mi">1</span> &lt;= l -&gt; (œà&#39;(l.+<span class="mi">1</span>) `[n] &lt;= œà&#39;(l) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>3f6</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; rLl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><div><var>rLl</var><span class="hyp-type"><b>:</b><span>(‚àán).-<span class="mi">1</span> &lt;= l</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l.+<span class="mi">1</span>) `[n] &lt;= œà&#39;(l) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> dlLn : n &lt; delta l.+<span class="mi">2</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3fd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">n &lt; Œîl.+<span class="mi">2</span></div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>3fe</q><div><var>dlLn</var><span class="hyp-type"><b>:</b><span>n &lt; Œîl.+<span class="mi">2</span></span></span></div></div><label class="goal-separator"><hr></label><q>3ff</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ltnNge -root_delta_le -subn_gt0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>3fd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">~~ (<span class="mi">0</span> &lt; ‚àán - l.+<span class="mi">1</span>)</div></blockquote><q>404</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -[l.+<span class="mi">1</span>]addn1 addnC subnDA subn_gt0 subn1 -ltnNge.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>406</q><span class="goal-separator"><hr></span><q>3ff</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> psi_auxE_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>406</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l.+<span class="mi">1</span> *
   #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- `[n] | (‚àái &lt; l.+<span class="mi">1</span>)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R &lt;= œà&#39;(l) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> psi_auxE_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>406</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l.+<span class="mi">1</span> *
   #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- `[n] | (‚àái &lt; l.+<span class="mi">1</span>)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R &lt;=
 ((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- `[n] | (‚àái &lt;= l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> s := \sum_(_ &lt;- _ | _) _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>3fe</q><q>407</q><div><var>s</var><span><span class="hyp-body"><b>:=</b><span>\sum_(H &lt;- `[n] | ‚àáH &lt; l.+<span class="mi">1</span>) <span class="mi">2</span> ^ ‚àáH</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l.+<span class="mi">1</span> *
   #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R -
 (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R &lt;=
 ((<span class="mi">2</span> ^ l * #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  s)%:R - (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> -&gt; : [fset i <span class="kr">in</span> `[n] | l &lt; troot i] = 
          [fset i <span class="kr">in</span> `[n] | delta l.+<span class="mi">1</span> &lt;= i].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>41a</q><span class="goal-separator"><hr></span><q>3ad</q></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>41a</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(((<span class="mi">2</span> ^ l.+<span class="mi">1</span> *
   #|` [fset i | i <span class="kr">in</span> `[n] &amp; (Œîl.+<span class="mi">1</span> &lt;= i)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  s)%:R - (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R &lt;=
 ((<span class="mi">2</span> ^ l *
   #|` [fset i | i <span class="kr">in</span> `[n] &amp; (Œîl.+<span class="mi">1</span> &lt;= i)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  s)%:R - (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>/fsetP =&gt; i; <span class="nb">rewrite</span> !inE root_delta_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>41a</q><span class="goal-separator"><hr></span><q>422</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /(sint_sub n)-&gt; : <span class="mi">0</span> &lt;= delta l.+<span class="mi">1</span> <span class="bp">by</span> <span class="nb">apply</span>: delta_le (_ : <span class="mi">0</span> &lt;= l.+<span class="mi">1</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>41a</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l.+<span class="mi">1</span> * #|` sint (Œîl.+<span class="mi">1</span>) n|.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R -
 (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R &lt;=
 ((<span class="mi">2</span> ^ l * #|` sint (Œîl.+<span class="mi">1</span>) n|.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R -
 (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> card_sint //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>41a</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l.+<span class="mi">1</span> * (n - Œîl.+<span class="mi">1</span>).+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R -
 (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R &lt;=
 ((<span class="mi">2</span> ^ l * (n - Œîl.+<span class="mi">1</span>).+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> c := n - _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>3fe</q><q>407</q><q>41b</q><q>3c0</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l.+<span class="mi">1</span> * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l.+<span class="mi">1</span> * <span class="mi">2</span> ^ l.+<span class="mi">1</span>)%:R &lt;=
 ((<span class="mi">2</span> ^ l * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> expnS mulnAC [<span class="mi">2</span> * _ * _]mulnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>431</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l * (<span class="mi">2</span> * c.+<span class="mi">1</span>)).-<span class="mi">1</span> + s)%:R -
 (l.+<span class="mi">1</span> * (<span class="mi">2</span> * <span class="mi">2</span> ^ l))%:R &lt;=
 ((<span class="mi">2</span> ^ l * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mul2n mulnA muln2 -!addnn -[(_ + l.+<span class="mi">1</span>)%nat]addSnnS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>431</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l * (c.+<span class="mi">1</span> + c.+<span class="mi">1</span>)).-<span class="mi">1</span> + s)%:R -
 ((l.+<span class="mi">2</span> + l) * <span class="mi">2</span> ^ l)%:R &lt;=
 ((<span class="mi">2</span> ^ l * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mulnDl mulnDr prednDr ?(muln_gt0, expn_gt0) //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>431</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l * c.+<span class="mi">1</span> + (<span class="mi">2</span> ^ l * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R -
 (l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l + l * <span class="mi">2</span> ^ l)%:R &lt;=
 ((<span class="mi">2</span> ^ l * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> x := <span class="mi">2</span> ^ _ * _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>3fe</q><q>407</q><q>41b</q><q>3c0</q><q>3d2</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((x + x.-<span class="mi">1</span> + s)%:R - (l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l + l * <span class="mi">2</span> ^ l)%:R &lt;=
 (x.-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -[(_ + s)%nat]addnA [(x + _)%nat]addnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>442</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((x.-<span class="mi">1</span> + s + x)%:R - (l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l + l * <span class="mi">2</span> ^ l)%:R &lt;=
 (x.-<span class="mi">1</span> + s)%:R - (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [((_ + _ * _)%:R)%R]natrD opprD addrA ler_sub //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>442</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((x.-<span class="mi">1</span> + s + x)%:R - (l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l)%:R &lt;=
 (x.-<span class="mi">1</span> + s)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_subl_addr [((_ + x)%:R)%R]natrD ler_add //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>442</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(x%:R &lt;= (l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>442</q><span class="goal-separator"><hr></span><div class="goal-conclusion">x &lt;= l.+<span class="mi">2</span> * <span class="mi">2</span> ^ l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mulnC leq_mul2l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>442</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ l == <span class="mi">0</span>) || (c &lt; l.+<span class="mi">2</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -[l.+<span class="mi">2</span>](addnK (delta l.+<span class="mi">1</span>)) addnC -deltaS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>442</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ l == <span class="mi">0</span>) || (c &lt; Œîl.+<span class="mi">2</span> - Œîl.+<span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ltn_sub2r <span class="nl">?orbT</span> // [X <span class="kr">in</span> _ &lt; X]deltaS //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>442</q><span class="goal-separator"><hr></span><div class="goal-conclusion">Œîl.+<span class="mi">1</span> &lt; Œîl.+<span class="mi">1</span> + l.+<span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> addnS ltnS leq_addr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_aux_sint</span> <span class="nv">n</span> : ((psi `[n])%:R)%R = psi_aux (troot n).-<span class="mi">1</span> `[n].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(`[n])%:R)%R = œà&#39;((‚àán).-<span class="mi">1</span>) `[n]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>461</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(`[n])%:R)%R == œà&#39;((‚àán).-<span class="mi">1</span>) `[n]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> eq_le psi_max andbT.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(`[n])%:R &lt;= œà&#39;((‚àán).-<span class="mi">1</span>) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: (psiE `[n]) =&gt; l -&gt;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2f9</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span>) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [E|E] := leqP (troot n).-<span class="mi">1</span> l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><div><var>E</var><span class="hyp-type"><b>:</b><span>(‚àán).-<span class="mi">1</span> &lt;= l</span></span></div></div><span class="goal-separator"><hr></span><q>470</q></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><div><var>E</var><span class="hyp-type"><b>:</b><span>l &lt; (‚àán).-<span class="mi">1</span></span></span></div></div><label class="goal-separator"><hr></label><q>470</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(subnK E).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>474</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l - (‚àán).-<span class="mi">1</span> + (‚àán).-<span class="mi">1</span>) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span>) `[n])%R</div></blockquote><q>476</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>: (_ - _) =&gt; [|k IH] //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>475</q><div><var>k</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><div><var>IH</var><span class="hyp-type"><b>:</b><span>(œà&#39;(k + (‚àán).-<span class="mi">1</span>) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span>) `[n])%R</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(k.+<span class="mi">1</span> + (‚àán).-<span class="mi">1</span>) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span>) `[n])%R</div></blockquote><q>476</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: le_trans IH.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>475</q><q>482</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(k.+<span class="mi">1</span> + (‚àán).-<span class="mi">1</span>) `[n] &lt;= œà&#39;(k + (‚àán).-<span class="mi">1</span>) `[n])%R</div></blockquote><q>476</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addSn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>488</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;((k + (‚àán).-<span class="mi">1</span>).+<span class="mi">1</span>) `[n] &lt;= œà&#39;(k + (‚àán).-<span class="mi">1</span>) `[n])%R</div></blockquote><q>476</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: psi_aux_decr =&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>488</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(‚àán).-<span class="mi">1</span> &lt;= k + (‚àán).-<span class="mi">1</span></div></blockquote><q>476</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> leq_addl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>478</q><span class="goal-separator"><hr></span><q>470</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(subKn (ltnW E)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>478</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;((‚àán).-<span class="mi">1</span> - ((‚àán).-<span class="mi">1</span> - l)) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span>) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>: (_ - l) =&gt; [|k IH].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>478</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;((‚àán).-<span class="mi">1</span> - <span class="mi">0</span>) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span>) `[n])%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>479</q><q>482</q><div><var>IH</var><span class="hyp-type"><b>:</b><span>(œà&#39;((‚àán).-<span class="mi">1</span> - k) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span>) `[n])%R</span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">(œà&#39;((‚àán).-<span class="mi">1</span> - k.+<span class="mi">1</span>) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span>) `[n])%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> subn0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>49f</q><span class="goal-separator"><hr></span><q>4a1</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: le_trans IH.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>479</q><q>482</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;((‚àán).-<span class="mi">1</span> - k.+<span class="mi">1</span>) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span> - k) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> subnS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4a8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(((‚àán).-<span class="mi">1</span> - k).-<span class="mi">1</span>) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span> - k) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [|E1] := leqP (troot n).-<span class="mi">1</span> k.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4a8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(‚àán).-<span class="mi">1</span> &lt;= k -&gt;
(œà&#39;(((‚àán).-<span class="mi">1</span> - k).-<span class="mi">1</span>) `[n] &lt;= œà&#39;((‚àán).-<span class="mi">1</span> - k) `[n])%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>479</q><q>482</q><div><var>E1</var><span class="hyp-type"><b>:</b><span>k &lt; (‚àán).-<span class="mi">1</span></span></span></div></div><label class="goal-separator"><hr></label><q>4ad</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -subn_eq0 =&gt; /eqP-&gt;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4b4</q><span class="goal-separator"><hr></span><q>4ad</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -{<span class="mi">2</span>}[_-_]prednK <span class="nl">?subn_gt0</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4b4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(((‚àán).-<span class="mi">1</span> - k).-<span class="mi">1</span>) `[n] &lt;=
 œà&#39;(((‚àán).-<span class="mi">1</span> - k).-<span class="mi">1</span>.+<span class="mi">1</span>) `[n])%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: psi_aux_incr =&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4b4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((‚àán).-<span class="mi">1</span> - k).-<span class="mi">1</span> &lt; (‚àán).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: _.<span class="mf">-1 E1</span> =&gt; // u _; <span class="nb">case</span>: k =&gt; // k.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>2fa</q><q>479</q><div><var>u, k</var><span class="hyp-type"><b>:</b><span>nat</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(u.+<span class="mi">1</span> - k.+<span class="mi">1</span>).-<span class="mi">1</span> &lt; u.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (_ : u.+<span class="mi">1</span>.-<span class="mi">1</span> &lt; u.+<span class="mi">1</span>) =&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4c4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(u.+<span class="mi">1</span> - k.+<span class="mi">1</span>).-<span class="mi">1</span> &lt; u.+<span class="mi">1</span>.-<span class="mi">1</span>.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> ltnS -!subn1 leq_sub2r // leq_subr.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* This is 2.2 *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_sint_phi</span> <span class="nv">n</span> : (psi `[n]).*<span class="mi">2</span> = (phi n.+<span class="mi">1</span>).-<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[n]).*<span class="mi">2</span> = œï(n.+<span class="mi">1</span>).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>4cc</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [|nP] := leqP n <span class="mi">0</span>; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">case</span>: (n)=&gt; //; <span class="nb">rewrite</span> psi_sint0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><div><var>nP</var><span class="hyp-type"><b>:</b><span><span class="mi">0</span> &lt; n</span></span></div></div><span class="goal-separator"><hr></span><q>4ce</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/eqP; <span class="nb">rewrite</span> -(eqr_nat int_numDomainType).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(`[n]).*<span class="mi">2</span>%:R)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -muln2 natrM mulr_natr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(`[n])%:R *+ <span class="mi">2</span>)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> psi_aux_sint // psi_auxE_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((((<span class="mi">2</span> ^ (‚àán).-<span class="mi">1</span> *
    #|` [fset i | i <span class="kr">in</span> `[n] &amp; ((‚àán).-<span class="mi">1</span> &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
   \sum_(i &lt;- `[n] | (‚àái &lt;= (‚àán).-<span class="mi">1</span>)%N) <span class="mi">2</span> ^ ‚àái)%:R -
  ((‚àán).-<span class="mi">1</span> * <span class="mi">2</span> ^ (‚àán).-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R ==
(œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (_ : [fset _ <span class="kr">in</span> _ | _] = [fset i <span class="kr">in</span> `[n] | delta (troot n) &lt;= i]);
   <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><div class="goal-conclusion">[fset H
   | H <span class="kr">in</span> mem_fin (fset_finpred `[n])
   &amp; (‚àán).-<span class="mi">1</span> &lt; ‚àáH] = [fset i | i <span class="kr">in</span> `[n] &amp; Œî(‚àán) &lt;= i]</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>4d3</q><label class="goal-separator"><hr></label><div class="goal-conclusion">((((<span class="mi">2</span> ^ (‚àán).-<span class="mi">1</span> *
    #|` [fset i | i <span class="kr">in</span> `[n] &amp; (Œî(‚àán) &lt;= i)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
   \sum_(i &lt;- `[n] | (‚àái &lt;= (‚àán).-<span class="mi">1</span>)%N) <span class="mi">2</span> ^ ‚àái)%:R -
  ((‚àán).-<span class="mi">1</span> * <span class="mi">2</span> ^ (‚àán).-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R ==
(œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/fsetP=&gt; i; <span class="nb">rewrite</span> !inE; <span class="nb">congr</span> (_ &amp;&amp; _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><q>11f</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((‚àán).-<span class="mi">1</span> &lt; ‚àái) = (Œî(‚àán) &lt;= i)</div></blockquote><q>4e5</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> prednK <span class="nl">?troot_gt0</span> // root_delta_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><q>4e7</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> sint_sub <span class="nl">?delta_gt0</span> <span class="nl">?troot_gt0</span> // card_sint //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((((<span class="mi">2</span> ^ (‚àán).-<span class="mi">1</span> * (n - Œî(‚àán)).+<span class="mi">1</span>).-<span class="mi">1</span> +
   \sum_(i &lt;- `[n] | (‚àái &lt;= (‚àán).-<span class="mi">1</span>)%N) <span class="mi">2</span> ^ ‚àái)%:R -
  ((‚àán).-<span class="mi">1</span> * <span class="mi">2</span> ^ (‚àán).-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R ==
(œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (_ : \sum_(i &lt;- _ | _) _  = phi (delta (troot n))); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- `[n] | ‚àái &lt;= (‚àán).-<span class="mi">1</span>) <span class="mi">2</span> ^ ‚àái = œï(Œî(‚àán))</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>4d3</q><label class="goal-separator"><hr></label><div class="goal-conclusion">((((<span class="mi">2</span> ^ (‚àán).-<span class="mi">1</span> * (n - Œî(‚àán)).+<span class="mi">1</span>).-<span class="mi">1</span> + œï(Œî(‚àán)))%:R -
  ((‚àán).-<span class="mi">1</span> * <span class="mi">2</span> ^ (‚àán).-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R ==
(œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> phiE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- `[n] | ‚àái &lt;= (‚àán).-<span class="mi">1</span>) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œî(‚àán)) <span class="mi">2</span> ^ ‚àái</div></blockquote><q>4f8</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [RHS](eq_bigl 
        (<span class="kr">fun</span> <span class="nv">i</span> : &#39;I_ _ =&gt; (i : nat) \<span class="kr">in</span> (enum_fset `[n]))); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><div class="goal-conclusion">xpredT =<span class="mi">1</span> (<span class="kr">fun</span> <span class="nv">i</span> : &#39;I_(Œî(‚àán)) =&gt; i \<span class="kr">in</span> `[n])</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>4d3</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- `[n] | ‚àái &lt;= (‚àán).-<span class="mi">1</span>) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œî(‚àán) | i \<span class="kr">in</span> `[n]) <span class="mi">2</span> ^ ‚àái</div></blockquote><q>4f9</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><div><var>i</var><span class="hyp-type"><b>:</b><span>&#39;I_(Œî(‚àán))</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">true = (i \<span class="kr">in</span> `[n])</div></blockquote><q>503</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> mem_sint leq0n (leq_trans (ltn_ord _)) // delta_root_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><q>505</q></blockquote><q>4f8</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>: enum_fset (fset_uniq `[n]) =&gt; /= [_|a l IH /andP[aNIl lU]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- [::] | ‚àái &lt;= (‚àán).-<span class="mi">1</span>) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œî(‚àán) | i \<span class="kr">in</span> [::]) <span class="mi">2</span> ^ ‚àái</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><q>a</q><div><var>l</var><span class="hyp-type"><b>:</b><span>seq nat</span></span></div><div><var>IH</var><span class="hyp-type"><b>:</b><span>uniq l -&gt;
\sum_(i &lt;- l | ‚àái &lt;= (‚àán).-<span class="mi">1</span>) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œî(‚àán) | i \<span class="kr">in</span> l) <span class="mi">2</span> ^ ‚àái</span></span></div><div><var>aNIl</var><span class="hyp-type"><b>:</b><span>a \notin l</span></span></div><div><var>lU</var><span class="hyp-type"><b>:</b><span>uniq l</span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- (a :: l) | ‚àái &lt;= (‚àán).-<span class="mi">1</span>) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œî(‚àán) | i \<span class="kr">in</span> a :: l) <span class="mi">2</span> ^ ‚àái</div></blockquote><q>4f9</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> big_nil big1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>515</q><span class="goal-separator"><hr></span><q>51a</q></blockquote><q>4f8</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> big_cons /= IH //; <span class="nb">case</span>: leqP =&gt; aLb; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><q>a</q><q>516</q><q>517</q><q>518</q><q>519</q><div><var>aLb</var><span class="hyp-type"><b>:</b><span>(‚àán).-<span class="mi">1</span> &lt; ‚àáa</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt; Œî(‚àán) | i \<span class="kr">in</span> l) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œî(‚àán) | i \<span class="kr">in</span> a :: l) <span class="mi">2</span> ^ ‚àái</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><q>a</q><q>516</q><q>517</q><q>518</q><q>519</q><div><var>aLb</var><span class="hyp-type"><b>:</b><span>‚àáa &lt;= (‚àán).-<span class="mi">1</span></span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">(<span class="mi">2</span> ^ ‚àáa + \sum_(i &lt; Œî(‚àán) | i \<span class="kr">in</span> l) <span class="mi">2</span> ^ ‚àái)%N =
\sum_(i &lt; Œî(‚àán) | i \<span class="kr">in</span> a :: l) <span class="mi">2</span> ^ ‚àái</div></blockquote><q>4f9</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> prednK <span class="nl">?troot_gt0</span> // <span class="kr">in</span> aLb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><q>a</q><q>516</q><q>517</q><q>518</q><q>519</q><div><var>aLb</var><span class="hyp-type"><b>:</b><span>‚àán &lt;= ‚àáa</span></span></div></div><span class="goal-separator"><hr></span><q>523</q></blockquote><q>524</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: eq_bigl =&gt; i; <span class="nb">rewrite</span> inE eqn_leq [a &lt;= i]leqNgt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><q>a</q><q>516</q><q>517</q><q>518</q><q>519</q><q>52d</q><q>50a</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(i \<span class="kr">in</span> l) = (i &lt;= a) &amp;&amp; ~~ (i &lt; a) || (i \<span class="kr">in</span> l)</div></blockquote><q>524</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> (leq_trans (ltn_ord i)) <span class="nl">?andbF</span> // -root_delta_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>526</q><span class="goal-separator"><hr></span><q>528</q></blockquote><q>4f8</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> aLn : a &lt; Œî(‚àán).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>526</q><span class="goal-separator"><hr></span><div class="goal-conclusion">a &lt; Œî(‚àán)</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><q>a</q><q>516</q><q>517</q><q>518</q><q>519</q><q>527</q><div><var>aLn</var><span class="hyp-type"><b>:</b><span>a &lt; Œî(‚àán)</span></span></div></div><label class="goal-separator"><hr></label><q>528</q></blockquote><q>4f9</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -root_delta_lt -[troot n]prednK // troot_gt0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>53c</q><span class="goal-separator"><hr></span><q>528</q></blockquote><q>4f8</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [RHS](bigD1 (Ordinal aLn)) ?(inE, eqxx) //=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>53c</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ ‚àáa + \sum_(i &lt; Œî(‚àán) | i \<span class="kr">in</span> l) <span class="mi">2</span> ^ ‚àái)%N =
(<span class="mi">2</span> ^ ‚àáa +
 \sum_(i &lt; Œî(‚àán) | (i \<span class="kr">in</span> a :: l) &amp;&amp;
                   (i != Ordinal aLn)) <span class="mi">2</span> ^ ‚àái)%N</div></blockquote><q>4f8</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">congr</span> ((_ + _)%nat).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>53c</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt; Œî(‚àán) | i \<span class="kr">in</span> l) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œî(‚àán) | (i \<span class="kr">in</span> a :: l) &amp;&amp; (i != Ordinal aLn))
   <span class="mi">2</span> ^ ‚àái</div></blockquote><q>4f8</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: eq_bigl =&gt; i; <span class="nb">rewrite</span> inE -val_eqE /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><q>a</q><q>516</q><q>517</q><q>518</q><q>519</q><q>527</q><q>53d</q><q>50a</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(i \<span class="kr">in</span> l) = ((i == a) || (i \<span class="kr">in</span> l)) &amp;&amp; (i != a)</div></blockquote><q>4f8</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: (_ =P _); <span class="nb">rewrite</span> <span class="nl">?andbT</span> // =&gt; -&gt;; <span class="nb">rewrite</span> (negPf aNIl).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>4d3</q><span class="goal-separator"><hr></span><q>4fa</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> m := troot n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><div><var>m</var><span><span class="hyp-body"><b>:=</b><span>‚àán</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((((<span class="mi">2</span> ^ m.-<span class="mi">1</span> * (n - Œîm).+<span class="mi">1</span>).-<span class="mi">1</span> + œï(Œîm))%:R -
  (m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m.-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -[n - _]/(tmod n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>554</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((((<span class="mi">2</span> ^ m.-<span class="mi">1</span> * (tmod n).+<span class="mi">1</span>).-<span class="mi">1</span> + œï(Œîm))%:R -
  (m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m.-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> p := tmod n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>4d4</q><q>555</q><div><var>p</var><span><span class="hyp-body"><b>:=</b><span>tmod n</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((((<span class="mi">2</span> ^ m.-<span class="mi">1</span> * p.+<span class="mi">1</span>).-<span class="mi">1</span> + œï(Œîm))%:R -
  (m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m.-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> phi_deltaE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((((<span class="mi">2</span> ^ m.-<span class="mi">1</span> * p.+<span class="mi">1</span>).-<span class="mi">1</span> + (<span class="mi">1</span> + m * <span class="mi">2</span> ^ m - <span class="mi">2</span> ^ m))%:R -
  (m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m.-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp"><span class="c">(* taking care of  m * 2 ^ m - 2 ^ m *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -{<span class="mi">2</span>}[m]prednK <span class="nl">?troot_gt0</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((((<span class="mi">2</span> ^ m.-<span class="mi">1</span> * p.+<span class="mi">1</span>).-<span class="mi">1</span> +
   (<span class="mi">1</span> + m.-<span class="mi">1</span>.+<span class="mi">1</span> * <span class="mi">2</span> ^ m - <span class="mi">2</span> ^ m))%:R -
  (m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m.-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mulSn addnCA [(<span class="mi">2</span> ^ _ + _)%nat]addnC addnK add1n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((((<span class="mi">2</span> ^ m.-<span class="mi">1</span> * p.+<span class="mi">1</span>).-<span class="mi">1</span> + (m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m).+<span class="mi">1</span>)%:R -
  (m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m.-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addnS -addSn prednK; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt; <span class="mi">2</span> ^ m.-<span class="mi">1</span> * p.+<span class="mi">1</span></div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>55e</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(((<span class="mi">2</span> ^ m.-<span class="mi">1</span> * p.+<span class="mi">1</span> + m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m)%:R -
  (m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m.-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> muln_gt0 expn_gt0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><q>573</q></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp"><span class="c">(* taking care of m.-1 * 2 ^ m - m.-1 * 2 ^ m.-1 *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -{<span class="mi">3</span>}[m]prednK <span class="nl">?troot_gt0</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ m.-<span class="mi">1</span> * p.+<span class="mi">1</span> + m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m.-<span class="mi">1</span>.+<span class="mi">1</span>)%:R -
  (m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m.-<span class="mi">1</span>)%:R) *+ <span class="mi">2</span>)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> expnS mul2n -addnn mulnDr addnA natrD addrK.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ m.-<span class="mi">1</span> * p.+<span class="mi">1</span> + m.-<span class="mi">1</span> * <span class="mi">2</span> ^ m.-<span class="mi">1</span>)%:R *+ <span class="mi">2</span>)%R ==
(œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mulnC -mulnDl addSnnS prednK <span class="nl">?troot_gt0</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((p + m) * <span class="mi">2</span> ^ m.-<span class="mi">1</span>)%:R *+ <span class="mi">2</span>)%R == (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -mulr_natr -natrM muln2 eqr_nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((p + m) * <span class="mi">2</span> ^ m.-<span class="mi">1</span>).*<span class="mi">2</span> == œï(n.+<span class="mi">1</span>).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> phi_modSE -/m -/p.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((p + m) * <span class="mi">2</span> ^ m.-<span class="mi">1</span>).*<span class="mi">2</span> == (<span class="mi">1</span> + (m + p) * <span class="mi">2</span> ^ m).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> add1n -pred_Sn addnC -{<span class="mi">4</span>}[m]prednK <span class="nl">?troot_gt0</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>55e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((m + p) * <span class="mi">2</span> ^ m.-<span class="mi">1</span>).*<span class="mi">2</span> == (m + p) * <span class="mi">2</span> ^ m.-<span class="mi">1</span>.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> expnS mulnCA mul2n.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_sint_leq</span> <span class="nv">a</span> <span class="nv">b</span> : a &lt;= b -&gt; psi `[a] &lt;= psi `[b].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>a, b</var><span class="hyp-type"><b>:</b><span>nat</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a &lt;= b -&gt; œà(`[a]) &lt;= œà(`[b])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>590</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; aLb; <span class="nb">apply</span>: psi_sub; <span class="nb">apply</span>/fsubsetP=&gt; i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>593</q><div><var>aLb</var><span class="hyp-type"><b>:</b><span>a &lt;= b</span></span></div><q>11f</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i \<span class="kr">in</span> `[a] -&gt; i \<span class="kr">in</span> `[b]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> !mem_sint /= =&gt; iLa; <span class="nb">apply</span>: leq_trans aLb.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_sintS</span> <span class="nv">n</span> : (psi `[n.+<span class="mi">1</span>] = psi `[n] + <span class="mi">2</span> ^ (troot n.+<span class="mi">1</span>).-<span class="mi">1</span>)%nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[n.+<span class="mi">1</span>]) = (œà(`[n]) + <span class="mi">2</span> ^ (‚àán.+<span class="mi">1</span>).-<span class="mi">1</span>)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>59d</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> F : <span class="mi">0</span> &lt; phi n.+<span class="mi">1</span> <span class="bp">by</span> <span class="nb">apply</span>: phi_le (_ : <span class="mi">1</span> &lt;= _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><div><var>F</var><span class="hyp-type"><b>:</b><span><span class="mi">0</span> &lt; œï(n.+<span class="mi">1</span>)</span></span></div></div><span class="goal-separator"><hr></span><q>59f</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: double_inj; <span class="nb">rewrite</span> doubleD.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>5a4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[n.+<span class="mi">1</span>]).*<span class="mi">2</span> = (œà(`[n]).*<span class="mi">2</span> + (<span class="mi">2</span> ^ (‚àán.+<span class="mi">1</span>).-<span class="mi">1</span>).*<span class="mi">2</span>)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> !psi_sint_phi //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>5a4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œï(n.+<span class="mi">2</span>).-<span class="mi">1</span> = (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span> + (<span class="mi">2</span> ^ (‚àán.+<span class="mi">1</span>).-<span class="mi">1</span>).*<span class="mi">2</span>)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -mul2n -expnS prednK <span class="nl">?troot_gt0</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>5a4</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œï(n.+<span class="mi">2</span>).-<span class="mi">1</span> = (œï(n.+<span class="mi">1</span>).-<span class="mi">1</span> + <span class="mi">2</span> ^ ‚àán.+<span class="mi">1</span>)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> phiE big_ord_recr -phiE prednDl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* This is 2.2 *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_leD</span> <span class="nv">a</span> <span class="nv">b</span> : psi `[a + b] &lt;= (psi `[a]).*<span class="mi">2</span> + <span class="mi">2</span> ^ (b.-<span class="mi">1</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>592</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[a + b]) &lt;= œà(`[a]).*<span class="mi">2</span> + <span class="mi">2</span> ^ b.-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>5b3</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: b =&gt; [|b]; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">rewrite</span> addn0 -addnn -addnA leq_addr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>592</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[a + b.+<span class="mi">1</span>]) &lt;= œà(`[a]).*<span class="mi">2</span> + <span class="mi">2</span> ^ b.+<span class="mi">1</span>.-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -leq_double doubleD [_.+<span class="mi">1</span>.-<span class="mi">1</span>]/=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>592</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[a + b.+<span class="mi">1</span>]).*<span class="mi">2</span> &lt;= (œà(`[a]).*<span class="mi">2</span>).*<span class="mi">2</span> + (<span class="mi">2</span> ^ b).*<span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> !psi_sint_phi -addSn -ltnS prednK <span class="nl">?phi_gt0</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>592</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œï(a.+<span class="mi">1</span> + b.+<span class="mi">1</span>) &lt;= ((œï(a.+<span class="mi">1</span>).-<span class="mi">1</span>).*<span class="mi">2</span> + (<span class="mi">2</span> ^ b).*<span class="mi">2</span>).+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (phi_leD _ _) _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>592</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œï(a.+<span class="mi">1</span>).*<span class="mi">2</span> + (<span class="mi">2</span> ^ b.+<span class="mi">1</span>).-<span class="mi">1</span> &lt;=
((œï(a.+<span class="mi">1</span>).-<span class="mi">1</span>).*<span class="mi">2</span> + (<span class="mi">2</span> ^ b).*<span class="mi">2</span>).+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -{<span class="mi">1</span>}[phi (a.+<span class="mi">1</span>)]prednK <span class="nl">?phi_gt0</span> // doubleS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>592</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œï(a.+<span class="mi">1</span>).-<span class="mi">1</span>).*<span class="mi">2</span>.+<span class="mi">2</span> + (<span class="mi">2</span> ^ b.+<span class="mi">1</span>).-<span class="mi">1</span> &lt;=
((œï(a.+<span class="mi">1</span>).-<span class="mi">1</span>).*<span class="mi">2</span> + (<span class="mi">2</span> ^ b).*<span class="mi">2</span>).+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> expnS mul2n -prednDr <span class="nl">?double_gt0</span> <span class="nl">?expn_gt0</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* This is 2.3 *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_SS_le</span> <span class="nv">n</span> : psi `[n.+<span class="mi">2</span>] &gt;= <span class="mi">2</span> ^(troot n).+<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ (‚àán).+<span class="mi">1</span> &lt;= œà(`[n.+<span class="mi">2</span>])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>5cc</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: n =&gt; [|n]; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">rewrite</span> psi_sint2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ (‚àán.+<span class="mi">1</span>).+<span class="mi">1</span> &lt;= œà(`[n.+<span class="mi">3</span>])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /psi_sint_leq/(leq_trans _)-&gt;// : (delta (troot n.+<span class="mi">1</span>)).+<span class="mi">2</span> &lt;= n.+<span class="mi">3</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(Œî(‚àán.+<span class="mi">1</span>)).+<span class="mi">1</span> &lt; n.+<span class="mi">3</span></div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>2dc</q><label class="goal-separator"><hr></label><div class="goal-conclusion"><span class="mi">2</span> ^ (‚àán.+<span class="mi">1</span>).+<span class="mi">1</span> &lt;= œà(`[(Œî(‚àán.+<span class="mi">1</span>)).+<span class="mi">2</span>])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> !ltnS -root_delta_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><q>5da</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> s := troot _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><div><var>s</var><span><span class="hyp-body"><b>:=</b><span>‚àán.+<span class="mi">1</span></span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ s.+<span class="mi">1</span> &lt;= œà(`[(Œîs).+<span class="mi">2</span>])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [|tLs] := leqP s <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>5e1</q><span class="goal-separator"><hr></span><div class="goal-conclusion">s &lt;= <span class="mi">1</span> -&gt; <span class="mi">2</span> ^ s.+<span class="mi">1</span> &lt;= œà(`[(Œîs).+<span class="mi">2</span>])</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>5e2</q><div><var>tLs</var><span class="hyp-type"><b>:</b><span><span class="mi">1</span> &lt; s</span></span></div></div><label class="goal-separator"><hr></label><q>5e3</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: s =&gt; [|[|]] //; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">rewrite</span> psi_sint2 ?(leq_trans _ thLN).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt; <span class="mi">1</span> -&gt; <span class="mi">2</span> ^ <span class="mi">2</span> &lt;= œà(`[(Œî1).+<span class="mi">2</span>])</div></blockquote><q>5e8</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> psi_sint3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>5ea</q><span class="goal-separator"><hr></span><q>5e3</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -leq_double psi_sint_phi phi_modSE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>5ea</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ s.+<span class="mi">1</span>).*<span class="mi">2</span> &lt;=
(<span class="mi">1</span> + (‚àá(Œîs).+<span class="mi">2</span> + tmod (Œîs).+<span class="mi">2</span>) * <span class="mi">2</span> ^ ‚àá(Œîs).+<span class="mi">2</span>).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> tE : troot (delta s).+<span class="mi">2</span> = s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>5ea</q><span class="goal-separator"><hr></span><div class="goal-conclusion">‚àá(Œîs).+<span class="mi">2</span> = s</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>5e2</q><q>5eb</q><div><var>tE</var><span class="hyp-type"><b>:</b><span>‚àá(Œîs).+<span class="mi">2</span> = s</span></span></div></div><label class="goal-separator"><hr></label><q>5f6</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>/eqP; <span class="nb">rewrite</span> trootE deltaS ltnW //= -addn2 addSnnS leq_add2l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>5fd</q><span class="goal-separator"><hr></span><q>5f6</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> tE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>5fd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ s.+<span class="mi">1</span>).*<span class="mi">2</span> &lt;= (<span class="mi">1</span> + (s + tmod (Œîs).+<span class="mi">2</span>) * <span class="mi">2</span> ^ s).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span>-&gt;: tmod (delta s).+<span class="mi">2</span> = <span class="mi">2</span> <span class="bp">by</span> <span class="nb">rewrite</span> /tmod tE -addn2 addnC addnK.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>5fd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ s.+<span class="mi">1</span>).*<span class="mi">2</span> &lt;= (<span class="mi">1</span> + (s + <span class="mi">2</span>) * <span class="mi">2</span> ^ s).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -mul2n expnS mulnA /= leq_mul2r (leq_add2r <span class="mi">2</span> <span class="mi">2</span>) tLs orbT.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_aux0_sint</span> <span class="nv">n</span> : psi_aux <span class="mi">0</span> `[n] = n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà&#39;(<span class="mi">0</span>) `[n] = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>60b</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi_aux add0n subr0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((\sum_(i &lt;- `[n]) <span class="mi">2</span> ^ minn (‚àái) <span class="mi">0</span>)%:R)%R = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/eqP; <span class="nb">rewrite</span> -natz eqr_nat; <span class="nb">apply</span>/eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- `[n]) <span class="mi">2</span> ^ minn (‚àái) <span class="mi">0</span> = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (eq_bigr (<span class="kr">fun</span> =&gt; <span class="mi">1</span>)) =&gt; [|i _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- `[n]) <span class="mi">1</span> = n</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>11f</q></div><label class="goal-separator"><hr></label><div class="goal-conclusion"><span class="mi">2</span> ^ minn (‚àái) <span class="mi">0</span> = <span class="mi">1</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> fsum_nat_const card_sint // subn0 muln1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>61d</q><span class="goal-separator"><hr></span><q>61e</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> minn0.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* This is 2.4.1 *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_sint_min</span> <span class="nv">n</span> : n &lt;= psi `[n].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">n &lt;= œà(`[n])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>623</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(ler_nat int_numDomainType).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(n%:R &lt;= œà(`[n])%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> natz -[X <span class="kr">in</span> (X &lt;= _)%R]psi_aux0_sint.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(<span class="mi">0</span>) `[n] &lt;= œà(`[n])%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: psi_max.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">sum_sint</span> (<span class="nv">F</span> : nat -&gt; nat) <span class="nv">n</span> : 
  \sum_(i &lt;- `[n]) F i  = \sum_(i &lt; n) F i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>F</var><span class="hyp-type"><b>:</b><span>nat -&gt; nat</span></span></div><q>1e</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- `[n]) F i = \sum_(i &lt; n) F i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>630</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> big_seq_cond.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>632</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- `[n] | (i \<span class="kr">in</span> `[n]) &amp;&amp; true) F i =
\sum_(i &lt; n) F i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [LHS](eq_bigl (<span class="kr">fun</span> <span class="nv">i</span> =&gt; (i &lt; n))); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>632</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">fun</span> <span class="nv">i</span> : nat =&gt; (i \<span class="kr">in</span> `[n]) &amp;&amp; true) =<span class="mi">1</span>
(<span class="kr">fun</span> <span class="nv">i</span> : nat =&gt; i &lt; n)</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>632</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- `[n] | i &lt; n) F i = \sum_(i &lt; n) F i</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>=&gt; i; <span class="nb">rewrite</span> mem_sint andbT.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>632</q><span class="goal-separator"><hr></span><q>640</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [RHS](eq_bigl 
        (<span class="kr">fun</span> <span class="nv">i</span> : &#39;I_ _ =&gt; ((i : nat) \<span class="kr">in</span> (enum_fset `[n])))); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>632</q><span class="goal-separator"><hr></span><div class="goal-conclusion">xpredT =<span class="mi">1</span> (<span class="kr">fun</span> <span class="nv">i</span> : &#39;I_n =&gt; i \<span class="kr">in</span> `[n])</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>632</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- `[n] | i &lt; n) F i =
\sum_(i &lt; n | i \<span class="kr">in</span> `[n]) F i</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>=&gt; i; <span class="nb">rewrite</span> mem_sint ltn_ord.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>632</q><span class="goal-separator"><hr></span><q>64a</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>: enum_fset (fset_uniq `[n]) =&gt; /= [_|a l IH /andP[aNIl lU]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>632</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- [::] | i &lt; n) F i =
\sum_(i &lt; n | i \<span class="kr">in</span> [::]) F i</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>633</q><div><var>n, a</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><q>516</q><div><var>IH</var><span class="hyp-type"><b>:</b><span>uniq l -&gt;
\sum_(i &lt;- l | i &lt; n) F i =
\sum_(i &lt; n | i \<span class="kr">in</span> l) F i</span></span></div><q>518</q><q>519</q></div><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- (a :: l) | i &lt; n) F i =
\sum_(i &lt; n | i \<span class="kr">in</span> a :: l) F i</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> big_nil big1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>654</q><span class="goal-separator"><hr></span><q>657</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> big_cons /= IH //; <span class="nb">case</span>: (boolP (a &lt; n)) =&gt; aLn; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>633</q><q>655</q><q>516</q><q>656</q><q>518</q><q>519</q><div><var>aLn</var><span class="hyp-type"><b>:</b><span>~~ (a &lt; n)</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt; n | i \<span class="kr">in</span> l) F i =
\sum_(i &lt; n | i \<span class="kr">in</span> a :: l) F i</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>633</q><q>655</q><q>516</q><q>656</q><q>518</q><q>519</q><div><var>aLn</var><span class="hyp-type"><b>:</b><span>a &lt; n</span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">(F a + \sum_(i &lt; n | i \<span class="kr">in</span> l) F i)%N =
\sum_(i &lt; n | i \<span class="kr">in</span> a :: l) F i</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: eq_bigl =&gt; i; <span class="nb">move</span>: (ltn_ord i); <span class="nb">rewrite</span> inE; <span class="nb">case</span>: eqP =&gt; [-&gt;| //].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>633</q><q>655</q><q>516</q><q>656</q><q>518</q><q>519</q><q>65f</q><q>225</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a &lt; n -&gt; (a \<span class="kr">in</span> l) = true || (a \<span class="kr">in</span> l)</div></blockquote><q>661</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> (negPf aLn).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>663</q><span class="goal-separator"><hr></span><q>665</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [RHS](bigD1 (Ordinal aLn)) ?(inE, eqxx) //=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>663</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(F a + \sum_(i &lt; n | i \<span class="kr">in</span> l) F i)%N =
(F a +
 \sum_(i &lt; n | (i \<span class="kr">in</span> a :: l) &amp;&amp; (i != Ordinal aLn))
    F i)%N</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">congr</span> ((_ + _)%nat).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>663</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt; n | i \<span class="kr">in</span> l) F i =
\sum_(i &lt; n | (i \<span class="kr">in</span> a :: l) &amp;&amp; (i != Ordinal aLn))
   F i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: eq_bigl =&gt; i; <span class="nb">rewrite</span> inE -val_eqE /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>633</q><q>655</q><q>516</q><q>656</q><q>518</q><q>519</q><q>664</q><q>225</q></div><span class="goal-separator"><hr></span><q>54d</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: (_ =P _); <span class="nb">rewrite</span> <span class="nl">?andbT</span> // =&gt; -&gt;; <span class="nb">rewrite</span> (negPf aNIl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">max_set_nat</span> (<span class="nv">e</span> : {fset nat}) : #|`e|.-<span class="mi">1</span> &lt;= \max_(i &lt;- e) i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ee</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e|.-<span class="mi">1</span> &lt;= \max_(i &lt;- e) i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>67b</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [n cI] := ubnP #|`e|; <span class="nb">elim</span>: n =&gt; // [] [|n] IH e cI <span class="kr">in</span> e cI *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>IH</var><span class="hyp-type"><b>:</b><span><span class="kr">forall</span> <span class="nv">e</span>,
#|` e| &lt; <span class="mi">0</span> -&gt; #|` e|.-<span class="mi">1</span> &lt;= \max_(i &lt;- e) i</span></span></div><q>ef</q><div><var>cI</var><span class="hyp-type"><b>:</b><span>#|` e| &lt; <span class="mi">1</span></span></span></div></div><span class="goal-separator"><hr></span><q>67d</q></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><div><var>IH</var><span class="hyp-type"><b>:</b><span><span class="kr">forall</span> <span class="nv">e</span>,
#|` e| &lt; n.+<span class="mi">1</span> -&gt; #|` e|.-<span class="mi">1</span> &lt;= \max_(i &lt;- e) i</span></span></div><q>ef</q><div><var>cI</var><span class="hyp-type"><b>:</b><span>#|` e| &lt; n.+<span class="mi">2</span></span></span></div></div><label class="goal-separator"><hr></label><q>67d</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>: cI; <span class="nb">rewrite</span> ltnS leqn0 =&gt; /eqP-&gt;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>687</q><span class="goal-separator"><hr></span><q>67d</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>: cI; <span class="nb">rewrite</span> leq_eqVlt =&gt; /orP[/eqP eC|]; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>688</q><q>ef</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e|.+<span class="mi">1</span> &lt; n.+<span class="mi">2</span> -&gt; #|` e|.-<span class="mi">1</span> &lt;= \max_(i &lt;- e) i</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>688</q><q>ef</q><div><var>eC</var><span class="hyp-type"><b>:</b><span>#|` e|.+<span class="mi">1</span> = n.+<span class="mi">2</span></span></span></div></div><label class="goal-separator"><hr></label><q>67d</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: IH.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>694</q><span class="goal-separator"><hr></span><q>67d</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /(eq_fbigmax id)[/= i [iIe iM]] : <span class="mi">0</span> &lt; #|`e| <span class="bp">by</span> <span class="nb">rewrite</span> -ltnS eC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>688</q><q>ef</q><q>695</q><q>150</q><q>a9</q><div><var>iM</var><span class="hyp-type"><b>:</b><span>\max_(i &lt;- e) i = i</span></span></div></div><span class="goal-separator"><hr></span><q>67d</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span>  eE : #|` e| = #|` e `\ i|.+<span class="mi">1</span> <span class="bp">by</span> <span class="nb">rewrite</span> (cardfsD1 i) iIe.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>688</q><q>ef</q><q>695</q><q>150</q><q>a9</q><q>69d</q><div><var>eE</var><span class="hyp-type"><b>:</b><span>#|` e| = #|` e `\ i|.+<span class="mi">1</span></span></span></div></div><span class="goal-separator"><hr></span><q>67d</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /IH H : #|`e `\ i| &lt; n.+<span class="mi">1</span> <span class="bp">by</span> <span class="nb">rewrite</span> -eE -ltnS eC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>688</q><q>ef</q><q>695</q><q>150</q><q>a9</q><q>69d</q><q>6a2</q><div><var>H</var><span class="hyp-type"><b>:</b><span>#|` e `\ i|.-<span class="mi">1</span> &lt;= \max_(i &lt;- e `\ i) i</span></span></div></div><span class="goal-separator"><hr></span><q>67d</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> eE /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>6a6</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e `\ i| &lt;= \max_(i &lt;- e) i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span> eIE : (#|` e `\ i|) =&gt; [//|k].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>688</q><q>ef</q><q>695</q><q>150</q><q>a9</q><q>69d</q><q>6a2</q><q>6a7</q><q>482</q><div><var>eIE</var><span class="hyp-type"><b>:</b><span>#|` e `\ i| = k.+<span class="mi">1</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">k &lt; \max_(i &lt;- e) i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /(eq_fbigmax id)[j []] : <span class="mi">0</span> &lt; #|` e `\ i| <span class="bp">by</span> <span class="nb">rewrite</span> eIE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>688</q><q>ef</q><q>695</q><q>150</q><q>a9</q><q>69d</q><q>6a2</q><q>6a7</q><q>482</q><q>6b0</q><div><var>j</var><span class="hyp-type"><b>:</b><span>nat_choiceType</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">j \<span class="kr">in</span> e `\ i -&gt;
\max_(i &lt;- e `\ i) i = j -&gt; k &lt; \max_(i &lt;- e) i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> !inE =&gt; /andP[jDi jIe] jM.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>688</q><q>ef</q><q>695</q><q>150</q><q>a9</q><q>69d</q><q>6a2</q><q>6a7</q><q>482</q><q>6b0</q><q>6b6</q><div><var>jDi</var><span class="hyp-type"><b>:</b><span>j != i</span></span></div><div><var>jIe</var><span class="hyp-type"><b>:</b><span>j \<span class="kr">in</span> e</span></span></div><div><var>jM</var><span class="hyp-type"><b>:</b><span>\max_(i &lt;- e `\ i) i = j</span></span></div></div><span class="goal-separator"><hr></span><q>6b1</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>: H; <span class="nb">rewrite</span> eIE =&gt; H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>688</q><q>ef</q><q>695</q><q>150</q><q>a9</q><q>69d</q><q>6a2</q><q>482</q><q>6b0</q><q>6b6</q><q>6bc</q><q>6bd</q><q>6be</q><div><var>H</var><span class="hyp-type"><b>:</b><span>k.+<span class="mi">1</span>.-<span class="mi">1</span> &lt;= \max_(i &lt;- e `\ i) i</span></span></div></div><span class="goal-separator"><hr></span><q>6b1</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_ltn_trans H _; <span class="nb">rewrite</span> iM jM.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>688</q><q>ef</q><q>695</q><q>150</q><q>a9</q><q>69d</q><q>6a2</q><q>482</q><q>6b0</q><q>6b6</q><q>6bc</q><q>6bd</q><q>6be</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">j &lt; i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> : j &lt;= i <span class="bp">by</span> <span class="nb">rewrite</span> -iM; <span class="nb">apply</span>: leq_bigfmax.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>6c7</q><span class="goal-separator"><hr></span><div class="goal-conclusion">j &lt;= i -&gt; j &lt; i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> leq_eqVlt (negPf jDi).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_aux_card_le</span> <span class="nv">l</span> <span class="nv">e</span> : (psi_aux l `[#|`e|] &lt;= psi_aux l e)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) `[#|` e|] &lt;= œà&#39;(l) e)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>6ce</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_sub // ler_nat leq_add2l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- `[#|` e|]) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (sum_sint (<span class="kr">fun</span> <span class="nv">i</span> =&gt;  <span class="mi">2</span> ^ minn (‚àái) l)) //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>128</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt; #|` e|) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [n cI] := ubnP #|`e|; <span class="nb">elim</span>: n =&gt; // [] [|n] IH e cI <span class="kr">in</span> e cI *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f6</q><div><var>IH</var><span class="hyp-type"><b>:</b><span><span class="kr">forall</span> <span class="nv">e</span>,
#|` e| &lt; <span class="mi">0</span> -&gt;
\sum_(i &lt; #|` e|) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l</span></span></div><q>ef</q><q>684</q></div><span class="goal-separator"><hr></span><q>6d9</q></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>305</q><div><var>IH</var><span class="hyp-type"><b>:</b><span><span class="kr">forall</span> <span class="nv">e</span>,
#|` e| &lt; n.+<span class="mi">1</span> -&gt;
\sum_(i &lt; #|` e|) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l</span></span></div><q>ef</q><q>689</q></div><label class="goal-separator"><hr></label><q>6d9</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>: cI; <span class="nb">rewrite</span> ltnS leqn0 =&gt; /eqP-&gt; ; <span class="nb">rewrite</span> big_ord0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>6e1</q><span class="goal-separator"><hr></span><q>6d9</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>: cI; <span class="nb">rewrite</span> leq_eqVlt =&gt; /orP[/eqP [] eC|]; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>305</q><q>6e2</q><q>ef</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e|.+<span class="mi">1</span> &lt; n.+<span class="mi">2</span> -&gt;
\sum_(i &lt; #|` e|) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>305</q><q>6e2</q><q>ef</q><div><var>eC</var><span class="hyp-type"><b>:</b><span>#|` e| = n.+<span class="mi">1</span></span></span></div></div><label class="goal-separator"><hr></label><q>6d9</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: IH.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>6ed</q><span class="goal-separator"><hr></span><q>6d9</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /(eq_fbigmax id)[/= i [iIe iM]] : <span class="mi">0</span> &lt; #|`e| <span class="bp">by</span> <span class="nb">rewrite</span> -ltnS eC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>305</q><q>6e2</q><q>ef</q><q>6ee</q><q>150</q><q>a9</q><q>69d</q></div><span class="goal-separator"><hr></span><q>6d9</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> eE : #|` e| = #|` e `\ i|.+<span class="mi">1</span> <span class="bp">by</span> <span class="nb">rewrite</span> (cardfsD1 i) iIe.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>305</q><q>6e2</q><q>ef</q><q>6ee</q><q>150</q><q>a9</q><q>69d</q><q>6a2</q></div><span class="goal-separator"><hr></span><q>6d9</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> eE big_ord_recr /= (big_fsetD1 i) //= addnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>6f9</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ minn (‚àá#|` e `\ i|) l +
\sum_(i0 &lt; #|` e `\ i|) <span class="mi">2</span> ^ minn (‚àái0) l &lt;=
<span class="mi">2</span> ^ minn (‚àái) l + \sum_(i &lt;- e `\ i) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_add; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">apply</span>: IH; <span class="nb">rewrite</span> -eC eE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>6f9</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ minn (‚àá#|` e `\ i|) l &lt;= <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_exp2l // leq_min geq_minr andbT.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>6f9</q><span class="goal-separator"><hr></span><div class="goal-conclusion">minn (‚àá#|` e `\ i|) l &lt;= ‚àái</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (geq_minl _ _) _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>6f9</q><span class="goal-separator"><hr></span><div class="goal-conclusion">‚àá#|` e `\ i| &lt;= ‚àái</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: troot_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>6f9</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e `\ i| &lt;= i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -{<span class="mi">2</span>}iM -ltnS -eE -[#|`_|]prednK; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">rewrite</span> eC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>6f9</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e|.-<span class="mi">1</span> &lt; (\max_(i &lt;- e) i).+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: max_set_nat.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* This is 2.4.2 *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_card_le</span> <span class="nv">e</span> : psi `[#|`e|] &lt;= psi e.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ee</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[#|` e|]) &lt;= œà(e)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>713</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: psi_aux_le_psi =&gt; l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1af</q><span class="goal-separator"><hr></span><q>6d0</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: psi_aux_card_le.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* This is 2.4.3 *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_exp</span> <span class="nv">e</span> : psi e &lt;= (<span class="mi">2</span> ^ #|`e|).-<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ee</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(e) &lt;= (<span class="mi">2</span> ^ #|` e|).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>71b</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(ler_nat int_numDomainType).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ee</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(e)%:R &lt;= (<span class="mi">2</span> ^ #|` e|).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [l -&gt;] := psiE e.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1af</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) e &lt;= (<span class="mi">2</span> ^ #|` e|).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: le_trans (_ : ((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ l)%:R - 
                      (l * <span class="mi">2</span> ^ l)%:R &lt;= _)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1af</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) e &lt;=
 ((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ l)%:R -
 (l * <span class="mi">2</span> ^ l)%:R)%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>1af</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ l)%:R -
 (l * <span class="mi">2</span> ^ l)%:R &lt;= (<span class="mi">2</span> ^ #|` e|).-<span class="mi">1</span>%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: ler_sub =&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1af</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l)%:R &lt;=
 ((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e) <span class="mi">2</span> ^ l)%:R)%R</div></blockquote><q>72b</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_nat leq_add2l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1af</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l &lt;= \sum_(i &lt;- e) <span class="mi">2</span> ^ l</div></blockquote><q>72b</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_sum =&gt; i Hi.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q><q>11f</q><div><var>Hi</var><span class="hyp-type"><b>:</b><span>true</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ minn (‚àái) l &lt;= <span class="mi">2</span> ^ l</div></blockquote><q>72b</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> leq_exp2l // geq_minr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1af</q><span class="goal-separator"><hr></span><q>72d</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> fsum_nat_const ler_subl_addr -natrD ler_nat [X <span class="kr">in</span> _ &lt;= X]addnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1af</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ l).-<span class="mi">1</span> + #|` e| * <span class="mi">2</span> ^ l &lt;=
l * <span class="mi">2</span> ^ l + (<span class="mi">2</span> ^ #|` e|).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -prednDl <span class="nl">?expn_gt0</span> // -prednDr <span class="nl">?expn_gt0</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1af</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ l + #|` e| * <span class="mi">2</span> ^ l).-<span class="mi">1</span> &lt;=
(l * <span class="mi">2</span> ^ l + <span class="mi">2</span> ^ #|` e|).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -!subn1 leq_sub2r //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>1af</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ l + #|` e| * <span class="mi">2</span> ^ l &lt;= l * <span class="mi">2</span> ^ l + <span class="mi">2</span> ^ #|` e|</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [E|E] := leqP #|`e| l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q><div><var>E</var><span class="hyp-type"><b>:</b><span>#|` e| &lt;= l</span></span></div></div><span class="goal-separator"><hr></span><q>74a</q></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q><div><var>E</var><span class="hyp-type"><b>:</b><span>l &lt; #|` e|</span></span></div></div><label class="goal-separator"><hr></label><q>74a</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(subnK E).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>74e</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ (l - #|` e| + #|` e|) +
#|` e| * <span class="mi">2</span> ^ (l - #|` e| + #|` e|) &lt;=
(l - #|` e| + #|` e|) * <span class="mi">2</span> ^ (l - #|` e| + #|` e|) +
<span class="mi">2</span> ^ #|` e|</div></blockquote><q>750</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> u := _ - _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q><q>74f</q><div><var>u</var><span><span class="hyp-body"><b>:=</b><span>l - #|` e|</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ (u + #|` e|) + #|` e| * <span class="mi">2</span> ^ (u + #|` e|) &lt;=
(u + #|` e|) * <span class="mi">2</span> ^ (u + #|` e|) + <span class="mi">2</span> ^ #|` e|</div></blockquote><q>750</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> expnD !mulnDl addnAC leq_add2r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>75b</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ u * <span class="mi">2</span> ^ #|` e| &lt;=
u * (<span class="mi">2</span> ^ u * <span class="mi">2</span> ^ #|` e|) + <span class="mi">2</span> ^ #|` e|</div></blockquote><q>750</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: u =&gt; [|u]; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">rewrite</span> mul1n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q><q>74f</q><div><var>u</var><span class="hyp-type"><b>:</b><span>nat</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ u.+<span class="mi">1</span> * <span class="mi">2</span> ^ #|` e| &lt;=
u.+<span class="mi">1</span> * (<span class="mi">2</span> ^ u.+<span class="mi">1</span> * <span class="mi">2</span> ^ #|` e|) + <span class="mi">2</span> ^ #|` e|</div></blockquote><q>750</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> mulSn -addnA leq_addr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>752</q><span class="goal-separator"><hr></span><q>74a</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(subnK (ltnW E)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>752</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ l + (#|` e| - l + l) * <span class="mi">2</span> ^ l &lt;=
l * <span class="mi">2</span> ^ l + <span class="mi">2</span> ^ (#|` e| - l + l)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> u := _ - _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>f6</q><q>753</q><div><var>u</var><span><span class="hyp-body"><b>:=</b><span>#|` e| - l</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ l + (u + l) * <span class="mi">2</span> ^ l &lt;= l * <span class="mi">2</span> ^ l + <span class="mi">2</span> ^ (u + l)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> expnD !mulnDl addnA addnC leq_add2l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>772</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ l + u * <span class="mi">2</span> ^ l &lt;= <span class="mi">2</span> ^ u * <span class="mi">2</span> ^ l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -mulSn leq_mul2r ltn_expl // orbT.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* This is 2.5 *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_diff</span> <span class="nv">e1</span> <span class="nv">e2</span> : psi e1 - psi e2 &lt;= \sum_(i &lt;- e1 `\` e2) <span class="mi">2</span> ^ troot i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>28f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(e1) - œà(e2) &lt;= \sum_(i &lt;- e1 `\` e2) <span class="mi">2</span> ^ ‚àái</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>77a</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_subLR -(ler_nat int_numDomainType) natrD addrC -ler_subl_addr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>28f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(e1)%:R - œà(e2)%:R &lt;=
 (\sum_(i &lt;- e1 `\` e2) <span class="mi">2</span> ^ ‚àái)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [l -&gt;] := psiE e1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>f6</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) e1 - œà(e2)%:R &lt;=
 (\sum_(i &lt;- e1 `\` e2) <span class="mi">2</span> ^ ‚àái)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: le_trans (ler_sub (lexx _) (psi_max _ l)) _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>785</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) e1 - œà&#39;(l) e2 &lt;=
 (\sum_(i &lt;- e1 `\` e2) <span class="mi">2</span> ^ ‚àái)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi_aux opprB addrA subrK addnC !natrD opprD addrA addrK.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>785</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((\sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
 (\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l)%:R &lt;=
 (\sum_(i &lt;- e1 `\` e2) <span class="mi">2</span> ^ ‚àái)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_subl_addr -natrD ler_nat addnC -leq_subLR.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>785</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l -
\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e1 `\` e2) <span class="mi">2</span> ^ ‚àái</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> s1 := \sum_(_ &lt;- _) _; <span class="nb">set</span> s2 := \sum_(_ &lt;- _) _; <span class="nb">set</span> s3 := \sum_(_ &lt;- _) _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>f6</q><div><var>s1</var><span><span class="hyp-body"><b>:=</b><span>\sum_(H &lt;- e1) <span class="mi">2</span> ^ minn (‚àáH) l</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div><div><var>s2</var><span><span class="hyp-body"><b>:=</b><span>\sum_(H &lt;- e2) <span class="mi">2</span> ^ minn (‚àáH) l</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div><div><var>s3</var><span><span class="hyp-body"><b>:=</b><span>\sum_(H &lt;- e1 `\` e2) <span class="mi">2</span> ^ ‚àáH</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s1 - s2 &lt;= s3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> f i := <span class="mi">2</span> ^ minn (troot i) l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>f6</q><q>797</q><q>798</q><q>799</q><div><var>f</var><span><span class="hyp-body"><b>:=</b><span><span class="kr">fun</span> <span class="nv">i</span> : nat =&gt; <span class="mi">2</span> ^ minn (‚àái) l</span></span><span class="hyp-type"><b>:</b><span>nat -&gt; nat</span></span></span></div></div><span class="goal-separator"><hr></span><q>79a</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (_ :  \sum_(i &lt;- e1 `\` e2) f i &lt;= _); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>79e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e1 `\` e2) f i &lt;= s3</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>79e</q><label class="goal-separator"><hr></label><div class="goal-conclusion">s1 - s2 &lt;= \sum_(i &lt;- e1 `\` e2) f i</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: leq_sum =&gt; i _; <span class="nb">rewrite</span> leq_exp2l // geq_minl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>79e</q><span class="goal-separator"><hr></span><q>7a6</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_subLR.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>79e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">s1 &lt;= s2 + \sum_(i &lt;- e1 `\` e2) f i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [s1](big_fsetID _ (<span class="kr">fun</span> <span class="nv">i</span> =&gt; i \<span class="kr">in</span> e2)) //=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>79e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- [fset x | x <span class="kr">in</span> e1 &amp; x \<span class="kr">in</span> e2])
   <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- [fset x | x <span class="kr">in</span> e1 &amp; x \notin e2])
   <span class="mi">2</span> ^ minn (‚àái) l &lt;= s2 + \sum_(i &lt;- e1 `\` e2) f i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_add.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>79e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- [fset x | x <span class="kr">in</span> e1 &amp; x \<span class="kr">in</span> e2])
   <span class="mi">2</span> ^ minn (‚àái) l &lt;= s2</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>79e</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- [fset x | x <span class="kr">in</span> e1 &amp; x \notin e2])
   <span class="mi">2</span> ^ minn (‚àái) l &lt;= \sum_(i &lt;- e1 `\` e2) f i</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [s2](big_fsetID _ (<span class="kr">fun</span> <span class="nv">i</span> =&gt; i \<span class="kr">in</span> e1)) //=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>79e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- [fset x | x <span class="kr">in</span> e1 &amp; x \<span class="kr">in</span> e2])
   <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- [fset x | x <span class="kr">in</span> e2 &amp; x \<span class="kr">in</span> e1])
   <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- [fset x | x <span class="kr">in</span> e2 &amp; x \notin e1])
   <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>7b6</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (leq_addr _ _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>79e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- [fset x | x <span class="kr">in</span> e1 &amp; x \<span class="kr">in</span> e2])
   <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- [fset x | x <span class="kr">in</span> e2 &amp; x \<span class="kr">in</span> e1])
   <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>7b6</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_eqVlt; <span class="nb">apply</span>/orP; <span class="nb">left</span>; <span class="nb">apply</span>/eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>79e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- [fset x | x <span class="kr">in</span> e1 &amp; x \<span class="kr">in</span> e2])
   <span class="mi">2</span> ^ minn (‚àái) l =
\sum_(i &lt;- [fset x | x <span class="kr">in</span> e2 &amp; x \<span class="kr">in</span> e1])
   <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>7b6</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: eq_fbigl =&gt; i; <span class="nb">rewrite</span> !inE andbC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>79e</q><span class="goal-separator"><hr></span><q>7b8</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_eqVlt; <span class="nb">apply</span>/orP; <span class="nb">left</span>; <span class="nb">apply</span>/eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>79e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- [fset x | x <span class="kr">in</span> e1 &amp; x \notin e2])
   <span class="mi">2</span> ^ minn (‚àái) l = \sum_(i &lt;- e1 `\` e2) f i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: eq_fbigl =&gt; i; <span class="nb">rewrite</span> !inE andbC.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* This is 2.6 *)</span>

</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_delta</span> <span class="nv">e</span> <span class="nv">s</span> <span class="nv">a</span> : 
  #|` e `\` `[delta s]| &lt;= s -&gt; a \<span class="kr">in</span> e -&gt; psi e - psi (e `\  a) &lt;= <span class="mi">2</span> ^ s.-<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><div><var>s</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><div><var>a</var><span class="hyp-type"><b>:</b><span>nat_choiceType</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e `\` `[Œîs]| &lt;= s -&gt;
a \<span class="kr">in</span> e -&gt; œà(e) - œà(e `\ a) &lt;= <span class="mi">2</span> ^ s.-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>7cd</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; CLs aIe.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><div><var>CLs</var><span class="hyp-type"><b>:</b><span>#|` e `\` `[Œîs]| &lt;= s</span></span></div><div><var>aIe</var><span class="hyp-type"><b>:</b><span>a \<span class="kr">in</span> e</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(e) - œà(e `\ a) &lt;= <span class="mi">2</span> ^ s.-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_subLR -(ler_nat int_numDomainType) natrD addrC -ler_subl_addr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>7d7</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(e)%:R - œà(e `\ a)%:R &lt;= (<span class="mi">2</span> ^ s.-<span class="mi">1</span>)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [l Hl] := psiE e.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><div><var>Hl</var><span class="hyp-type"><b>:</b><span>(œà(e)%:R)%R = œà&#39;(l) e</span></span></div></div><span class="goal-separator"><hr></span><q>7de</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> F l1 : s &lt;= l1.+<span class="mi">1</span> -&gt; (psi_aux l1.+<span class="mi">1</span> e &lt;= psi_aux l1 e)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><div><var>l1</var><span class="hyp-type"><b>:</b><span>nat</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s &lt;= l1.+<span class="mi">1</span> -&gt; (œà&#39;(l1.+<span class="mi">1</span>) e &lt;= œà&#39;(l1) e)%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><div><var>F</var><span class="hyp-type"><b>:</b><span><span class="kr">forall</span> <span class="nv">l1</span> : nat,
s &lt;= l1.+<span class="mi">1</span> -&gt; (œà&#39;(l1.+<span class="mi">1</span>) e &lt;= œà&#39;(l1) e)%R</span></span></div></div><label class="goal-separator"><hr></label><q>7de</q></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; sLl1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>7e8</q><div><var>sLl1</var><span class="hyp-type"><b>:</b><span>s &lt;= l1.+<span class="mi">1</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l1.+<span class="mi">1</span>) e &lt;= œà&#39;(l1) e)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> psi_auxE_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>7f1</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l1.+<span class="mi">1</span> * #|` [fset i | i <span class="kr">in</span> e &amp; (l1 &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- e | (‚àái &lt; l1.+<span class="mi">1</span>)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l1.+<span class="mi">1</span> * <span class="mi">2</span> ^ l1.+<span class="mi">1</span>)%:R &lt;= œà&#39;(l1) e)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> psi_auxE_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>7f1</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l1.+<span class="mi">1</span> * #|` [fset i | i <span class="kr">in</span> e &amp; (l1 &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- e | (‚àái &lt; l1.+<span class="mi">1</span>)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l1.+<span class="mi">1</span> * <span class="mi">2</span> ^ l1.+<span class="mi">1</span>)%:R &lt;=
 ((<span class="mi">2</span> ^ l1 * #|` [fset i | i <span class="kr">in</span> e &amp; (l1 &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  \sum_(i &lt;- e | (‚àái &lt;= l1)%N) <span class="mi">2</span> ^ ‚àái)%:R -
 (l1 * <span class="mi">2</span> ^ l1)%:R)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> s1 := \sum_(_ &lt;- _ | _) _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>7e8</q><q>7f2</q><div><var>s1</var><span><span class="hyp-body"><b>:=</b><span>\sum_(H &lt;- e | ‚àáH &lt; l1.+<span class="mi">1</span>) <span class="mi">2</span> ^ ‚àáH</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l1.+<span class="mi">1</span> * #|` [fset i | i <span class="kr">in</span> e &amp; (l1 &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  s1)%:R - (l1.+<span class="mi">1</span> * <span class="mi">2</span> ^ l1.+<span class="mi">1</span>)%:R &lt;=
 ((<span class="mi">2</span> ^ l1 * #|` [fset i | i <span class="kr">in</span> e &amp; (l1 &lt; ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  s1)%:R - (l1 * <span class="mi">2</span> ^ l1)%:R)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> -&gt; : [fset i <span class="kr">in</span> e | l1 &lt; troot i] = [fset i <span class="kr">in</span> e | delta l1.+<span class="mi">1</span> &lt;= i].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>7ff</q><span class="goal-separator"><hr></span><div class="goal-conclusion">[fset i | i <span class="kr">in</span> e &amp; l1 &lt; ‚àái] =
[fset i | i <span class="kr">in</span> e &amp; Œîl1.+<span class="mi">1</span> &lt;= i]</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>7ff</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(((<span class="mi">2</span> ^ l1.+<span class="mi">1</span> *
   #|` [fset i | i <span class="kr">in</span> e &amp; (Œîl1.+<span class="mi">1</span> &lt;= i)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  s1)%:R - (l1.+<span class="mi">1</span> * <span class="mi">2</span> ^ l1.+<span class="mi">1</span>)%:R &lt;=
 ((<span class="mi">2</span> ^ l1 *
   #|` [fset i | i <span class="kr">in</span> e &amp; (Œîl1.+<span class="mi">1</span> &lt;= i)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
  s1)%:R - (l1 * <span class="mi">2</span> ^ l1)%:R)%R</div></blockquote><q>7eb</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>/fsetP =&gt; i; <span class="nb">rewrite</span> !inE root_delta_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>7ff</q><span class="goal-separator"><hr></span><q>808</q></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> c := #|`_|.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>7e8</q><q>7f2</q><q>800</q><div><var>c</var><span><span class="hyp-body"><b>:=</b><span>#|` [fset i | i <span class="kr">in</span> e &amp; Œîl1.+<span class="mi">1</span> &lt;= i]|</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l1.+<span class="mi">1</span> * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s1)%:R -
 (l1.+<span class="mi">1</span> * <span class="mi">2</span> ^ l1.+<span class="mi">1</span>)%:R &lt;=
 ((<span class="mi">2</span> ^ l1 * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s1)%:R - (l1 * <span class="mi">2</span> ^ l1)%:R)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> Hc : c &lt;= s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>80f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">c &lt;= s</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>7e8</q><q>7f2</q><q>800</q><q>810</q><div><var>Hc</var><span class="hyp-type"><b>:</b><span>c &lt;= s</span></span></div></div><label class="goal-separator"><hr></label><q>811</q></blockquote><q>7eb</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans CLs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d9</q><q>f6</q><q>7e3</q><q>7e8</q><q>7f2</q><q>800</q><q>810</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">c &lt;= #|` e `\` `[Œîs]|</div></blockquote><q>816</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: fsubset_leq_card.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>81d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">[fset i | i <span class="kr">in</span> e &amp; Œîl1.+<span class="mi">1</span> &lt;= i] `&lt;=` e `\` `[Œîs]</div></blockquote><q>816</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/fsubsetP=&gt; i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d9</q><q>f6</q><q>7e3</q><q>7e8</q><q>7f2</q><q>800</q><q>810</q><q>11f</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i \<span class="kr">in</span> [fset i | i <span class="kr">in</span> e &amp; Œîl1.+<span class="mi">1</span> &lt;= i] -&gt;
i \<span class="kr">in</span> e `\` `[Œîs]</div></blockquote><q>816</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> !inE =&gt; /andP[-&gt; H].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d9</q><q>f6</q><q>7e3</q><q>7e8</q><q>7f2</q><q>800</q><q>810</q><q>11f</q><div><var>H</var><span class="hyp-type"><b>:</b><span>Œîl1.+<span class="mi">1</span> &lt;= i</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(i \notin `[Œîs]) &amp;&amp; true</div></blockquote><q>816</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> andbT mem_sint -leqNgt (leq_trans _ H) //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>82b</q><span class="goal-separator"><hr></span><div class="goal-conclusion">Œîs &lt;= Œîl1.+<span class="mi">1</span></div></blockquote><q>816</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: delta_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>818</q><span class="goal-separator"><hr></span><q>811</q></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> expnS mulnAC [<span class="mi">2</span> * _ * _]mulnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>818</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l1 * (<span class="mi">2</span> * c.+<span class="mi">1</span>)).-<span class="mi">1</span> + s1)%:R -
 (l1.+<span class="mi">1</span> * (<span class="mi">2</span> * <span class="mi">2</span> ^ l1))%:R &lt;=
 ((<span class="mi">2</span> ^ l1 * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s1)%:R - (l1 * <span class="mi">2</span> ^ l1)%:R)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mul2n mulnA muln2 -!addnn -[(_ + l1.+<span class="mi">1</span>)%N]addSnnS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>818</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l1 * (c.+<span class="mi">1</span> + c.+<span class="mi">1</span>)).-<span class="mi">1</span> + s1)%:R -
 ((l1.+<span class="mi">2</span> + l1) * <span class="mi">2</span> ^ l1)%:R &lt;=
 ((<span class="mi">2</span> ^ l1 * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s1)%:R - (l1 * <span class="mi">2</span> ^ l1)%:R)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> mulnDl mulnDr prednDr ?(muln_gt0, expn_gt0) //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>818</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l1 * c.+<span class="mi">1</span> + (<span class="mi">2</span> ^ l1 * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s1)%:R -
 (l1.+<span class="mi">2</span> * <span class="mi">2</span> ^ l1 + l1 * <span class="mi">2</span> ^ l1)%:R &lt;=
 ((<span class="mi">2</span> ^ l1 * c.+<span class="mi">1</span>).-<span class="mi">1</span> + s1)%:R - (l1 * <span class="mi">2</span> ^ l1)%:R)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> x := <span class="mi">2</span> ^ _ * _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>7e8</q><q>7f2</q><q>800</q><q>810</q><q>819</q><div><var>x</var><span><span class="hyp-body"><b>:=</b><span><span class="mi">2</span> ^ l1 * c.+<span class="mi">1</span></span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((x + x.-<span class="mi">1</span> + s1)%:R -
 (l1.+<span class="mi">2</span> * <span class="mi">2</span> ^ l1 + l1 * <span class="mi">2</span> ^ l1)%:R &lt;=
 (x.-<span class="mi">1</span> + s1)%:R - (l1 * <span class="mi">2</span> ^ l1)%:R)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -[(_ + s1)%N]addnA [(x + _)%N]addnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>844</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((x.-<span class="mi">1</span> + s1 + x)%:R -
 (l1.+<span class="mi">2</span> * <span class="mi">2</span> ^ l1 + l1 * <span class="mi">2</span> ^ l1)%:R &lt;=
 (x.-<span class="mi">1</span> + s1)%:R - (l1 * <span class="mi">2</span> ^ l1)%:R)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [X <span class="kr">in</span> (_ - X &lt;= _)%R]natrD opprD addrA ler_add //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>844</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((x.-<span class="mi">1</span> + s1 + x)%:R - (l1.+<span class="mi">2</span> * <span class="mi">2</span> ^ l1)%:R &lt;=
 (x.-<span class="mi">1</span> + s1)%:R)%R</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_sub_addr natrD ler_add // ler_nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>844</q><span class="goal-separator"><hr></span><div class="goal-conclusion">x &lt;= l1.+<span class="mi">2</span> * <span class="mi">2</span> ^ l1</div></blockquote><q>7ea</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> mulnC leq_mul2l ltnS (leq_trans _ sLl1) <span class="nl">?orbT</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>7ec</q><span class="goal-separator"><hr></span><q>7de</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> l1 := minn l s.-<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>7ed</q><div><var>l1</var><span><span class="hyp-body"><b>:=</b><span>minn l s.-<span class="mi">1</span></span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><q>7de</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> -&gt; : ((psi e)%:R = psi_aux l1 e)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>859</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(e)%:R)%R = œà&#39;(l1) e</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>859</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(œà&#39;(l1) e - œà(e `\ a)%:R &lt;= (<span class="mi">2</span> ^ s.-<span class="mi">1</span>)%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [/minn_idPl U|E] := leqP l s.-<span class="mi">1</span>; <span class="kp">first</span> <span class="bp">by</span> <span class="nb">rewrite</span> [l1]U.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>7ed</q><q>85a</q><div><var>E</var><span class="hyp-type"><b>:</b><span>s.-<span class="mi">1</span> &lt; l</span></span></div></div><span class="goal-separator"><hr></span><q>85e</q></blockquote><q>85f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /ltnW/minn_idPr U := E.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>7ed</q><q>85a</q><q>866</q><div><var>U</var><span class="hyp-type"><b>:</b><span>minn l s.-<span class="mi">1</span> = s.-<span class="mi">1</span></span></span></div></div><span class="goal-separator"><hr></span><q>85e</q></blockquote><q>85f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [l1]U.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>86a</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà(e)%:R)%R = œà&#39;(s.-<span class="mi">1</span>) e</div></blockquote><q>85f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/eqP; <span class="nb">rewrite</span> eq_le psi_max andbT Hl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>86a</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) e &lt;= œà&#39;(s.-<span class="mi">1</span>) e)%R</div></blockquote><q>85f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(subnK (ltnW E)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>86a</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l - s.-<span class="mi">1</span> + s.-<span class="mi">1</span>) e &lt;= œà&#39;(s.-<span class="mi">1</span>) e)%R</div></blockquote><q>85f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>: (_ - _) =&gt; [|k IH] //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>7ed</q><q>85a</q><q>866</q><q>86b</q><q>482</q><div><var>IH</var><span class="hyp-type"><b>:</b><span>(œà&#39;(k + s.-<span class="mi">1</span>) e &lt;= œà&#39;(s.-<span class="mi">1</span>) e)%R</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(k.+<span class="mi">1</span> + s.-<span class="mi">1</span>) e &lt;= œà&#39;(s.-<span class="mi">1</span>) e)%R</div></blockquote><q>85f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: le_trans IH.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>7ed</q><q>85a</q><q>866</q><q>86b</q><q>482</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(k.+<span class="mi">1</span> + s.-<span class="mi">1</span>) e &lt;= œà&#39;(k + s.-<span class="mi">1</span>) e)%R</div></blockquote><q>85f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addSn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>881</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;((k + s.-<span class="mi">1</span>).+<span class="mi">1</span>) e &lt;= œà&#39;(k + s.-<span class="mi">1</span>) e)%R</div></blockquote><q>85f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: F =&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>85a</q><q>866</q><q>86b</q><q>482</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s &lt;= (k + s.-<span class="mi">1</span>).+<span class="mi">1</span></div></blockquote><q>85f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: (s) =&gt; // s1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>ef</q><q>7d0</q><q>7d1</q><q>7d8</q><q>7d9</q><q>f6</q><q>7e3</q><q>85a</q><q>866</q><q>86b</q><div><var>k, s1</var><span class="hyp-type"><b>:</b><span>nat</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s1 &lt; (k + s1.+<span class="mi">1</span>.-<span class="mi">1</span>).+<span class="mi">1</span></div></blockquote><q>85f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> ltnS /= leq_addl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>859</q><span class="goal-separator"><hr></span><q>861</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: le_trans (ler_sub (lexx _) (psi_max _ l1)) _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>859</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l1) e - œà&#39;(l1) (e `\ a) &lt;= (<span class="mi">2</span> ^ s.-<span class="mi">1</span>)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi_aux opprB addrA subrK addnC !natrD opprD addrA addrK.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>859</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l1)%:R -
 (\sum_(i &lt;- e `\ a) <span class="mi">2</span> ^ minn (‚àái) l1)%:R &lt;=
 (<span class="mi">2</span> ^ s.-<span class="mi">1</span>)%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_subl_addr -natrD ler_nat addnC -leq_subLR.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>859</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e) <span class="mi">2</span> ^ minn (‚àái) l1 -
\sum_(i &lt;- e `\ a) <span class="mi">2</span> ^ minn (‚àái) l1 &lt;= <span class="mi">2</span> ^ s.-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (big_fsetD1  a) //= addnK leq_exp2l //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>859</q><span class="goal-separator"><hr></span><div class="goal-conclusion">minn (‚àáa) l1 &lt;= s.-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: leq_trans (geq_minr _ _) (geq_minr _ _).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* This is 2.7 *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_add</span> <span class="nv">n</span> <span class="nv">s</span> <span class="nv">e1</span> <span class="nv">e2</span> : 
  e1 `&lt;=` `[n] -&gt; n &gt;= delta (s.-<span class="mi">1</span>) -&gt;  #|`e2| &lt;= s -&gt;
  psi (e1 `|` e2) - psi (e1) &lt;= psi `[n + s] - psi `[n].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><div><var>n, s</var><span class="hyp-type"><b>:</b><span>nat</span></span></div><q>f7</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">e1 `&lt;=` `[n] -&gt;
Œîs.-<span class="mi">1</span> &lt;= n -&gt;
#|` e2| &lt;= s -&gt;
œà(e1 `|` e2) - œà(e1) &lt;= œà(`[n + s]) - œà(`[n])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>8a6</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; e1Sn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>8a9</q><q>f7</q><div><var>e1Sn</var><span class="hyp-type"><b>:</b><span>e1 `&lt;=` `[n]</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Œîs.-<span class="mi">1</span> &lt;= n -&gt;
#|` e2| &lt;= s -&gt;
œà(e1 `|` e2) - œà(e1) &lt;= œà(`[n + s]) - œà(`[n])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>: s e2 =&gt; [e2 _|s IH e2 dLn Ce2].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><div><var>e1</var><span class="hyp-type"><b>:</b><span>{fset nat}</span></span></div><q>8b0</q><div><var>e2</var><span class="hyp-type"><b>:</b><span>{fset nat}</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e2| &lt;= <span class="mi">0</span> -&gt;
œà(e1 `|` e2) - œà(e1) &lt;= œà(`[n + <span class="mi">0</span>]) - œà(`[n])</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><div><var>IH</var><span class="hyp-type"><b>:</b><span><span class="kr">forall</span> <span class="nv">e2</span>,
Œîs.-<span class="mi">1</span> &lt;= n -&gt;
#|` e2| &lt;= s -&gt;
œà(e1 `|` e2) - œà(e1) &lt;= œà(`[n + s]) - œà(`[n])</span></span></div><q>8b7</q><div><var>dLn</var><span class="hyp-type"><b>:</b><span>Œîs.+<span class="mi">1</span>.-<span class="mi">1</span> &lt;= n</span></span></div><div><var>Ce2</var><span class="hyp-type"><b>:</b><span>#|` e2| &lt;= s.+<span class="mi">1</span></span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">œà(e1 `|` e2) - œà(e1) &lt;= œà(`[n + s.+<span class="mi">1</span>]) - œà(`[n])</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leqn0 cardfs_eq0 =&gt; /eqP-&gt;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8b5</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(e1 `|` fset0) - œà(e1) &lt;= œà(`[n + <span class="mi">0</span>]) - œà(`[n])</div></blockquote><q>8b9</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> fsetU0 subnn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8bb</q><span class="goal-separator"><hr></span><q>8bf</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [-&gt;|[x xIe2]] := fset_0Vmem e2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8bb</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(e1 `|` fset0) - œà(e1) &lt;= œà(`[n + s.+<span class="mi">1</span>]) - œà(`[n])</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><div><var>xIe2</var><span class="hyp-type"><b>:</b><span>x \<span class="kr">in</span> e2</span></span></div></div><label class="goal-separator"><hr></label><q>8bf</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> fsetU0 subnn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8cd</q><span class="goal-separator"><hr></span><q>8bf</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> dLn1 : delta (s.-<span class="mi">1</span>) &lt;= n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8cd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">Œîs.-<span class="mi">1</span> &lt;= n</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><div><var>dLn1</var><span class="hyp-type"><b>:</b><span>Œîs.-<span class="mi">1</span> &lt;= n</span></span></div></div><label class="goal-separator"><hr></label><q>8bf</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans dLn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8be</q><q>327</q><q>8ce</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Œîs.-<span class="mi">1</span> &lt;= Œîs.+<span class="mi">1</span>.-<span class="mi">1</span></div></blockquote><q>8d6</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: delta_le; <span class="nb">case</span>: (s) =&gt; // s1 /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8d8</q><span class="goal-separator"><hr></span><q>8bf</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> e3 := e2 `\ x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><q>8d9</q><div><var>e3</var><span><span class="hyp-body"><b>:=</b><span>e2 `\ x</span></span><span class="hyp-type"><b>:</b><span>{fset nat_choiceType}</span></span></span></div></div><span class="goal-separator"><hr></span><q>8bf</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> Ce3 : #|` e3| &lt;= s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8e5</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e3| &lt;= s</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><q>8d9</q><q>8e6</q><div><var>Ce3</var><span class="hyp-type"><b>:</b><span>#|` e3| &lt;= s</span></span></div></div><label class="goal-separator"><hr></label><q>8bf</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>: Ce2; <span class="nb">rewrite</span> (cardfsD1 x) xIe2 ltnS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8ed</q><span class="goal-separator"><hr></span><q>8bf</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (leq_sub_add (psi (e1 `|` e3)) _ _) _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8ed</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(e1 `|` e2) - œà(e1 `|` e3) + (œà(e1 `|` e3) - œà(e1)) &lt;=
œà(`[n + s.+<span class="mi">1</span>]) - œà(`[n])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addnS psi_sintS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8ed</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(e1 `|` e2) - œà(e1 `|` e3) + (œà(e1 `|` e3) - œà(e1)) &lt;=
œà(`[n + s]) + <span class="mi">2</span> ^ (‚àá(n + s).+<span class="mi">1</span>).-<span class="mi">1</span> - œà(`[n])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [X <span class="kr">in</span> _ &lt;= X - _]addnC -addnBA; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8ed</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(`[n]) &lt;= œà(`[n + s])</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>8ed</q><label class="goal-separator"><hr></label><div class="goal-conclusion">œà(e1 `|` e2) - œà(e1 `|` e3) + (œà(e1 `|` e3) - œà(e1)) &lt;=
<span class="mi">2</span> ^ (‚àá(n + s).+<span class="mi">1</span>).-<span class="mi">1</span> + (œà(`[n + s]) - œà(`[n]))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: psi_sint_leq; <span class="nb">rewrite</span> leq_addr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8ed</q><span class="goal-separator"><hr></span><q>900</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_add; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">apply</span>: IH.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>8ed</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œà(e1 `|` e2) - œà(e1 `|` e3) &lt;= <span class="mi">2</span> ^ (‚àá(n + s).+<span class="mi">1</span>).-<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [xIe1|xNIe1] := boolP (x \<span class="kr">in</span> e1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><q>8d9</q><q>8e6</q><q>8ee</q><div><var>xIe1</var><span class="hyp-type"><b>:</b><span>x \<span class="kr">in</span> e1</span></span></div></div><span class="goal-separator"><hr></span><q>907</q></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><q>8d9</q><q>8e6</q><q>8ee</q><div><var>xNIe1</var><span class="hyp-type"><b>:</b><span>x \notin e1</span></span></div></div><label class="goal-separator"><hr></label><q>907</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> -&gt; : e1 `|` e2 = e1 `|` e3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>90b</q><span class="goal-separator"><hr></span><div class="goal-conclusion">e1 `|` e2 = e1 `|` e3</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>90b</q><label class="goal-separator"><hr></label><div class="goal-conclusion">œà(e1 `|` e3) - œà(e1 `|` e3) &lt;= <span class="mi">2</span> ^ (‚àá(n + s).+<span class="mi">1</span>).-<span class="mi">1</span></div></blockquote><q>90e</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/fsetP=&gt; i; <span class="nb">rewrite</span> !inE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><q>8d9</q><q>8e6</q><q>8ee</q><q>90c</q><q>11f</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(i \<span class="kr">in</span> e1) || (i \<span class="kr">in</span> e2) =
(i \<span class="kr">in</span> e1) || (i != x) &amp;&amp; (i \<span class="kr">in</span> e2)</div></blockquote><q>915</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: eqP =&gt; // -&gt;; <span class="nb">rewrite</span> xIe1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>90b</q><span class="goal-separator"><hr></span><q>917</q></blockquote><q>90d</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> subnn.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>90f</q><span class="goal-separator"><hr></span><q>907</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> -&gt; : e1 `|` e3 = (e1 `|` e2) `\ x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>90f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">e1 `|` e3 = (e1 `|` e2) `\ x</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>90f</q><label class="goal-separator"><hr></label><div class="goal-conclusion">œà(e1 `|` e2) - œà((e1 `|` e2) `\ x) &lt;=
<span class="mi">2</span> ^ (‚àá(n + s).+<span class="mi">1</span>).-<span class="mi">1</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/fsetP=&gt; i; <span class="nb">rewrite</span> !inE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><q>8d9</q><q>8e6</q><q>8ee</q><q>910</q><q>11f</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(i \<span class="kr">in</span> e1) || (i != x) &amp;&amp; (i \<span class="kr">in</span> e2) =
(i != x) &amp;&amp; ((i \<span class="kr">in</span> e1) || (i \<span class="kr">in</span> e2))</div></blockquote><q>927</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: eqP =&gt; // -&gt;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>92d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(x \<span class="kr">in</span> e1) || ~~ true &amp;&amp; (x \<span class="kr">in</span> e2) =
~~ true &amp;&amp; ((x \<span class="kr">in</span> e1) || (x \<span class="kr">in</span> e2))</div></blockquote><q>927</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> (negPf xNIe1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>90f</q><span class="goal-separator"><hr></span><q>929</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: psi_delta; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>90f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">x \<span class="kr">in</span> e1 `|` e2</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>90f</q><label class="goal-separator"><hr></label><div class="goal-conclusion">#|` (e1 `|` e2) `\` `[Œî(‚àá(n + s).+<span class="mi">1</span>)]| &lt;= ‚àá(n + s).+<span class="mi">1</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> !inE xIe2 orbT.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>90f</q><span class="goal-separator"><hr></span><q>93c</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -addnS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>90f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` (e1 `|` e2) `\` `[Œî(‚àá(n + s.+<span class="mi">1</span>))]| &lt;= ‚àá(n + s.+<span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> t := s.+<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><q>8d9</q><q>8e6</q><q>8ee</q><q>910</q><div><var>t</var><span><span class="hyp-body"><b>:=</b><span>s.+<span class="mi">1</span></span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` (e1 `|` e2) `\` `[Œî(‚àá(n + t))]| &lt;= ‚àá(n + t)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> g := troot (n + t).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><q>8d9</q><q>8e6</q><q>8ee</q><q>910</q><q>948</q><div><var>g</var><span><span class="hyp-body"><b>:=</b><span>‚àá(n + t)</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` (e1 `|` e2) `\` `[Œîg]| &lt;= g</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (_ : #|` e2 `|` (e1 `\` `[delta g])| &lt;= _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` (e1 `|` e2) `\` `[Œîg]| &lt;= #|` e2 `|` e1 `\` `[Œîg]|</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>94d</q><label class="goal-separator"><hr></label><div class="goal-conclusion">#|` e2 `|` e1 `\` `[Œîg]| &lt;= g</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: fsubset_leq_card.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(e1 `|` e2) `\` `[Œîg] `&lt;=` e2 `|` e1 `\` `[Œîg]</div></blockquote><q>954</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/fsubsetP=&gt; i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><q>8d9</q><q>8e6</q><q>8ee</q><q>910</q><q>948</q><q>94e</q><q>11f</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i \<span class="kr">in</span> (e1 `|` e2) `\` `[Œîg] -&gt;
i \<span class="kr">in</span> e2 `|` e1 `\` `[Œîg]</div></blockquote><q>954</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> !inE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>95e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(i \notin `[Œîg]) &amp;&amp; ((i \<span class="kr">in</span> e1) || (i \<span class="kr">in</span> e2)) -&gt;
(i \<span class="kr">in</span> e2) || (i \notin `[Œîg]) &amp;&amp; (i \<span class="kr">in</span> e1)</div></blockquote><q>954</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="kp">do</span> <span class="mi">2</span> <span class="nb">case</span>: (_ \<span class="kr">in</span> _); <span class="nb">rewrite</span> ?(orbT, orbF).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><q>956</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (_ : #|` e2| + #|` e1 `\` `[delta g]| &lt;= _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e2 `|` e1 `\` `[Œîg]| &lt;=
#|` e2| + #|` e1 `\` `[Œîg]|</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>94d</q><label class="goal-separator"><hr></label><div class="goal-conclusion">#|` e2| + #|` e1 `\` `[Œîg]| &lt;= g</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -cardfsUI leq_addr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><q>96d</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (_ : t + #|` e1 `\` `[delta g]| &lt;= _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e2| + #|` e1 `\` `[Œîg]| &lt;= t + #|` e1 `\` `[Œîg]|</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>94d</q><label class="goal-separator"><hr></label><div class="goal-conclusion">t + #|` e1 `\` `[Œîg]| &lt;= g</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> leq_add2r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><q>977</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: leq_trans (_ : t + #|` sint (delta g) n| &lt;= _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">t + #|` e1 `\` `[Œîg]| &lt;= t + #|` sint (Œîg) n|</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>94d</q><label class="goal-separator"><hr></label><div class="goal-conclusion">t + #|` sint (Œîg) n| &lt;= g</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_add2l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">#|` e1 `\` `[Œîg]| &lt;= #|` sint (Œîg) n|</div></blockquote><q>97f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: fsubset_leq_card.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">e1 `\` `[Œîg] `&lt;=` sint (Œîg) n</div></blockquote><q>97f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/fsubsetP=&gt; i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>95e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">i \<span class="kr">in</span> e1 `\` `[Œîg] -&gt; i \<span class="kr">in</span> sint (Œîg) n</div></blockquote><q>97f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> !(inE, mem_sint) /= -leqNgt =&gt; /andP[-&gt; /(fsubsetP e1Sn)].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>95e</q><span class="goal-separator"><hr></span><div class="goal-conclusion">i \<span class="kr">in</span> `[n] -&gt; true &amp;&amp; (i &lt; n)</div></blockquote><q>97f</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> mem_sint.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><q>981</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> card_sint.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">t + (n - Œîg) &lt;= g</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> [|E] := leqP n (delta g); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>8b6</q><q>8b0</q><q>7d0</q><q>8bc</q><q>8b7</q><q>8bd</q><q>8be</q><q>327</q><q>8ce</q><q>8d9</q><q>8e6</q><q>8ee</q><q>910</q><q>948</q><q>94e</q><div><var>E</var><span class="hyp-type"><b>:</b><span>Œîg &lt; n</span></span></div></div><span class="goal-separator"><hr></span><q>998</q></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>94d</q><label class="goal-separator"><hr></label><div class="goal-conclusion">n &lt;= Œîg -&gt; t + (n - Œîg) &lt;= g</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addnBA; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">apply</span>: ltnW.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>99c</q><span class="goal-separator"><hr></span><div class="goal-conclusion">t + n - Œîg &lt;= g</div></blockquote><q>99e</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_subLR addnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>99c</q><span class="goal-separator"><hr></span><div class="goal-conclusion">n + t &lt;= Œîg + g</div></blockquote><q>99e</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -ltnS -!addnS -deltaS addnS -root_delta_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><q>9a0</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>/eqP-&gt;; <span class="nb">rewrite</span> addn0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>94d</q><span class="goal-separator"><hr></span><div class="goal-conclusion">t &lt;= g</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> root_delta_le deltaS leq_add2r.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* This is 2.8 *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">psi_cap_ge</span> <span class="nv">e1</span> <span class="nv">e2</span> : phi (#|` e1 `|` e2|.+<span class="mi">3</span>) &lt;= (psi e1 + psi e2).*<span class="mi">2</span>.*<span class="mi">2</span> + <span class="mi">5</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>28f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œï(#|` e1 `|` e2|.+<span class="mi">3</span>) &lt;= ((œà(e1) + œà(e2)).*<span class="mi">2</span>).*<span class="mi">2</span> + <span class="mi">5</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>9b1</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(ler_nat int_numDomainType) natrD.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>28f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œï(#|` e1 `|` e2|.+<span class="mi">3</span>)%:R &lt;=
 ((œà(e1) + œà(e2)).*<span class="mi">2</span>).*<span class="mi">2</span>%:R + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -!muln2 !natrM !mulr_natr -mulrnA natrD.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>28f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œï(#|` e1 `|` e2|.+<span class="mi">3</span>)%:R &lt;=
 (œà(e1)%:R + œà(e2)%:R) *+ (<span class="mi">2</span> * <span class="mi">2</span>) + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">set</span> n := #|`_|.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><div><var>n</var><span><span class="hyp-body"><b>:=</b><span>#|` e1 `|` e2|</span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(œï(n.+<span class="mi">3</span>)%:R &lt;= (œà(e1)%:R + œà(e2)%:R) *+ (<span class="mi">2</span> * <span class="mi">2</span>) + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> m := troot (n.+<span class="mi">3</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><div><var>m</var><span><span class="hyp-body"><b>:=</b><span>‚àán.+<span class="mi">3</span></span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><q>9c2</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> p := tmod (n.+<span class="mi">3</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><div><var>p</var><span><span class="hyp-body"><b>:=</b><span>tmod n.+<span class="mi">3</span></span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><q>9c2</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> l := m.-<span class="mi">2</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><div><var>l</var><span><span class="hyp-body"><b>:=</b><span>m.-<span class="mi">2</span></span></span><span class="hyp-type"><b>:</b><span>nat</span></span></span></div></div><span class="goal-separator"><hr></span><q>9c2</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> mG2 : m &gt;= <span class="mi">2</span> <span class="bp">by</span> <span class="nb">rewrite</span> root_delta_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><div><var>mG2</var><span class="hyp-type"><b>:</b><span><span class="mi">1</span> &lt; m</span></span></div></div><span class="goal-separator"><hr></span><q>9c2</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> pLm : p &lt;= m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9d5</q><span class="goal-separator"><hr></span><div class="goal-conclusion">p &lt;= m</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><div><var>pLm</var><span class="hyp-type"><b>:</b><span>p &lt;= m</span></span></div></div><label class="goal-separator"><hr></label><q>9c2</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> leq_subLR -ltnS -[X <span class="kr">in</span> _ &lt; X]addnS -deltaS -root_delta_lt ltnS.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9dd</q><span class="goal-separator"><hr></span><q>9c2</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> nG : n &gt;= delta l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9dd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">Œîl &lt;= n</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><div><var>nG</var><span class="hyp-type"><b>:</b><span>Œîl &lt;= n</span></span></div></div><label class="goal-separator"><hr></label><q>9c2</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -[n]/(n.+<span class="mi">3</span>.-<span class="mi">2</span>.-<span class="mi">1</span>) [n.+<span class="mi">3</span>]tmodE /l -/m.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9dd</q><span class="goal-separator"><hr></span><div class="goal-conclusion">Œîm.-<span class="mi">2</span> &lt;= (Œîm + tmod n.+<span class="mi">3</span>).-<span class="mi">1</span>.-<span class="mi">2</span></div></blockquote><q>9e6</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: (m) mG2 =&gt; // [] [|] // m1 _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9de</q><div><var>m1</var><span class="hyp-type"><b>:</b><span>nat</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Œîm1.+<span class="mi">2</span>.-<span class="mi">2</span> &lt;= (Œîm1.+<span class="mi">2</span> + tmod n.+<span class="mi">3</span>).-<span class="mi">1</span>.-<span class="mi">2</span></div></blockquote><q>9e6</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> deltaS deltaS /= !(addSn, addnS, subSS, subn0) -!addnA leq_addr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><q>9c2</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: le_trans (_ : ((psi_aux l `[<span class="mi">0</span>] + psi_aux l `[n]) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R &lt;= _))%R; 
     <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((œà&#39;(l) `[<span class="mi">0</span>] + œà&#39;(l) `[n]) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R &lt;=
 (œà(e1)%:R + œà(e2)%:R) *+ (<span class="mi">2</span> * <span class="mi">2</span>) + <span class="mi">5</span>%:R)%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>9e8</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(œï(n.+<span class="mi">3</span>)%:R &lt;= (œà&#39;(l) `[<span class="mi">0</span>] + œà&#39;(l) `[n]) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ler_add2r ler_muln2r orFb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) `[<span class="mi">0</span>] + œà&#39;(l) `[n] &lt;= œà(e1)%:R + œà(e2)%:R)%R</div></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: le_trans (_ : psi_aux l e1 + psi_aux l e2 &lt;= _)%R; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) e1 + œà&#39;(l) e2 &lt;= œà(e1)%:R + œà(e2)%:R)%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>9e8</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(œà&#39;(l) `[<span class="mi">0</span>] + œà&#39;(l) `[n] &lt;= œà&#39;(l) e1 + œà&#39;(l) e2)%R</div></blockquote><q>9fc</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: ler_add; <span class="nb">apply</span>: psi_max.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><q>a08</q></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: le_trans (_ : psi_aux l (e1 `&amp;` e2) + psi_aux l (e1 `|` e2) &lt;= _)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) `[<span class="mi">0</span>] + œà&#39;(l) `[n] &lt;=
 œà&#39;(l) (e1 `&amp;` e2) + œà&#39;(l) (e1 `|` e2))%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>9e8</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(œà&#39;(l) (e1 `&amp;` e2) + œà&#39;(l) (e1 `|` e2) &lt;=
 œà&#39;(l) e1 + œà&#39;(l) e2)%R</div></blockquote><q>9fc</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: ler_add; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">apply</span>: psi_aux_card_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œà&#39;(l) `[<span class="mi">0</span>] &lt;= œà&#39;(l) (e1 `&amp;` e2))%R</div></blockquote><q>a10</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: psi_aux_sub; <span class="nb">rewrite</span> sint0_set0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">fset0 `&lt;=` e1 `&amp;` e2</div></blockquote><q>a10</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>/fsubsetP=&gt; i; <span class="nb">rewrite</span> inE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><q>a12</q></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /psi_aux.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e1 `&amp;` e2) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
 (l * <span class="mi">2</span> ^ l)%:R +
 (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> +
   \sum_(i &lt;- (e1 `|` e2)) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
  (l * <span class="mi">2</span> ^ l)%:R) &lt;=
 ((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
 (l * <span class="mi">2</span> ^ l)%:R +
 (((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
  (l * <span class="mi">2</span> ^ l)%:R))%R</div></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> !natrD !addrA ler_add // -!addrA ler_add //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((\sum_(i &lt;- e1 `&amp;` e2) <span class="mi">2</span> ^ minn (‚àái) l)%:R +
 (<span class="mi">1</span> *- (l * <span class="mi">2</span> ^ l) +
  ((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R +
   (\sum_(i &lt;- (e1 `|` e2)) <span class="mi">2</span> ^ minn (‚àái) l)%:R)) &lt;=
 (\sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l)%:R +
 (<span class="mi">1</span> *- (l * <span class="mi">2</span> ^ l) +
  ((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R + (\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l)%:R)))%R</div></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addrCA [X <span class="kr">in</span> (_ &lt;= X)%R]addrCA ler_add //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((\sum_(i &lt;- e1 `&amp;` e2) <span class="mi">2</span> ^ minn (‚àái) l)%:R +
 ((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R +
  (\sum_(i &lt;- (e1 `|` e2)) <span class="mi">2</span> ^ minn (‚àái) l)%:R) &lt;=
 (\sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l)%:R +
 ((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R + (\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l)%:R))%R</div></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addrCA [X <span class="kr">in</span> (_ &lt;= X)%R]addrCA ler_add //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((\sum_(i &lt;- e1 `&amp;` e2) <span class="mi">2</span> ^ minn (‚àái) l)%:R +
 (\sum_(i &lt;- (e1 `|` e2)) <span class="mi">2</span> ^ minn (‚àái) l)%:R &lt;=
 (\sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l)%:R +
 (\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l)%:R)%R</div></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -!natrD ler_nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e1 `&amp;` e2) <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- (e1 `|` e2)) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e1) <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [X <span class="kr">in</span> _ &lt;= X + _](bigID (<span class="kr">fun</span> <span class="nv">i</span> =&gt; i \<span class="kr">in</span> e2)) /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e1 `&amp;` e2) <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- (e1 `|` e2)) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e1 | i \<span class="kr">in</span> e2) <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- e1 | i \notin e2) <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -!addnA leq_add //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e1 `&amp;` e2) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e1 | i \<span class="kr">in</span> e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>9e8</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- (e1 `|` e2)) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e1 | i \notin e2) <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>9fc</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_eqVlt; <span class="nb">apply</span>/orP; <span class="nb">left</span>; <span class="nb">apply</span>/eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- e1 `&amp;` e2) <span class="mi">2</span> ^ minn (‚àái) l =
\sum_(i &lt;- e1 | i \<span class="kr">in</span> e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>a3a</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: eq_fbigl_cond =&gt; i; <span class="nb">rewrite</span> !inE /= andbT.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><q>a3c</q></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [X <span class="kr">in</span> X &lt;= _](bigID (<span class="kr">fun</span> <span class="nv">i</span> =&gt; i \<span class="kr">in</span> e2)) /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- (e1 `|` e2) | i \<span class="kr">in</span> e2) <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- (e1 `|` e2) | i \notin e2) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e1 | i \notin e2) <span class="mi">2</span> ^ minn (‚àái) l +
\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addnC leq_add //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- (e1 `|` e2) | i \notin e2) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e1 | i \notin e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>9e8</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- (e1 `|` e2) | i \<span class="kr">in</span> e2) <span class="mi">2</span> ^ minn (‚àái) l &lt;=
\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>9fc</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_eqVlt; <span class="nb">apply</span>/orP; <span class="nb">left</span>; <span class="nb">apply</span>/eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- (e1 `|` e2) | i \notin e2) <span class="mi">2</span> ^ minn (‚àái) l =
\sum_(i &lt;- e1 | i \notin e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>a4c</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: eq_fbigl_cond =&gt; i; <span class="nb">rewrite</span> !inE /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>11f</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((i \<span class="kr">in</span> e1) || (i \<span class="kr">in</span> e2)) &amp;&amp; (i \notin e2) =
(i \<span class="kr">in</span> [eta mem_seq e1]) &amp;&amp; (i \notin e2)</div></blockquote><q>a4c</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: (_ \<span class="kr">in</span> e2); <span class="nb">rewrite</span> ?(andbT, orbT, andbF, orbF).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><q>a4e</q></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> leq_eqVlt; <span class="nb">apply</span>/orP; <span class="nb">left</span>; <span class="nb">apply</span>/eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- (e1 `|` e2) | i \<span class="kr">in</span> e2) <span class="mi">2</span> ^ minn (‚àái) l =
\sum_(i &lt;- e2) <span class="mi">2</span> ^ minn (‚àái) l</div></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: eq_fbigl_cond =&gt; i; <span class="nb">rewrite</span> !inE /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a56</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((i \<span class="kr">in</span> e1) || (i \<span class="kr">in</span> e2)) &amp;&amp; (i \<span class="kr">in</span> e2) =
(i \<span class="kr">in</span> [eta mem_seq e2]) &amp;&amp; true</div></blockquote><q>9fb</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: (_ \<span class="kr">in</span> e2); <span class="nb">rewrite</span> /= ?(andbT, orbT, andbF, orbF).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><q>9fd</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> pE : phi (n.+<span class="mi">3</span>) = ((m + p - <span class="mi">1</span>) * <span class="mi">2</span> ^ m).+<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œï(n.+<span class="mi">3</span>) = ((m + p - <span class="mi">1</span>) * <span class="mi">2</span> ^ m).+<span class="mi">1</span></div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><div><var>pE</var><span class="hyp-type"><b>:</b><span>œï(n.+<span class="mi">3</span>) = ((m + p - <span class="mi">1</span>) * <span class="mi">2</span> ^ m).+<span class="mi">1</span></span></span></div></div><label class="goal-separator"><hr></label><q>9fd</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> phi_modE -/m -/p -{<span class="mi">1</span> <span class="mi">4</span>}[m]prednK <span class="mi">1</span><span class="nl">?ltnW</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">1</span> + (m.-<span class="mi">1</span>.+<span class="mi">1</span> + p) * <span class="mi">2</span> ^ m - <span class="mi">2</span> ^ m =
((m.-<span class="mi">1</span>.+<span class="mi">1</span> + p - <span class="mi">1</span>) * <span class="mi">2</span> ^ m).+<span class="mi">1</span></div></blockquote><q>a6a</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [(_ + p)%N]addSn mulSn [(<span class="mi">2</span> ^ _ + _)%nat]addnC addnA addnK.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>9e8</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">1</span> + (m.-<span class="mi">1</span> + p) * <span class="mi">2</span> ^ m)%N =
(((m.-<span class="mi">1</span> + p).+<span class="mi">1</span> - <span class="mi">1</span>) * <span class="mi">2</span> ^ m).+<span class="mi">1</span></div></blockquote><q>a6a</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -subn1 -[(_ + _).+<span class="mi">1</span>]addn1 addnK.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a6c</q><span class="goal-separator"><hr></span><q>9fd</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> pdE : ((phi (delta l))%:R = <span class="mi">1</span> + (l%:R - <span class="mi">1</span>) * (<span class="mi">2</span> ^ l)%:R :&gt; int)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a6c</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œï(Œîl)%:R)%R = (<span class="mi">1</span> + (l%:R - <span class="mi">1</span>) * (<span class="mi">2</span> ^ l)%:R)%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><div><var>pdE</var><span class="hyp-type"><b>:</b><span>(œï(Œîl)%:R)%R = (<span class="mi">1</span> + (l%:R - <span class="mi">1</span>) * (<span class="mi">2</span> ^ l)%:R)%R</span></span></div></div><label class="goal-separator"><hr></label><q>9fd</q></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> phi_deltaE natrB; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a6c</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ l &lt;= <span class="mi">1</span> + l * <span class="mi">2</span> ^ l</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>a6c</q><label class="goal-separator"><hr></label><div class="goal-conclusion">((<span class="mi">1</span> + l * <span class="mi">2</span> ^ l)%:R - (<span class="mi">2</span> ^ l)%:R)%R =
(<span class="mi">1</span> + (l%:R - <span class="mi">1</span>) * (<span class="mi">2</span> ^ l)%:R)%R</div></blockquote><q>a7e</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: (l) =&gt; // l1; <span class="nb">rewrite</span> mulSn addnCA leq_addr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a6c</q><span class="goal-separator"><hr></span><q>a87</q></blockquote><q>a7d</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> natrD /= mulrBl mul1r addrA -natrM.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a7f</q><span class="goal-separator"><hr></span><q>9fd</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> le_eqVlt; <span class="nb">apply</span>/orP; <span class="nb">left</span>; <span class="nb">apply</span>/eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a7f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œï(n.+<span class="mi">3</span>)%:R)%R =
((œà&#39;(l) `[<span class="mi">0</span>] + œà&#39;(l) `[n]) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp"><span class="c">(* right part *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> psi_aux_sintE // psi_auxE_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a7f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œï(n.+<span class="mi">3</span>)%:R)%R =
((((<span class="mi">2</span> ^ l).-<span class="mi">1</span> + \sum_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">0</span>) <span class="mi">2</span> ^ minn (‚àái) l)%:R -
  (l * <span class="mi">2</span> ^ l)%:R +
  (((<span class="mi">2</span> ^ l *
     #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt;= ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
    \sum_(i &lt;- `[n] | (‚àái &lt; l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
   (l * <span class="mi">2</span> ^ l)%:R)) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">pose</span> f i := <span class="mi">2</span> ^ minn (‚àái) l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q></div><span class="goal-separator"><hr></span><q>a95</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> !(big_mkord _ f) big_ord0 addn0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œï(n.+<span class="mi">3</span>)%:R)%R =
(((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R - (l * <span class="mi">2</span> ^ l)%:R +
  (((<span class="mi">2</span> ^ l *
     #|` [fset i | i <span class="kr">in</span> `[n] &amp; (l &lt;= ‚àái)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
    \sum_(i &lt;- `[n] | (‚àái &lt; l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
   (l * <span class="mi">2</span> ^ l)%:R)) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> -&gt; : [fset i <span class="kr">in</span> `[n] | l &lt;= troot i] = [fset i <span class="kr">in</span> `[n] | delta l &lt;= i].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">[fset i | i <span class="kr">in</span> `[n] &amp; l &lt;= ‚àái] =
[fset i | i <span class="kr">in</span> `[n] &amp; Œîl &lt;= i]</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>a99</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(œï(n.+<span class="mi">3</span>)%:R)%R =
(((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R - (l * <span class="mi">2</span> ^ l)%:R +
  (((<span class="mi">2</span> ^ l *
     #|` [fset i | i <span class="kr">in</span> `[n] &amp; (Œîl &lt;= i)%N]|.+<span class="mi">1</span>).-<span class="mi">1</span> +
    \sum_(i &lt;- `[n] | (‚àái &lt; l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
   (l * <span class="mi">2</span> ^ l)%:R)) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>/fsetP=&gt; i; <span class="nb">rewrite</span> !inE root_delta_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><q>aa4</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">have</span> /(sint_sub n)-&gt; : <span class="mi">0</span> &lt;= delta l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt;= Œîl</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>a99</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(œï(n.+<span class="mi">3</span>)%:R)%R =
(((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R - (l * <span class="mi">2</span> ^ l)%:R +
  (((<span class="mi">2</span> ^ l * #|` sint (Œîl) n|.+<span class="mi">1</span>).-<span class="mi">1</span> +
    \sum_(i &lt;- `[n] | (‚àái &lt; l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
   (l * <span class="mi">2</span> ^ l)%:R)) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: (@delta_le <span class="mi">0</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><q>aae</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> card_sint //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(œï(n.+<span class="mi">3</span>)%:R)%R =
(((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R - (l * <span class="mi">2</span> ^ l)%:R +
  (((<span class="mi">2</span> ^ l * (n - Œîl).+<span class="mi">1</span>).-<span class="mi">1</span> +
    \sum_(i &lt;- `[n] | (‚àái &lt; l)%N) <span class="mi">2</span> ^ ‚àái)%:R -
   (l * <span class="mi">2</span> ^ l)%:R)) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (_ : \sum_(_ &lt;- _ | _) _  = phi (delta l)); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(H &lt;- `[n] | ‚àáH &lt; l) <span class="mi">2</span> ^ ‚àáH = œï(Œîl)</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>a99</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(œï(n.+<span class="mi">3</span>)%:R)%R =
(((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R - (l * <span class="mi">2</span> ^ l)%:R +
  (((<span class="mi">2</span> ^ l * (n - Œîl).+<span class="mi">1</span>).-<span class="mi">1</span> + œï(Œîl))%:R -
   (l * <span class="mi">2</span> ^ l)%:R)) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> phiE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(H &lt;- `[n] | ‚àáH &lt; l) <span class="mi">2</span> ^ ‚àáH =
\sum_(i &lt; Œîl) <span class="mi">2</span> ^ ‚àái</div></blockquote><q>aba</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [LHS](eq_bigl (<span class="kr">fun</span> <span class="nv">i</span> =&gt; (i &lt; n) &amp;&amp; (‚àái &lt; l))); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">fun</span> <span class="nv">i</span> : nat =&gt; ‚àái &lt; l) =<span class="mi">1</span>
(<span class="kr">fun</span> <span class="nv">i</span> : nat =&gt; (i &lt; n) &amp;&amp; (‚àái &lt; l))</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>a99</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- `[n] | (i &lt; n) &amp;&amp; (‚àái &lt; l)) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œîl) <span class="mi">2</span> ^ ‚àái</div></blockquote><q>abb</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; i; <span class="nb">case</span>: leqP; <span class="nb">rewrite</span> ?(andbT, andbF) // root_delta_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>150</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i &lt; Œîl -&gt; true = (i &lt; n)</div></blockquote><q>ac5</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>/(leq_trans)-&gt;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><q>ac7</q></blockquote><q>aba</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [RHS](eq_bigl 
        (<span class="kr">fun</span> <span class="nv">i</span> : &#39;I_ _ =&gt; ((i : nat) \<span class="kr">in</span> (enum_fset `[n])))); <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">xpredT =<span class="mi">1</span> (<span class="kr">fun</span> <span class="nv">i</span> : &#39;I_(Œîl) =&gt; i \<span class="kr">in</span> `[n])</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>a99</q><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- `[n] | (i &lt; n) &amp;&amp; (‚àái &lt; l)) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œîl | i \<span class="kr">in</span> `[n]) <span class="mi">2</span> ^ ‚àái</div></blockquote><q>abb</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>=&gt; i; <span class="nb">rewrite</span> mem_sint (leq_trans (ltn_ord _)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><q>ad6</q></blockquote><q>aba</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">elim</span>: enum_fset (fset_uniq `[n]) =&gt; /= [_|a l1 IH /andP[aNIl lU]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt;- [::] | (i &lt; n) &amp;&amp; (‚àái &lt; l)) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œîl | i \<span class="kr">in</span> [::]) <span class="mi">2</span> ^ ‚àái</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>a</q><div><var>l1</var><span class="hyp-type"><b>:</b><span>seq nat</span></span></div><div><var>IH</var><span class="hyp-type"><b>:</b><span>uniq l1 -&gt;
\sum_(i &lt;- l1 | (i &lt; n) &amp;&amp; (‚àái &lt; l)) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œîl | i \<span class="kr">in</span> l1) <span class="mi">2</span> ^ ‚àái</span></span></div><div><var>aNIl</var><span class="hyp-type"><b>:</b><span>a \notin l1</span></span></div><div><var>lU</var><span class="hyp-type"><b>:</b><span>uniq l1</span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">\sum_(i &lt;- (a :: l1) | (i &lt; n) &amp;&amp; (‚àái &lt; l)) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œîl | i \<span class="kr">in</span> a :: l1) <span class="mi">2</span> ^ ‚àái</div></blockquote><q>abb</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> big_nil big1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>ae0</q><span class="goal-separator"><hr></span><q>ae5</q></blockquote><q>aba</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> big_cons /= IH //; <span class="nb">case</span>: (boolP (a &lt; n)) =&gt; aLn /=; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>a</q><q>ae1</q><q>ae2</q><q>ae3</q><q>ae4</q><q>65f</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt; Œîl | i \<span class="kr">in</span> l1) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œîl | i \<span class="kr">in</span> a :: l1) <span class="mi">2</span> ^ ‚àái</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>a</q><q>ae1</q><q>ae2</q><q>ae3</q><q>ae4</q><q>664</q></div><label class="goal-separator"><hr></label><div class="goal-conclusion">(<span class="kr">if</span> ‚àáa &lt; l
 <span class="kr">then</span> (<span class="mi">2</span> ^ ‚àáa + \sum_(i &lt; Œîl | i \<span class="kr">in</span> l1) <span class="mi">2</span> ^ ‚àái)%N
 <span class="kr">else</span> \sum_(i &lt; Œîl | i \<span class="kr">in</span> l1) <span class="mi">2</span> ^ ‚àái) =
\sum_(i &lt; Œîl | i \<span class="kr">in</span> a :: l1) <span class="mi">2</span> ^ ‚àái</div></blockquote><q>abb</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: eq_bigl =&gt; i; <span class="nb">move</span>: (ltn_ord i); <span class="nb">rewrite</span> inE; <span class="nb">case</span>: eqP =&gt; [-&gt;| //].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>a</q><q>ae1</q><q>ae2</q><q>ae3</q><q>ae4</q><q>65f</q><div><var>i</var><span class="hyp-type"><b>:</b><span>&#39;I_(Œîl)</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a &lt; Œîl -&gt; (a \<span class="kr">in</span> l1) = true || (a \<span class="kr">in</span> l1)</div></blockquote><q>aee</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">move</span>=&gt; /leq_trans/(_ nG); <span class="nb">rewrite</span> (negPf aLn).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>af0</q><span class="goal-separator"><hr></span><q>af1</q></blockquote><q>aba</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: leqP =&gt; aLl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>a</q><q>ae1</q><q>ae2</q><q>ae3</q><q>ae4</q><q>664</q><div><var>aLl</var><span class="hyp-type"><b>:</b><span>l &lt;= ‚àáa</span></span></div></div><span class="goal-separator"><hr></span><q>aed</q></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>a</q><q>ae1</q><q>ae2</q><q>ae3</q><q>ae4</q><q>664</q><div><var>aLl</var><span class="hyp-type"><b>:</b><span>‚àáa &lt; l</span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">(<span class="mi">2</span> ^ ‚àáa + \sum_(i &lt; Œîl | i \<span class="kr">in</span> l1) <span class="mi">2</span> ^ ‚àái)%N =
\sum_(i &lt; Œîl | i \<span class="kr">in</span> a :: l1) <span class="mi">2</span> ^ ‚àái</div></blockquote><q>abb</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: eq_bigl =&gt; i; <span class="nb">move</span>: (ltn_ord i); <span class="nb">rewrite</span> inE; <span class="nb">case</span>: eqP =&gt; [-&gt;| //].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>a</q><q>ae1</q><q>ae2</q><q>ae3</q><q>ae4</q><q>664</q><q>aff</q><q>af6</q></div><span class="goal-separator"><hr></span><q>af7</q></blockquote><q>b00</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> -root_delta_lt ltnNge aLl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b02</q><span class="goal-separator"><hr></span><q>b04</q></blockquote><q>aba</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> root_delta_lt <span class="kr">in</span> aLl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>a</q><q>ae1</q><q>ae2</q><q>ae3</q><q>ae4</q><q>664</q><div><var>aLl</var><span class="hyp-type"><b>:</b><span>a &lt; Œîl</span></span></div></div><span class="goal-separator"><hr></span><q>b04</q></blockquote><q>aba</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [RHS](bigD1 (Ordinal aLl)); <span class="nb">apply</span>/eqP; <span class="nb">last</span> <span class="bp">by</span> <span class="nb">rewrite</span> inE eqxx.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b0f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="mi">2</span> ^ ‚àáa + \sum_(i &lt; Œîl | i \<span class="kr">in</span> l1) <span class="mi">2</span> ^ ‚àái)%N ==
addn_comoid (<span class="mi">2</span> ^ ‚àá(Ordinal aLl))
  (\big[addn_comoid/<span class="mi">0</span>]_(i | (i \<span class="kr">in</span> a :: l1) &amp;&amp;
                            (i != Ordinal aLl)) <span class="mi">2</span> ^ ‚àái)</div></blockquote><q>aba</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> /= eqn_add2l; <span class="nb">apply</span>/eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b0f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt; Œîl | i \<span class="kr">in</span> l1) <span class="mi">2</span> ^ ‚àái =
\sum_(i &lt; Œîl | (i \<span class="kr">in</span> a :: l1) &amp;&amp; (i != Ordinal aLl))
   <span class="mi">2</span> ^ ‚àái</div></blockquote><q>aba</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: eq_bigl =&gt; i; <span class="nb">rewrite</span> !inE /= -val_eqE /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>a</q><q>ae1</q><q>ae2</q><q>ae3</q><q>ae4</q><q>664</q><q>b10</q><q>af6</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(i \<span class="kr">in</span> l1) = ((i == a) || (i \<span class="kr">in</span> l1)) &amp;&amp; (i != a)</div></blockquote><q>aba</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">case</span>: eqP (ltn_ord i) =&gt; [-&gt;|]; <span class="nb">rewrite</span>?(andbT, negPf aNIl).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><q>abc</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp"><span class="c">(* right part *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>: etrans
 (_ : ((<span class="mi">2</span> ^ l)%:R * (m.-<span class="mi">1</span> + p)%:R - <span class="mi">1</span>%:R) *+<span class="mi">4</span> + <span class="mi">5</span>%:R = _)%R; <span class="nb">last first</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((<span class="mi">2</span> ^ l)%:R * (m.-<span class="mi">1</span> + p)%:R - <span class="mi">1</span>%:R) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R =
(((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R - (l * <span class="mi">2</span> ^ l)%:R +
  (((<span class="mi">2</span> ^ l * (n - Œîl).+<span class="mi">1</span>).-<span class="mi">1</span> + œï(Œîl))%:R -
   (l * <span class="mi">2</span> ^ l)%:R)) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>a99</q><label class="goal-separator"><hr></label><div class="goal-conclusion">(œï(n.+<span class="mi">3</span>)%:R)%R =
(((<span class="mi">2</span> ^ l)%:R * (m.-<span class="mi">1</span> + p)%:R - <span class="mi">1</span>%:R) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp"> </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">congr</span> (_ *+ _ + _)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l)%:R * (m.-<span class="mi">1</span> + p)%:R - <span class="mi">1</span>%:R)%R =
((<span class="mi">2</span> ^ l).-<span class="mi">1</span>%:R - (l * <span class="mi">2</span> ^ l)%:R +
 (((<span class="mi">2</span> ^ l * (n - Œîl).+<span class="mi">1</span>).-<span class="mi">1</span> + œï(Œîl))%:R -
  (l * <span class="mi">2</span> ^ l)%:R))%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -!subn1 ![<span class="kr">in</span> RHS](natrD, natrM, natrB) <span class="nl">?muln_gt0</span> <span class="nl">?expn_gt0</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ l)%:R * (m - <span class="mi">1</span> + p)%:R - <span class="mi">1</span>%:R)%R =
((<span class="mi">2</span> ^ l)%:R - <span class="mi">1</span>%:R - l%:R * (<span class="mi">2</span> ^ l)%:R +
 ((<span class="mi">2</span> ^ l)%:R * (n - Œîl).+<span class="mi">1</span>%:R - <span class="mi">1</span>%:R + œï(Œîl)%:R -
  l%:R * (<span class="mi">2</span> ^ l)%:R))%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> pdE !addrA addrK; <span class="nb">set</span> u := (<span class="mi">2</span> ^ l)%:R%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9d6</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><div><var>u</var><span><span class="hyp-body"><b>:=</b><span>((<span class="mi">2</span> ^ l)%:R)%R</span></span><span class="hyp-type"><b>:</b><span>Num.NumDomain.porder_ringType int_numDomainType</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(u * (m - <span class="mi">1</span> + p)%:R - <span class="mi">1</span>%:R)%R =
(u - <span class="mi">1</span>%:R - l%:R * u + u * (n - Œîl).+<span class="mi">1</span>%:R +
 (l%:R - <span class="mi">1</span>) * u - l%:R * u)%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> [(u - <span class="mi">1</span>)%R]addrC -![<span class="kr">in</span> RHS]addrA [RHS]addrC; <span class="nb">congr</span> (_ - _)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b33</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(u * (m - <span class="mi">1</span> + p)%:R)%R =
(u +
 (- (l%:R * u) +
  (u * (n - Œîl).+<span class="mi">1</span>%:R + ((l%:R - <span class="mi">1</span>) * u - l%:R * u))))%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -{<span class="mi">2</span>}[u]mul1r ![(u * _)%R]mulrC -![(-(_ * u))%R]mulNr -!mulrDl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b33</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((m - <span class="mi">1</span> + p)%:R * u)%R =
((<span class="mi">1</span> + (<span class="mi">1</span> *- l + ((n - Œîl).+<span class="mi">1</span>%:R + (l%:R - <span class="mi">1</span> - l%:R)))) *
 u)%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">congr</span> (_ * _)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b33</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((m - <span class="mi">1</span> + p)%:R)%R =
(<span class="mi">1</span> + (<span class="mi">1</span> *- l + ((n - Œîl).+<span class="mi">1</span>%:R + (l%:R - <span class="mi">1</span> - l%:R))))%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> {u}!addrA addrAC addrK.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((m - <span class="mi">1</span> + p)%:R)%R = (<span class="mi">1</span> - l%:R + (n - Œîl).+<span class="mi">1</span>%:R - <span class="mi">1</span>)%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -[(_ - _).+<span class="mi">1</span>]addn1 [<span class="kr">in</span> RHS]natrD !addrA addrK.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((m - <span class="mi">1</span> + p)%:R)%R = (<span class="mi">1</span> - l%:R + (n - Œîl)%:R)%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -[n]/(n.+<span class="mi">3</span>.-<span class="mi">2</span>.-<span class="mi">1</span>) [n.+<span class="mi">3</span>]tmodE -/m -/p.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((m - <span class="mi">1</span> + p)%:R)%R =
(<span class="mi">1</span> - l%:R + ((Œîm + p).-<span class="mi">1</span>.-<span class="mi">2</span> - Œîl)%:R)%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -[<span class="kr">in</span> RHS](subnK mG2) ![<span class="kr">in</span> RHS](addnS, addn0) !deltaS !(subnS, subn0).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((m.-<span class="mi">1</span> + p)%:R)%R =
(<span class="mi">1</span> - l%:R +
 ((Œîm.-<span class="mi">2</span> + m.-<span class="mi">2</span>.+<span class="mi">1</span> + m.-<span class="mi">2</span>.+<span class="mi">2</span> + p).-<span class="mi">1</span>.-<span class="mi">2</span> - Œîl)%:R)%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> ![<span class="kr">in</span> RHS](addnS, addSn) -!addnA [(delta _ + _)%nat]addnC addnK -/l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((m.-<span class="mi">1</span> + p)%:R)%R = (<span class="mi">1</span> - l%:R + (l + (l + p))%:R)%R</div></blockquote><q>b25</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> ![<span class="kr">in</span> RHS]natrD !addrA subrK /l -(natrD _ <span class="mi">1</span>%nat) -natrD.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><q>b27</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp"><span class="c">(* left part *)</span>
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> pE /l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>a99</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((m + p - <span class="mi">1</span>) * <span class="mi">2</span> ^ m).+<span class="mi">1</span>%:R)%R =
(((<span class="mi">2</span> ^ m.-<span class="mi">2</span>)%:R * (m.-<span class="mi">1</span> + p)%:R - <span class="mi">1</span>%:R) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">case</span>: (m) mG2 =&gt; // [] [|m1] //= _.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>f7</q><q>9c1</q><q>9c7</q><q>9cc</q><q>9d1</q><q>9de</q><q>9e9</q><q>a6d</q><q>a80</q><q>79f</q><q>9f2</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(((m1.+<span class="mi">2</span> + p - <span class="mi">1</span>) * <span class="mi">2</span> ^ m1.+<span class="mi">2</span>).+<span class="mi">1</span>%:R)%R =
(((<span class="mi">2</span> ^ m1)%:R * (m1.+<span class="mi">1</span> + p)%:R - <span class="mi">1</span>%:R) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> addSn subn1 /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b60</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((m1.+<span class="mi">1</span> + p) * <span class="mi">2</span> ^ m1.+<span class="mi">2</span>).+<span class="mi">1</span>%:R)%R =
(((<span class="mi">2</span> ^ m1)%:R * (m1.+<span class="mi">1</span> + p)%:R - <span class="mi">1</span>%:R) *+ <span class="mi">4</span> + <span class="mi">5</span>%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (_ : <span class="mi">5</span>%:R = <span class="mi">1</span> *+ <span class="mi">4</span> + <span class="mi">1</span>)%R // addrA -mulrnDl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b60</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((m1.+<span class="mi">1</span> + p) * <span class="mi">2</span> ^ m1.+<span class="mi">2</span>).+<span class="mi">1</span>%:R)%R =
(((<span class="mi">2</span> ^ m1)%:R * (m1.+<span class="mi">1</span> + p)%:R - <span class="mi">1</span>%:R + <span class="mi">1</span>) *+ <span class="mi">4</span> + <span class="mi">1</span>)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> subrK -addn1 natrD; <span class="nb">congr</span> (_ + _)%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b60</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(((m1.+<span class="mi">1</span> + p) * <span class="mi">2</span> ^ m1.+<span class="mi">2</span>)%:R)%R =
((<span class="mi">2</span> ^ m1)%:R * (m1.+<span class="mi">1</span> + p)%:R *+ <span class="mi">4</span>)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -[<span class="kr">in</span> RHS]mulr_natr -!natrM [<span class="kr">in</span> RHS]mulnAC mulnC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b60</q><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">2</span> ^ m1.+<span class="mi">2</span> * (m1.+<span class="mi">1</span> + p))%:R)%R =
((<span class="mi">2</span> ^ m1 * <span class="mi">4</span> * (m1.+<span class="mi">1</span> + p))%:R)%R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">congr</span> (_ * _)%:R%R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b60</q><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ m1.+<span class="mi">2</span> = <span class="mi">2</span> ^ m1 * <span class="mi">4</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> mulnC !expnS !mulnA.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">phi_3_5_4_phi</span> <span class="nv">n</span> : phi (n.+<span class="mi">3</span>) = (psi `[n.+<span class="mi">2</span>]).*<span class="mi">2</span>.+<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œï(n.+<span class="mi">3</span>) = œà(`[n.+<span class="mi">2</span>]).*<span class="mi">2</span>.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>b77</q></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> psi_sint_phi prednK <span class="nl">?phi_gt0</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">phi_3_5_4_sum</span> <span class="nv">n</span> :
   phi (n.+<span class="mi">3</span>) = (\sum_(<span class="mi">1</span> &lt;= i &lt; n.+<span class="mi">3</span>) <span class="mi">2</span> ^ troot i).+<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">œï(n.+<span class="mi">3</span>) = (\sum_(<span class="mi">1</span> &lt;= i &lt; n.+<span class="mi">3</span>) <span class="mi">2</span> ^ ‚àái).+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>b7c</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> phiE.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(i &lt; n.+<span class="mi">3</span>) <span class="mi">2</span> ^ ‚àái =
(\sum_(<span class="mi">1</span> &lt;= i &lt; n.+<span class="mi">3</span>) <span class="mi">2</span> ^ ‚àái).+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> -(big_mkord xpredT (<span class="kr">fun</span> <span class="nv">i</span> =&gt; <span class="mi">2</span> ^ troot i)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">\sum_(<span class="mi">0</span> &lt;= i &lt; n.+<span class="mi">3</span>) <span class="mi">2</span> ^ ‚àái =
(\sum_(<span class="mi">1</span> &lt;= i &lt; n.+<span class="mi">3</span>) <span class="mi">2</span> ^ ‚àái).+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> (big_cat_nat _ _ _ (_ : <span class="mi">0</span> &lt;= <span class="mi">1</span>)) //=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>2dc</q><span class="goal-separator"><hr></span><div class="goal-conclusion">(\sum_(<span class="mi">0</span> &lt;= i &lt; <span class="mi">1</span>) <span class="mi">2</span> ^ ‚àái +
 \sum_(<span class="mi">1</span> &lt;= i &lt; n.+<span class="mi">3</span>) <span class="mi">2</span> ^ ‚àái)%N =
(\sum_(<span class="mi">1</span> &lt;= i &lt; n.+<span class="mi">3</span>) <span class="mi">2</span> ^ ‚àái).+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> big_nat_recl //= big_mkord big_ord0 addn0 add1n.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">PsiDef</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">ltn_diff_ord_max</span> <span class="nv">n</span> (<span class="nv">i</span> : &#39;I_n.+<span class="mi">2</span>) : i != ord_max -&gt; i &lt; n.+<span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><div><var>i</var><span class="hyp-type"><b>:</b><span>&#39;I_n.+<span class="mi">2</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i != ord_max -&gt; i &lt; n.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>b8d</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>/eqP/val_eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b8f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">val i != val ord_max -&gt; i &lt; n.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">have</span> := ltn_ord i; <span class="nb">rewrite</span> ltnS leq_eqVlt =&gt; /orP[-&gt;|].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">lift_diff_ord_max</span> <span class="nv">n</span> (<span class="nv">i</span> : &#39;I_n.+<span class="mi">2</span>) :
  i != ord_max -&gt; lift ord_max (inord i) = i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b8f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">i != ord_max -&gt; lift ord_max (inord i) = i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>b98</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">move</span>=&gt; iDm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>b90</q><div><var>iDm</var><span class="hyp-type"><b>:</b><span>i != ord_max</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">lift ord_max (inord i) = i</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/val_eqP; <span class="nb">rewrite</span> [val (lift _ _)]lift_max /= <span class="nl">?inordK</span> //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>b9f</q><span class="goal-separator"><hr></span><div class="goal-conclusion">i &lt; n.+<span class="mi">1</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">apply</span>: ltn_diff_ord_max.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Lemma</span> <span class="nf">set_ord_max_lift</span> <span class="nv">n</span> (<span class="nv">e</span> : {<span class="nb">set</span> &#39;I_n.+<span class="mi">2</span>}) :
  e :\ ord_max = [<span class="nb">set</span> lift ord_max x | x <span class="kr">in</span> [<span class="nb">set</span> i | lift ord_max i \<span class="kr">in</span> e]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><div><var>e</var><span class="hyp-type"><b>:</b><span>{<span class="nb">set</span> &#39;I_n.+<span class="mi">2</span>}</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">e :\ ord_max =
[<span class="nb">set</span> lift ord_max x
   | x : ordinal_finType n.+<span class="mi">2</span>.-<span class="mi">1</span>
   &amp; lift ord_max x \<span class="kr">in</span> e]</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><q>ba7</q></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/setP =&gt; i; <span class="nb">rewrite</span> !inE /=.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>baa</q><div><var>i</var><span class="hyp-type"><b>:</b><span>ordinal_finType n.+<span class="mi">2</span></span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(i != ord_max) &amp;&amp; (i \<span class="kr">in</span> e) =
(i
   \<span class="kr">in</span> [<span class="nb">set</span> lift ord_max x
          | x : &#39;I_n.+<span class="mi">1</span>
          &amp; lift ord_max x \<span class="kr">in</span> e])</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/andP/imsetP =&gt; [[iH iIe]|[j //]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>baa</q><q>bb1</q><div><var>iH</var><span class="hyp-type"><b>:</b><span>i != ord_max</span></span></div><q>a9</q></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists2</span> x : ordinal_finType n.+<span class="mi">1</span>,
  x \<span class="kr">in</span> [<span class="nb">set</span> i | lift ord_max i \<span class="kr">in</span> e] &amp;
  i = lift ord_max x</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>baa</q><q>bb1</q><div><var>j</var><span class="hyp-type"><b>:</b><span>ordinal_finType n.+<span class="mi">1</span></span></span></div></div><label class="goal-separator"><hr></label><div class="goal-conclusion">j \<span class="kr">in</span> [<span class="nb">set</span> i | lift ord_max i \<span class="kr">in</span> e] -&gt;
i = lift ord_max j -&gt; i != ord_max /\ i \<span class="kr">in</span> e</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="kr">exists</span> (<span class="nv">inord</span> <span class="nv">i</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>bb6</q><span class="goal-separator"><hr></span><div class="goal-conclusion">inord i \<span class="kr">in</span> [<span class="nb">set</span> i | lift ord_max i \<span class="kr">in</span> e]</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><q>bb6</q><label class="goal-separator"><hr></label><div class="goal-conclusion">i = lift ord_max (inord i)</div></blockquote><q>bba</q></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> inE lift_diff_ord_max.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>bb6</q><span class="goal-separator"><hr></span><q>bc4</q></blockquote><q>bb9</q></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><label class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> lift_diff_ord_max.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>bbb</q><span class="goal-separator"><hr></span><q>bbd</q></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">rewrite</span> inE =&gt; kH -&gt;; <span class="nb">split</span> =&gt; //.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><q>1e</q><q>baa</q><q>bb1</q><q>bbc</q><div><var>kH</var><span class="hyp-type"><b>:</b><span>lift ord_max j \<span class="kr">in</span> e</span></span></div></div><span class="goal-separator"><hr></span><div class="goal-conclusion">lift ord_max j != ord_max</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><label class="alectryon-input"><span class="nb">apply</span>/eqP/val_eqP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><q>bce</q><span class="goal-separator"><hr></span><div class="goal-conclusion">val (lift ord_max j) != val ord_max</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">by</span> <span class="nb">rewrite</span> [val (lift _ _)]lift_max /= neq_ltn ltn_ord.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre></article></body></html>